var GA=GA||function(a,b){this.api=a;this.key=b;this.load_script=function(e,f){var d=document.getElementsByTagName("head")[0];var c=document.createElement("script");c.type="text/javascript";c.src=e;c.onload=c.onreadystatechange=function(){if((!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){c.onload=c.onreadystatechange=null;if(d&&c.parentNode){d.removeChild(c)}}};c.onerror=function(){f()};d.insertBefore(c,d.firstChild)};this.http_get=function(f,c,i,j){var h="gh_"+Math.round(Math.random()*10000);var g={action:f,sid:c,body:i};var e=JSON.stringify(g);var d=this.api+f+"?key="+this.key+"&callback=GA."+h+"&params="+encodeURIComponent(e);this.load_script(d,j);GA[h]=function(k){delete GA[h];j&&j(k)}};this.getBuilding=function(c,d,e){this.http_get("getbuildinginfo",c,d,e)};this.routing=function(c,d,e){this.http_get("routing",c,d,e)};this.searchPub=function(c,d,e){this.http_get("searchpoi",c,d,e)};this.searchAll=function(c,d,e){this.http_get("search",d,e)};this.getBuildingOnly=function(c,d,e){this.http_get("getbuildingonly",d,e)};this.searchBoot=function(c,d,e){this.http_get("searchbooth",c,d,e)}};var GB=function(c,b,d){var a=d||Gd.getDevicePixelRatio();this.width=c.width*a;this.height=c.height*a;this.texture=b};var Gj=Gj||function(a){this.map=a;this.Map={};this.Loading=new Array();this.CallBack={}};Gj.prototype.load=function(a,k,f,c,e){var h=this.Map[a];if(h){setTimeout(i(h,f),0);return}var g=this.CallBack[a];if(!g){g=new Array();this.CallBack[a]=g}g.push({callback:k,data:f});var d=new Image();d.crossOrigin="Anonymous";if(this.Loading.indexOf(a)>-1){return}var j=this;d.onload=function(){var o=j.map.gl;var n=o.createTexture();o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);o.bindTexture(o.TEXTURE_2D,n);o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,this);var m=Gd.isPowerOf2(this.width)&&Gd.isPowerOf2(this.height);if(m){o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT)}else{o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE)}if(m){o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR_MIPMAP_LINEAR);o.generateMipmap(o.TEXTURE_2D)}else{o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR)}o.bindTexture(o.TEXTURE_2D,null);o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);var l=new GB(this,n,c);j.Map[a]=l;b(l,a);d=null};d.onerror=function(){d=null;b(undefined,a)};this.Loading.push(a);d.src=a;function i(m,l){return function(){k(m,l)}}function b(l,p){var m=j.CallBack[p];for(var o=0;o<m.length;o++){var q=m[o];q.callback(l,q.data)}delete j.CallBack[p];var n=j.Loading.indexOf(p);if(n>-1){j.Loading.splice(n,1)}}};Gj.prototype.get=function(a){if(this.Map[a]){return this.Map[a].texture}};Gj.prototype.release=function(){for(var a in this.Map){var b=this.Map[a];this.map.gl.deleteTexture(b.texture)}this.Loading.length=0;for(var a in this.CallBack){var b=this.CallBack[a]}};var GRL={load:function(a,b,d){var c=new XMLHttpRequest();c.overrideMimeType("text/plain");c.open("GET",a,true);c.addEventListener("load",function(f){var e=f.target.response;if(this.status===200){if(b){b(e)}}else{if(this.status===0){if(b){b(e)}}else{if(d){d(f)}}}},false);c.addEventListener("error",function(e){if(d){d(e)}},false);c.send(null)}};if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")}}var ObjLoader=function(a){this.map=a;this.CLASSNAME="ObjLoader";this.cache={}};ObjLoader.prototype={parseMtl:function(h){var d=[];var c=h.split("\n");var g=/\s+/;for(var f=0;f<c.length;f++){var b=c[f].trim();var a=b.split(g);var e=a[0];if(e==="newmtl"){d.push({name:a[1]})}else{if(e==="Ka"){d[d.length-1].ambient=new GH(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]))}else{if(e==="Kd"){d[d.length-1].diffuse=new GH(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]))}else{if(e==="Ks"){d[d.length-1].specular=new GH(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]))}else{if(e==="Ns"){}else{if(e==="d"||e==="Tr"){}else{if(e==="illum"){}else{if(e==="map_Ka"){d[d.length-1].ambientMap=a[1]}else{if(e==="map_Kd"){d[d.length-1].diffuseMap=a[1]}else{if(e==="map_d"){d[d.length-1].specularMap=a[1]}else{if(e==="map_bump"||e==="bump"){}else{if(e==="disp"){}}}}}}}}}}}}}return d},parseObj:function(q,h,r){var B=r.offsetZ;var F=[],A=[],f=[],e=[],t=[],m;var l=/^v\s/;var D=/^vn\s/;var x=/^vt\s/;var E=/^f\s/;var n=/^usemtl\s/;var c=/^mtllib\s/;var d=/\s+/;var b=q.split("\n");for(var w=0;w<b.length;w++){var o=b[w].trim();var p=o.split(d);p.shift();var s;if(c.test(o)){m=p[0]}else{if(l.test(o)){s=new GH(parseFloat(p[0]),-parseFloat(p[2]),parseFloat(p[1]));s.multNum(0.001*r.scale);var u=this.map.meters2gp(s.getX(),s.getY());s.setX(u.x+h.x);s.setY(u.y+h.y);u=this.map.meters2gp(s.getZ(),0);s.setZ(u.x+B);F.push(s)}else{if(D.test(o)){s=new GH(parseFloat(p[0]),-parseFloat(p[2]),parseFloat(p[1]));A.push(s)}else{if(x.test(o)){s=new GF(parseFloat(p[0]),1-parseFloat(p[1]));f.push(s)}else{if(E.test(o)){var k={indices:[],texture:[],normal:[]};for(var v=0;v<p.length;v++){var y=p[v].indexOf("//");var C=p[v].split("/");var g=parseInt(C[0]);if(y>0){k.indices.push(g);k.texture.push(-1);k.normal.push(parseInt(C[2]))}else{if(C.length===1){k.indices.push(g)}else{if(C.length===2){k.indices.push(g);k.texture.push(parseInt(C[1]))}else{if(C.length===3){k.indices.push(g);k.texture.push(parseInt(C[1]));k.normal.push(parseInt(C[2]))}}}}}e.push(k)}else{if(n.test(o)){var z=p[0];var a=e.length;t.push({materialName:z,materialStartIndex:a})}}}}}}}return{mtllib:m,verts:F,vertNormals:A,textures:f,faces:e,facesMaterialsIndex:t}},loadMtl:function(b,h,c,g){var f=this;var e=this.cache[b];if(!e){e={extras:[],loadEnd:false,loading:false};this.cache[b]=e;var a=GC.get(b);if(a){e.result=a;e.loadEnd=true}}if(e.loadEnd&&!e.loading){setTimeout(function(){d(e.result,h,c,g)},0);return}e.extras.push({option:c,result:h,callback:g});if(e.loading){return}e.loading=true;GRL.load(b,function(j){GC.set(b,j);var m=f.cache[b];m.result=j;var l=m.extras;for(var k=0;k<l.length;k++){var n=l[k];(function(i,p,o){setTimeout(function(){d(i,p.result,p.option,p.callback)},o*10)})(j,n,k)}m.loadEnd=true;m.loading=false},function(){delete f.cache[b]});function d(m,v,A,s){var x=v.result;var B=v.path;var M=[];var C=x.facesMaterialsIndex;var p=f.parseMtl(m);var o=x.faces;var u=0;var L=0;var E=[],P=[],l=[],t=[];for(var H=0;H<p.length;H++){var z=p[H];for(var F=0;F<C.length;F++){var y=C[F];var K=y.materialName;if(z.name!=K){continue}var O={};if(z.ambientMap){u++;f.map._imageTextureLoader.load(B+z.ambientMap,function(j,i){u--;if(j){i.obj.tAmbient=j.texture}i.obj.path=i.path;if(u==0){f.map.refresh()}},{path:B+z.ambientMap,obj:O},1,true)}if(z.diffuseMap){u++;f.map._imageTextureLoader.load(B+z.diffuseMap,function(j,i){u--;if(j){i.obj.tDiffuse=j.texture}if(u==0){f.map.refresh()}},{path:B+z.diffuseMap,obj:O},1,true)}if(z.specularMap){u++;f.map._imageTextureLoader.load(B+z.specularMap,function(j,i){u--;if(j){i.obj.tSpecular=j.texture}if(u==0){f.map.refresh()}},{path:B+z.specularMap,obj:O},1,true)}var n=z.ambient;var G=z.diffuse;var N=z.specular;if(!n){n=new GH(1,1,1)}if(!G){G=new GH(1,1,1)}if(!N){N=new GH(1,1,1)}var r=y.materialStartIndex;var q=F<C.length-1?C[F+1].materialStartIndex:o.length;for(var J=r;J<q;J++){var w=o[J];var I=w.indices.length;if((L+I)>65535){M.push({tResult:O,vFlatten:Gd.flatten(E),indices:new Uint16Array(t),tFlatten:Gd.flatten(l),nFlatten:Gd.flatten(P),ambient:Gd.flatten([n]),diffuse:Gd.flatten([G]),specular:Gd.flatten([N])});L=0;E.length=0;P.length=0;l.length=0;t.length=0}for(var D=0;D<I;D++){E.push(x.verts[w.indices[D]-1]);P.push(x.vertNormals[w.normal[D]-1]);if(w.texture[D]==-1){l.push(new GF(-999,-999))}else{l.push(x.textures[w.texture[D]-1])}}if(I==3){t.push(L);t.push(L+1);t.push(L+2)}else{if(I==4){t.push(L);t.push(L+1);t.push(L+3);t.push(L+1);t.push(L+2);t.push(L+3)}}L+=I}}if(L>0){M.push({tResult:O,vFlatten:Gd.flatten(E),indices:new Uint16Array(t),tFlatten:Gd.flatten(l),nFlatten:Gd.flatten(P),ambient:Gd.flatten([n]),diffuse:Gd.flatten([G]),specular:Gd.flatten([N])});L=0;E.length=0;P.length=0;l.length=0;t.length=0}}if(s){s({option:A,data:M})}}},load:function(d,f,b,h){var g=this;var e=this.cache[d];if(!e){e={extras:[],loadEnd:false,loading:false};this.cache[d]=e;var a=GC.get(d);if(a){e.result=a;e.loadEnd=true}}if(e.loadEnd&&!e.loading){setTimeout(function(){c(e.result,f,b,h)},0);return}e.extras.push({point2D:f,option:b,callback:h});if(e.loading){return}e.loading=true;GRL.load(d,function(j){GC.set(d,j);var m=g.cache[d];m.result=j;m.loadEnd=true;m.loading=false;for(var k=0;k<m.extras.length;k++){var l=m.extras[k];(function(i,o,n){setTimeout(function(){c(i,o.point2D,o.option,o.callback)},n*10)})(j,l,k)}},function(){delete g.cache[d]});function c(k,o,m,p){var j=g.parseObj(k,o,m);var l=d.lastIndexOf("/");var n=d.substring(0,l+1);var i=n+j.mtllib;g.loadMtl(i,{path:n,result:j},m,p)}}};var GC=GC||{set:function(a,b){try{localStorage.setItem(a,b)}catch(c){}},get:function(a){return localStorage.getItem(a)},clear:function(){localStorage.clear()}};var GHPoint2D=GHPoint2D||function(a,c,b){this.CLASSNAME="GHPoint";this.x=a||0;this.y=c||0;this.z=b||0};GHPoint2D.prototype={toArray:function(){return[this.x,this.y]}};var GHLine=GHLine||function(b,c){var e=b||new Array();var a;var d;this.setExtra=function(g){d=g};this.getExtra=function(){return d};this.setData=function(g){e=g};this.addPoint=function(g){e.push(g)};this.getData=function(){return e};this.setStyle=function(g){f(g)};this.getStyle=function(){return a};function f(g){a=g}};var GHPolygon=GHPolygon||function(a,b,c){this._datas=a||new Array();this._style=b;this._code=c;this._offsetZ=undefined;this._extra=undefined};GHPolygon.prototype={setExtra:function(a){this._extra=a},getExtra:function(){return this._extra},setData:function(a){this._datas=a},addPoint:function(a){this._datas.push(a)},getData:function(){return this._datas},setStyle:function(a){this._style=a},getStyle:function(){return this._style},setCode:function(a){this._code=a},getCode:function(){return this._code},setOffsetZ:function(a){this._offsetZ=a},getOffsetZ:function(){return this._offsetZ}};var GHPixel=GHPixel||function(a,b){this.CLASSNAME="GHPixel";this.x=a||0;this.y=b||0};var GHMark=GHMark||function(r){this.CLASSNAME="GHMARK";var g=r;var c;var s=GHMark.Anchor.BOTTOM;var l=GHMark.TextPosition.NONE;var t=1.5;var j=0;var d;var i=0,h=0,f=0;var m;var n=true;var p=1;var k="#EADEADE";var e=true;var o=false;var q;var a;var u;var b=false;var v=GHConstants.FLOOR_HEIGHT;this._setMap=function(w){a=w};this.setHeight=function(w){v=w};this.getHeight=function(){return v};this.setExtra=function(w){q=w};this.getExtra=function(){return q};this.setPoint=function(w){g=w};this.getPoint=function(){return g};this.setImageSrc=function(w){c=w};this.getImageSrc=function(){return c};this.setAnchor=function(w){s=w};this.getAnchor=function(){return s};this.setTextPosition=function(w){l=w};this.getTextPosition=function(){return l};this.setFontScale=function(w){t=w};this.getFontScale=function(){return t};this.setText=function(w){d=w};this.getText=function(){return d};this.setImageScale=function(w){p=w};this.getImageScale=function(){return p};this.setFontColor=function(w){k=w};this.getFontColor=function(){return k};this.setOffset=function(x,w,y){i=x||0;h=w||0;f=y||0};this.getOffSetX=function(){return i};this.getOffsetY=function(){return h};this.setOffsetZ=function(w){f=w};this.getOffsetZ=function(){return f};this.setData=function(w){m=w};this.getData=function(){return m};this.setAngle=function(w){j=w};this.getAngle=function(){return j};this.setVisible=function(w){n=w};this.getVisible=function(){return n};this.setIsShowText=function(w){e=w};this.getIsShowText=function(){return e};this.isFlat=function(){return b};this.setFlat=function(w){b=w};this.animationTo=function(w,x){if(u){u.stop()}u=new Gh.AnimationTo(a,this);u.setValue(w,x);u.start()};this.setKeepOffset=function(w){o=w};this.isKeepOffset=function(){return o}};GHMark.Anchor={CENTER:1,BOTTOM:2};GHMark.TextPosition={LEFT:1,TOP:2,RIGHT:3,BOTTOM:4,NONE:5};var GD=GD||function(){this.type;this.code;this.fill;this.shade;this.color;this.height};GD.TYPE={SPACE:1,POI:2,AREA_FACE:3,DEC_FACE:4,DEC_LINE:5,FLOOR:6,OVERLAY:10};GD.FontSize={SMALL:2,MIDDLE:3,BIG:4};GD.LineWidth={SMALL:2,MIDDLE:4,BIG:6};GD.LineStyle={DOTTED:0,SOLID:1};GD.TextOrient={LANDSCAPE:1,PORTRAINT:0};GD.Polygon={FILL:1,UN_FILL:0};var GDList=GDList||function(b){var c=b;var d=1;var a=new Array();this.addLineStr=function(f){var h=f.split(",");var g=new GD();g.type=h[0];g.code=h[1];g.fill=h[2];var e=h[3];switch(g.type){case GD.TYPE.SPACE:g.shade=e;break;case GD.TYPE.POI:if(e==1){g.shade=GD.FontSize.SMALL}else{if(e==3){g.shade=GD.FontSize.BIG}else{g.shade=GD.FontSize.MIDDLE}}break;case GD.TYPE.AREA_FACE:g.shade=e;break;case GD.TYPE.DEC_FACE:g.shade=e;break;case GD.TYPE.DEC_LINE:if(e==1){g.shade=GD.LineWidth.SMALL}else{if(e==3){g.shade=GD.LineWidth.BIG}else{g.shade=GD.LineWidth.MIDDLE}}break;case GD.TYPE.FLOOR:g.shade=e;break}g.color=h[4];if(h.length>5){if(h[5]!=""){g.height=h[5]/100;if(g.height>d){d=g.height}}}a.push(g)};this.getStyleByTypeAndCode=function(g,h){for(var e=0;e<a.length;e++){var f=a[e];if(f.type==g&&f.code==h){return f}}};this.getMaxScale=function(){return d}};var GHCluster=GHCluster||function(a){this._point=a;this._group;this._data};GHCluster.prototype={setPoint:function(a){this._point=a},getPoint:function(a){return this._point},setData:function(a){this._data=a},getData:function(){return this._data},setGroup:function(a){this._group=a},getGroup:function(a){return this._group}};var GF=GF||function(a,d){var c=a||0;var b=d||0;this.data=[c,b]};GF.prototype={clone:function(){return new GF(this.data[0],this.data[1])},setX:function(a){this.data[0]=a},setY:function(a){this.data[1]=a},getX:function(){return this.data[0]},getY:function(){return this.data[1]},normalize:function(){var a=this.length();this.data[0]/=a;this.data[1]/=a;return this},dot:function(a){return this.data[0]*a.data[0]+this.data[1]*a.data[1]},multNum:function(a){this.data[0]*=a;this.data[1]*=a;return this},setValue:function(a,b){this.data[0]=a;this.data[1]=b},set:function(a){this.data[0]=a.data[0];this.data[1]=a.data[1]},sub:function(a){this.data[0]-=a.data[0];this.data[1]-=a.data[1];return this},add:function(a){this.data[0]+=a.data[0];this.data[1]+=a.data[1];return this},length:function(){return Math.sqrt(this.data[0]*this.data[0]+this.data[1]*this.data[1])}};var GH=GH||function(a,f,e){var d=a||0;var c=f||0;var b=e||0;this.data=[d,c,b]};GH.prototype={dot:function(a){return this.data[0]*a.data[0]+this.data[1]*a.data[1]+this.data[2]*a.data[2]},add:function(a){this.data[0]+=a.data[0];this.data[1]+=a.data[1];this.data[2]+=a.data[2];return this},sub:function(a){this.data[0]-=a.data[0];this.data[1]-=a.data[1];this.data[2]-=a.data[2];return this},mult:function(b){var a=new GH();a.data[0]=this.data[0]*b.data[0];a.data[1]=this.data[1]*b.data[1];a.data[2]=this.data[2]*b.data[2];return a},div:function(a){this.data[0]/=a.data[0];this.data[1]/=a.data[1];this.data[2]/=a.data[2];return this},normalize:function(){var a=this.length();this.data[0]/=a;this.data[1]/=a;this.data[2]/=a;return this},length:function(){return Math.sqrt(this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2])},cross:function(b){var a=new GH();a.data[0]=this.data[1]*b.data[2]-this.data[2]*b.data[1];a.data[1]=this.data[2]*b.data[0]-this.data[0]*b.data[2];a.data[2]=this.data[0]*b.data[1]-this.data[1]*b.data[0];return a},clone:function(){return new GH(this.data[0],this.data[1],this.data[2])},setX:function(a){this.data[0]=a;return this},setY:function(a){this.data[1]=a;return this},setZ:function(a){this.data[2]=a;return this},getX:function(){return this.data[0]},getY:function(){return this.data[1]},getZ:function(){return this.data[2]},set:function(a){this.data[0]=a.data[0];this.data[1]=a.data[1];this.data[2]=a.data[2]},setValue:function(a,c,b){this.data[0]=a;this.data[1]=c;this.data[2]=b},min:function(c){var b=Math.min(this.getX(),c.getX());var a=Math.min(this.getY(),c.getY());var d=Math.min(this.getZ(),c.getZ());return new GH(b,a,d)},max:function(c){var b=Math.max(this.getX(),c.getX());var a=Math.max(this.getY(),c.getY());var d=Math.max(this.getZ(),c.getZ());return new GH(b,a,d)},distanceTo:function(a){return this.clone().sub(a).length()},multNum:function(a){this.data[0]*=a;this.data[1]*=a;this.data[2]*=a;return this},multMat4:function(s){var q=s.data[0],o=s.data[1],m=s.data[2],l=s.data[3],f=s.data[4],e=s.data[5],c=s.data[6],b=s.data[7],j=s.data[8],i=s.data[9],h=s.data[10],g=s.data[11],t=s.data[12],r=s.data[13],p=s.data[14],n=s.data[15];var k=1/(l*this.getX()+b*this.getY()+g*this.getZ()+n);var a=new GH();a.setX((q*this.getX()+f*this.getY()+j*this.getZ()+t)*k);a.setY((o*this.getX()+e*this.getY()+i*this.getZ()+r)*k);a.setZ((m*this.getX()+c*this.getY()+h*this.getZ()+p)*k);return a},isEmpty:function(){return Gd.toFixed(this.data[0])==0&&Gd.toFixed(this.data[1])==0&&Gd.toFixed(this.data[2])==0}};var GI=GI||function(a,h,g,c){var e=a||0;var d=h||0;var b=g||0;var f=c||0;this.data=[e,d,b,f]};GI.prototype={setX:function(a){this.data[0]=a;return this},setY:function(a){this.data[1]=a;return this},setZ:function(a){this.data[2]=a;return this},setW:function(a){this.data[3]=a;return this},getX:function(){return this.data[0]},getY:function(){return this.data[1]},getZ:function(){return this.data[2]},getW:function(){return this.data[3]},setValue:function(a,d,c,b){this.data[0]=a;this.data[1]=d;this.data[2]=c;this.data[3]=b;return this},set:function(a){this.data[0]=a.data[0];this.data[1]=a.data[1];this.data[2]=a.data[2];this.data[3]=a.data[3];return this},sub:function(a){this.data[0]-=a.data[0];this.data[1]-=a.data[1];this.data[2]-=a.data[2];this.data[3]-=a.data[3];return this},add:function(a){this.data[0]+=a.data[0];this.data[1]+=a.data[1];this.data[2]+=a.data[2];this.data[3]+=a.data[3];return this},clone:function(){return new GI(this.data[0],this.data[1],this.data[2],this.data[3])},length:function(){return Math.sqrt(this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]+this.data[3]*this.data[3])},normalize:function(){var a=this.length();this.data[0]/=a;this.data[1]/=a;this.data[2]/=a;this.data[3]/=a;return this},multNum:function(a){this.data[0]*=a;this.data[1]*=a;this.data[2]*=a;this.data[3]*=a;return this}};var GOB=GOB||function(a,b){this.origin=a;this.direction=b;this.direction.normalize()};GOB.prototype={set:function(a,b){this.origin.set(a);this.direction.set(b);this.direction.normalize();return this},at:function(a){return this.direction.clone().multNum(a).clone().add(this.origin)},intersectBox:function(f){var c,g,i,a,h,k;var e=1/this.direction.getX(),d=1/this.direction.getY(),b=1/this.direction.getZ();var j=this.origin;if(e>=0){c=(f.min.getX()-j.getX())*e;g=(f.max.getX()-j.getX())*e}else{c=(f.max.getX()-j.getX())*e;g=(f.min.getX()-j.getX())*e}if(d>=0){i=(f.min.getY()-j.getY())*d;a=(f.max.getY()-j.getY())*d}else{i=(f.max.getY()-j.getY())*d;a=(f.min.getY()-j.getY())*d}if((c>a)||(i>g)){return null}if(i>c||c!==c){c=i}if(a<g||g!==g){g=a}if(b>=0){h=(f.min.getZ()-j.getZ())*b;k=(f.max.getZ()-j.getZ())*b}else{h=(f.max.getZ()-j.getZ())*b;k=(f.min.getZ()-j.getZ())*b}if((c>k)||(h>g)){return null}if(h>c||c!==c){c=h}if(k<g||g!==g){g=k}if(g<0){return null}return this.at(c>=0?c:g)},intersectTriangle:function(o,m,l,d){var g=m.clone().sub(o);var f=l.clone().sub(o);var j=g.cross(f);var k=this.direction.dot(j);var e;if(k>0){if(d){return null}e=1}else{if(k<0){e=-1;k=-k}else{return null}}var p=this.origin.clone().sub(o);f=p.cross(f);var n=e*this.direction.dot(f);if(n<0){return null}var h=e*this.direction.dot(g.cross(p));if(h<0){return null}if(n+h>k){return null}var i=-e*p.dot(j);if(i<0){return null}return this.at(i/k)}};var GOA=GOA||function(b,a){this.min=b||new GH(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=a||new GH(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE)};GOA.prototype={add:function(a){this.min=this.min.min(a);this.max=this.max.max(a);return this},setValue:function(b,a){this.min.set(b);this.max.set(a)}};var GK=GK||function(){this.data=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};GK.prototype={set:function(a){for(var b=0;b<16;b++){this.data[b]=a.data[b]}},clone:function(){var a=new GK();a.set(this);return a},identity:function(){this.data[0]=1;this.data[1]=0;this.data[2]=0;this.data[3]=0;this.data[4]=0;this.data[5]=1;this.data[6]=0;this.data[7]=0;this.data[8]=0;this.data[9]=0;this.data[10]=1;this.data[11]=0;this.data[12]=0;this.data[13]=0;this.data[14]=0;this.data[15]=1},mult:function(an){var am=this.data[0],al=this.data[1],ak=this.data[2],aj=this.data[3],ai=this.data[4],ag=this.data[5],af=this.data[6],ae=this.data[7],ad=this.data[8],ac=this.data[9],ab=this.data[10],aa=this.data[11],Z=this.data[12],Y=this.data[13],X=this.data[14],W=this.data[15],V=an.data[0],U=an.data[1],T=an.data[2],S=an.data[3],R=an.data[4],Q=an.data[5],z=an.data[6],y=an.data[7],x=an.data[8],w=an.data[9],v=an.data[10],u=an.data[11],t=an.data[12],s=an.data[13],r=an.data[14],q=an.data[15];var ah=new GK();ah.data[0]=V*am+U*ai+T*ad+S*Z;ah.data[1]=V*al+U*ag+T*ac+S*Y;ah.data[2]=V*ak+U*af+T*ab+S*X;ah.data[3]=V*aj+U*ae+T*aa+S*W;ah.data[4]=R*am+Q*ai+z*ad+y*Z;ah.data[5]=R*al+Q*ag+z*ac+y*Y;ah.data[6]=R*ak+Q*af+z*ab+y*X;ah.data[7]=R*aj+Q*ae+z*aa+y*W;ah.data[8]=x*am+w*ai+v*ad+u*Z;ah.data[9]=x*al+w*ag+v*ac+u*Y;ah.data[10]=x*ak+w*af+v*ab+u*X;ah.data[11]=x*aj+w*ae+v*aa+u*W;ah.data[12]=t*am+s*ai+r*ad+q*Z;ah.data[13]=t*al+s*ag+r*ac+q*Y;ah.data[14]=t*ak+s*af+r*ab+q*X;ah.data[15]=t*aj+s*ae+r*aa+q*W;return ah},scale:function(a){this.data[0]*=a.data[0];this.data[1]*=a.data[0];this.data[2]*=a.data[0];this.data[3]*=a.data[0];this.data[4]*=a.data[1];this.data[5]*=a.data[1];this.data[6]*=a.data[1];this.data[7]*=a.data[1];this.data[8]*=a.data[2];this.data[9]*=a.data[2];this.data[10]*=a.data[2];this.data[11]*=a.data[2]},multNum:function(a){for(var b=0;b<16;b++){this.data[b]*=a}},translate:function(c){var a=this.data[0]*c.data[0]+this.data[4]*c.data[1]+this.data[8]*c.data[2]+this.data[12];var e=this.data[1]*c.data[0]+this.data[5]*c.data[1]+this.data[9]*c.data[2]+this.data[13];var d=this.data[2]*c.data[0]+this.data[6]*c.data[1]+this.data[10]*c.data[2]+this.data[14];var b=this.data[3]*c.data[0]+this.data[7]*c.data[1]+this.data[11]*c.data[2]+this.data[15];this.data[12]=a;this.data[13]=e;this.data[14]=d;this.data[15]=b},rotate:function(Z,B){var U=Math.sqrt(B.data[0]*B.data[0]+B.data[1]*B.data[1]+B.data[2]*B.data[2]);if(!U){return null}var ae=B.data[0],ad=B.data[1],ac=B.data[2];if(U!=1){U=1/U;ae*=U;ad*=U;ac*=U}var ab=Math.sin(Z),aa=Math.cos(Z),Y=1-aa,X=this.data[0],W=this.data[1],V=this.data[2],T=this.data[3],S=this.data[4],R=this.data[5],Q=this.data[6],P=this.data[7],O=this.data[8],N=this.data[9],L=this.data[10],K=this.data[11],J=ae*ae*Y+aa,I=ad*ae*Y+ac*ab,H=ac*ae*Y-ad*ab,G=ae*ad*Y-ac*ab,F=ad*ad*Y+aa,E=ac*ad*Y+ae*ab,D=ae*ac*Y+ad*ab,C=ad*ac*Y-ae*ab,M=ac*ac*Y+aa;this.data[0]=X*J+S*I+O*H;this.data[1]=W*J+R*I+N*H;this.data[2]=V*J+Q*I+L*H;this.data[3]=T*J+P*I+K*H;this.data[4]=X*G+S*F+O*E;this.data[5]=W*G+R*F+N*E;this.data[6]=V*G+Q*F+L*E;this.data[7]=T*G+P*F+K*E;this.data[8]=X*D+S*C+O*M;this.data[9]=W*D+R*C+N*M;this.data[10]=V*D+Q*C+L*M;this.data[11]=T*D+P*C+K*M},lookAt:function(s,t,h){var m=s.data[0],j=s.data[1],g=s.data[2],w=h.data[0],v=h.data[1],u=h.data[2],f=t.data[0],e=t.data[1],d=t.data[2];if(m==f&&j==e&&g==d){this.identity();return}var r,q,p,c,b,a,n,k,i,o;n=m-t.data[0];k=j-t.data[1];i=g-t.data[2];o=1/Math.sqrt(n*n+k*k+i*i);n*=o;k*=o;i*=o;r=v*i-u*k;q=u*n-w*i;p=w*k-v*n;o=Math.sqrt(r*r+q*q+p*p);if(!o){r=0;q=0;p=0}else{o=1/o;r*=o;q*=o;p*=o}c=k*p-i*q;b=i*r-n*p;a=n*q-k*r;o=Math.sqrt(c*c+b*b+a*a);if(!o){c=0;b=0;a=0}else{o=1/o;c*=o;b*=o;a*=o}this.data[0]=r;this.data[1]=c;this.data[2]=n;this.data[3]=0;this.data[4]=q;this.data[5]=b;this.data[6]=k;this.data[7]=0;this.data[8]=p;this.data[9]=a;this.data[10]=i;this.data[11]=0;this.data[12]=-(r*m+q*j+p*g);this.data[13]=-(c*m+b*j+a*g);this.data[14]=-(n*m+k*j+i*g);this.data[15]=1},perspective:function(f,e,l,g){var k=l*Math.tan(f*Math.PI/360);var d=k*e;var j=d*2,i=k*2,h=g-l;this.data[0]=l*2/j;this.data[1]=0;this.data[2]=0;this.data[3]=0;this.data[4]=0;this.data[5]=l*2/i;this.data[6]=0;this.data[7]=0;this.data[8]=0;this.data[9]=0;this.data[10]=-(g+l)/h;this.data[11]=-1;this.data[12]=0;this.data[13]=0;this.data[14]=-(g*l*2)/h;this.data[15]=0},makeFrustum:function(h,k,b,j,l,i){var g=2*l/(k-h);var e=2*l/(j-b);var f=(k+h)/(k-h);var d=(j+b)/(j-b);var c=-(i+l)/(i-l);var a=-2*i*l/(i-l);this.data=[g,0,f,0,0,e,d,0,0,0,c,a,0,0,-1,0]},ortho:function(b,j,i,a,f,e){var c=(j-b);var k=(i-a);var g=(e-f);this.data[0]=2/c;this.data[1]=0;this.data[2]=0;this.data[3]=0;this.data[4]=0;this.data[5]=2/k;this.data[6]=0;this.data[7]=0;this.data[8]=0;this.data[9]=0;this.data[10]=-2/g;this.data[11]=0;this.data[12]=-(b+j)/c;this.data[13]=-(i+a)/k;this.data[14]=-(e+f)/g;this.data[15]=1},inverse:function(){var af=this.data[0],ae=this.data[1],ad=this.data[2],ac=this.data[3],ab=this.data[4],Z=this.data[5],Y=this.data[6],X=this.data[7],W=this.data[8],V=this.data[9],U=this.data[10],T=this.data[11],S=this.data[12],R=this.data[13],Q=this.data[14],P=this.data[15],N=af*Z-ae*ab,L=af*Y-ad*ab,K=af*X-ac*ab,J=ae*Y-ad*Z,I=ae*X-ac*Z,H=ad*X-ac*Y,G=W*R-V*S,F=W*Q-U*S,E=W*P-T*S,D=V*Q-U*R,O=V*P-T*R,M=U*P-T*Q,C=1/(N*M-L*O+K*D+J*E-I*F+H*G);var aa=new GK();aa.data[0]=(Z*M-Y*O+X*D)*C;aa.data[1]=(-ae*M+ad*O-ac*D)*C;aa.data[2]=(R*H-Q*I+P*J)*C;aa.data[3]=(-V*H+U*I-T*J)*C;aa.data[4]=(-ab*M+Y*E-X*F)*C;aa.data[5]=(af*M-ad*E+ac*F)*C;aa.data[6]=(-S*H+Q*K-P*L)*C;aa.data[7]=(W*H-U*K+T*L)*C;aa.data[8]=(ab*O-Z*E+X*G)*C;aa.data[9]=(-af*O+ae*E-ac*G)*C;aa.data[10]=(S*I-R*K+P*N)*C;aa.data[11]=(-W*I+V*K-T*N)*C;aa.data[12]=(-ab*D+Z*F-Y*G)*C;aa.data[13]=(af*D-ae*F+ad*G)*C;aa.data[14]=(-S*J+R*L-Q*N)*C;aa.data[15]=(W*J-V*L+U*N)*C;return aa}};GK.makeRtt=function(i,h,g,f){var a=new GH(i,h,g);a.normalize();var e=a.getX();var c=a.getY();var b=a.getZ();var j=new GK();j.data[0]=1-2*e*e;j.data[1]=-2*e*c;j.data[2]=-2*e*b;j.data[3]=0;j.data[4]=-2*c*e;j.data[5]=1-2*c*c;j.data[6]=-2*c*b;j.data[7]=0;j.data[8]=-2*b*e;j.data[9]=-2*b*c;j.data[10]=1-2*b*b;j.data[11]=0;j.data[12]=-2*f*e;j.data[13]=-2*f*c;j.data[14]=-2*f*b;j.data[15]=0;return j};var GL=GL||function(){this._data;this.bound={minx:-1,maxx:Number.MAX_VALUE,miny:-1,maxy:Number.MAX_VALUE}};GL.prototype={setData:function(b){this._data=b;for(var a=0;a<this._data.length;a++){this.bound.minx=Math.min(this._data[a].x,this.bound.minx);this.bound.miny=Math.min(this._data[a].y,this.bound.miny);this.bound.maxx=Math.max(this._data[a].x,this.bound.maxx);this.bound.maxy=Math.max(this._data[a].y,this.bound.maxy)}},contains:function(b,f){var a=false;if(this.boundContanis(b,f)){a=true}else{a=false;return a}var c=this._data.length==3;if(this._data.length==4){if(Gd.toFixed(this._data[0].x)==Gd.toFixed(this._data[3].x)&&Gd.toFixed(this._data[0].y)==Gd.toFixed(this._data[3].y)){c=true}}if(c){var e=new GN(this._data[0],this._data[1],this._data[2]);return e.contains(new GHPoint2D(b,f),true)}if(a){a=this.isOnLined(b,f)}if(a){return a}else{var d=this.get_point_of_intersection(b,f);if(d%2==0){a=false}else{a=true}}return a},isOnLined:function(a,d){var c=false;for(var b=0;b<this._data.length;b++){if(b==this._data.length-1){c=this.isOnLine(a,d,this._data[b].x,this._data[b].y,this._data[0].x,this._data[0].y,true)}else{c=this.isOnLine(a,d,this._data[b].x,this._data[b].y,this._data[b+1].x,this._data[b+1].y,true)}if(c){return c}}return c},get_point_of_intersection:function(a,g){var f=0;var b=0;var d=0;for(var c=0;c<this._data.length;c++){var e=false;if(c==this._data.length-1){if(this._data[c].x-this._data[0].x==0){d=this._data[0].x}else{b=(this._data[c].y-this._data[0].y)/(this._data[c].x-this._data[0].x);d=(g-this._data[0].y)/b+this._data[0].x}e=this.isOnLine(d,g,this._data[c].x,this._data[c].y,this._data[0].x,this._data[c].y,false)}else{if(this._data[c+1].x-this._data[c].x==0){d=this._data[c].x}else{b=(this._data[c+1].y-this._data[c].y)/(this._data[c+1].x-this._data[c].x);d=(g-this._data[c].y)/b+this._data[c].x}e=this.isOnLine(d,g,this._data[c].x,this._data[c].y,this._data[c+1].x,this._data[c+1].y,false)}if(e){if(d<a){f++}}}return f},isOnLine:function(j,g,c,i,a,h,e){var b=false;if((j<c&&j<a)||(j>c&&j>a)||(g<i&&g<h)||(g>i&&g>h)){b=false}else{if(e){var f=Math.sqrt((j-c)*(j-c)+(g-i)*(g-i));var d=Math.sqrt((a-c)*(a-c)+(h-i)*(h-i));if((j-c)/f==(a-c)/d&&(g-i)/f==(h-i)/d){b=true}else{b=false}}else{b=true}}return b},boundContanis:function(a,b){return this.bound.minx<=a&&a<=this.bound.maxx&&this.bound.miny<=b&&b<=this.bound.maxy}};function eqPoint(b,a){return b==a||(b.x==a.x&&b.y==a.y)}function pointInLine(c,b,a){return(b.x-c.x)*(a.y-c.y)-(a.x-c.x)*(b.y-c.y)}function edge(b,a){return{x:a.x-b.x,y:a.y-b.y}}function sq(a){return a.x*a.x+a.y*a.y}function sortPointsClockwise(e){var c=e.slice(0);if(c.length>0){if(c[0].x!=c[e.length-1].x||c[0].y==c[e.length-1].y){c.push(c[0])}}var b=0;for(var d=0;d<c.length-1;d++){var a=d+1;b+=(c[a].y*c[d].x-c[a].x*c[d].y)}if(b<0){e.reverse()}}var GN=GN||function(e,d,f){this.a=e;this.b=d;this.c=f};GN.prototype={contains:function(c,b){if(eqPoint(this.b,c)||eqPoint(this.b,c)||eqPoint(this.c,c)){if(b){return true}return false}var a=pointInLine(this.a,this.b,c);if(a<=0){return false}a=pointInLine(this.b,this.c,c);if(a<=0){return false}a=pointInLine(this.c,this.a,c);if(a<=0){return false}return true},weight:function(){var b=edge(this.b,this.c);var h=edge(this.c,this.a);var g=edge(this.b,this.a);var f=sq(b);var e=sq(h);var d=sq(g);var a=Math.min(f,e);a=Math.min(a,d);var c;if(a==f){c=(e+d-f)/(2*Math.sqrt(e)*Math.sqrt(d))}else{if(a==e){c=(f+d-e)/(2*Math.sqrt(f)*Math.sqrt(d))}else{c=(f+e-d)/(2*Math.sqrt(f)*Math.sqrt(e))}}return Math.acos(c)}};var GM=GM||function(a){this.p=a;this.preNode;this.nextNode;this.convex=false;this.weight=0};GM.prototype={calConvex:function(){var a=pointInLine(this.preNode.p,this.p,this.nextNode.p);if(a>=0){this.convex=true}else{this.convex=false}},toTriagle:function(){return new GN(this.preNode.p,this.p,this.nextNode.p)}};var GTP=GTP||{triangulate:function(l){var k=new Array();if(l.length<3){return k}if(l.length==3){return[new GN(l[0],l[1],l[2])]}sortPointsClockwise(l);var b=new Array(l.length);for(var f=0;f<b.length;f++){var c=new GM(l[f]);b[f]=c}for(var f=0;f<b.length;f++){var c=b[f];var a=f-1;if(a<0){a+=b.length}var h=f+1;if(h>=b.length){h-=b.length}c.preNode=b[a];c.nextNode=b[h];c.calConvex()}while(b.length>3){var g=0;var m=0;var n;for(var f=0;f<b.length;f++){var c=b[f];if(!c.convex){continue}var o=c.toTriagle();var d=false;for(var e=0;e<l.length;e++){d=o.contains(l[e]);if(d){break}}if(!d){c.weight=o.weight();if(c.weight>g){g=c.weight;m=f;n=o}}}k.push(n);var c=b[m];c.preNode.nextNode=c.nextNode;c.nextNode.preNode=c.preNode;c.preNode.calConvex();c.nextNode.calConvex();b.splice(m,1)}var o=b[0].toTriagle();k.push(o);return k}};var GO=GO||function(p,e){var d=e;var r=p;var g=0;var C={};var x;var o;var H;var m=false;var u=0;var K=false;var L={x:B(d),y:z(d)};function D(){M("click",function(N){t(N)});M("touchstart",F);M("touchmove",G);M("touchend",A);M("mousedown",E);M("mousemove",b);M("mouseup",J);M("mouseout",J);M("DOMMouseScroll",w);d.onmousewheel=w;M("webglcontextlost",function(N){t(N);d.restoreContext()});M("webglcontextrestored",function(N){r.refresh()});M("contextmenu",function(N){t(N)});window.onbeforeunload=function(){if(r.invokeUnLoadListener()){return}r.release()};document.onkeyup=f}function E(N){t(N);if(N.button==1){return}if(N.button==2){var O=r.getEnableControl();if(O){O.cancel()}return}m=true;o=new GHPixel(j(N),h(N));C.x=j(N);C.y=h(N);if(!l){l=Gd.clone(C)}g++;if(g==1){if(!x){clearTimeout(x)}x=setTimeout(k,GHConstants.DBCLICK_INTERVAL)}if(r.onMapMoveListener&&r.onMapMoveListener.onMoveStart){r.onMapMoveListener.onMoveStart()}}function b(Q){t(Q);if(Q.button!=0){return}if(m){var V=j(Q)-o.x;var U=h(Q)-o.y;if(r._mode===2){if(V!=0||U!=0){o.x=j(Q);o.y=h(Q);var R=r.getCamera();var O=0.05;if(Math.abs(V)>=Math.abs(U)){if(V<0){R.setNorth(R.getNorth()+O)}else{R.setNorth(R.getNorth()-O)}}else{if(U<0){R.setPitch(R.getPitch()+O)}else{R.setPitch(R.getPitch()-O)}}r.refresh()}}else{if(V!=0||U!=0){var T=r.px2gp(j(Q),h(Q));var S=r.px2gp(o.x,o.y);V=S.x-T.x;U=S.y-T.y;o.x=j(Q);o.y=h(Q);r.translate(V,U);r._onMapMove()}}}else{var P=r.getEnableControl();if(P){var N=r.px2gp(j(Q),h(Q));P.setTempPoint(N)}}}function J(N){t(N);if(N.button!=0){return}y={x:j(N),y:h(N)};if(m&&r.onMapMoveListener&&r.onMapMoveListener.onMoveEnd){r.onMapMoveListener.onMoveEnd()}m=false;o=undefined}var l,y;function a(P){P=P==undefined?10:50;if(l&&y){var O=y.x-l.x;var N=y.y-l.y;return Math.abs(O)<=P&&Math.abs(N)<=P}return false}function F(O){t(O);if(O.touches.length==1){K=true;var N=O.touches[0];C.x=j(N);C.y=h(N);if(r.onMapMoveListener&&r.onMapMoveListener.onMoveStart){r.onMapMoveListener.onMoveStart()}l={x:C.x,y:C.y};y=Gd.clone(l);g++;if(g==1){if(!x){clearTimeout(x)}x=setTimeout(k,GHConstants.DBCLICK_INTERVAL)}}else{l=undefined}}function A(N){t(N);if(K&&r.onMapMoveListener&&r.onMapMoveListener.onMoveEnd){r.onMapMoveListener.onMoveEnd()}K=false;o=undefined;H=undefined}function G(S){t(S);var U,T;if(S.touches.length==1){U=S.touches[0];y.x=j(U);y.y=h(U);if(o){var Y=j(U)-o.x;var X=h(U)-o.y;if(Y!=0||X!=0){if(r.is3DAll()){if(Math.abs(X)>Math.abs(Y)){if(r._md()){X=X/window.devicePixelRatio}Y=0}else{var P=r.getCamera().axis.normalize().multNum(-Y);Y=P.getX()/window.devicePixelRatio;X=P.getY()/window.devicePixelRatio}}else{var W=r.px2gp(j(U),h(U));var V=r.px2gp(o.x,o.y);Y=V.x-W.x;X=V.y-W.y;o.x=j(U);o.y=h(U)}r.translate(Y,X);r._onMapMove()}}else{o=new GHPixel(j(U),h(U))}H=undefined}else{if(S.touches.length==2){g=0;y=undefined;U=S.touches[0];T=S.touches[1];if(H){var O={x1:j(U),y1:h(U),x2:j(T),y2:h(T),rotate:Gd.getRotate(j(U),h(U),j(T),h(T)),distance:Gd.getDistance(j(U),h(U),j(T),h(T))};if(r.isEnableTouchZoom()){var Q=s(H,O);r.getCamera().scale(1/Q)}if(p.isEnableTouchRotate()){var R=n(H,O);r.setRotate(R,false)}if(r.isEnableTouchPitch()){var N=q(H,O);if(N){r.setPitch(N,false)}}r.refresh();H=O}else{H={x1:j(U),y1:h(U),x2:j(T),y2:h(T),rotate:Gd.getRotate(j(U),h(U),j(T),h(T)),distance:Gd.getDistance(j(U),h(U),j(T),h(T))}}}else{H=undefined}}}function j(O){if(O.offsetX){if(r._md()){return O.offsetX*window.devicePixelRatio}return O.offsetX}var N=O.pageX-L.x;if(r._md()){return N*window.devicePixelRatio}return N}function h(P){if(P.offsetY){if(r._md()){return P.offsetY*window.devicePixelRatio}return P.offsetY}var O=0;if(P.target&&P.target.scrollTop!=undefined){var N=P.target;O=N.scrollTop;while(N=N.offsetParent){O+=N.scrollTop}}var Q=P.pageY+O-L.y;if(r._md()){return Q*window.devicePixelRatio}return Q}function B(P){var N=P;var O=P.offsetLeft;while(N=N.offsetParent){O+=N.offsetLeft}return O}function z(P){var N=P;var O=P.offsetTop;while(N=N.offsetParent){O+=N.offsetTop}return O}function s(O,N){return N.distance/O.distance}function n(O,N){var P=N.rotate-O.rotate;P+=r.getRotate();return P}function q(R,Q){var T=Math.abs(Q.x1-R.x1);var S=Math.abs(Q.x2-R.x2);var P=Q.y1-R.y1;var O=Q.y2-R.y2;var N;if(T<10&&S<10){if(P>0&&O>0){N=r.getPitch()+3}else{if(P<0&&O<0){N=r.getPitch()-3}}}return N}function w(N){t(N);var O=0;N=N||window.event;if(N.wheelDelta){if(N.wheelDelta>0){r.zoomIn()}if(N.wheelDelta<0){r.zoomOut()}}else{if(N.detail){if(N.detail>0){r.zoomOut()}if(N.detail<0){r.zoomIn()}}}}function M(N,Q,O){var P=O||d;if(window.attachEvent){P.attachEvent(N,Q)}else{P.addEventListener(N,Q,false)}}function t(N){if(N&&N.preventDefault){N.preventDefault()}else{window.event.returnValue=false}return false}var I=30;function k(N){if(K){g=0;return}if(g==1){if(a()){v()}}else{if(g>1){if(a(50)){c()}else{if(a(50)){v()}}}}g=0;l=undefined;y=undefined}function v(){if(r.is3DAll()){return}var N=r._clickSelect(C.x,C.y);var P=r.px2gp(C.x,C.y);var O=r.getEnableControl();if(O){O.addPoint(P)}r._onCompassClick(C);if(r.onMapClickListener&&!N){r.onMapClickListener(P,C)}}function c(){var O=r.getEnableControl();if(!O){r.zoomIn()}if(r.is3DAll()){return}var N=r.px2gp(C.x,C.y);if(O){O.end(N)}if(r.onMapDoubleClickListener){r.onMapDoubleClickListener(N)}}function i(O){var N=new GHPixel(O.x,O.y);return N}function f(N){var P=N||window.event||arguments.callee.caller.arguments[0];if(P&&P.keyCode==27){var O=r.getEnableControl();if(O){O.removeLastPoint()}}}D()};var GP=GP||function(u){var t=new Gf(u.gl);var e,s,l,v,j;var a,p,d,n,o,g,m;var c=u;var r=c.gl;var f,b,k;var i="uniform mat4 mvpMatrix; \nuniform float relativeHeight; \nuniform float pxScale;	\nuniform float imgScale;	\nuniform vec3 up; \nuniform vec3 axis; \nuniform float heightScale; \nuniform float bottomHeight; \nattribute vec4 aVertexColor; \nattribute vec3 aVertexPosition; \nattribute highp vec2 aTextureCoord; \nvarying highp vec2 vTextureCoord; \nvoid main(void) {				\n	vec3  vUp   = normalize(up);				          \n	vec3  vAxis = normalize(axis);				      \n	float realScale = pxScale * imgScale;	\n	float width = realScale * aVertexColor.x;	\n	float height = realScale * aVertexColor.y;	\n	float rotateAngle = aVertexColor.z;	\n	float isOri = aVertexColor.w;	\n	if(rotateAngle != 0.0) { 		\n		float cosValue = cos(rotateAngle);	\n		float sinValue = sin(rotateAngle);	\n		float w = width * cosValue - height * sinValue; \n		float h = width * sinValue + height * cosValue; \n		width = w;			\n		height = h;			\n	}	\n	vec4 pTan;	\n	if(isOri == 0.0){	\n		vec3 cPt = vAxis*width+vUp*height; \n 		vec3 pt = aVertexPosition; \n		float r = pt.z - bottomHeight;							\n		pt.z = bottomHeight + r *heightScale  + relativeHeight; \n		cPt = cPt + pt;			\n		pTan = vec4(cPt, 1.0); \n	}else{ \n		pTan = vec4(aVertexPosition, 1.0); \n		pTan.x += width; 	\n		pTan.y += height; 	\n	}	\n	pTan.z = pTan.z + relativeHeight; \n	gl_Position = mvpMatrix * pTan;	\n	vTextureCoord = aTextureCoord; \n}		\n";var h=" varying highp vec2 vTextureCoord;		\n uniform sampler2D uSampler; \n void main(void) {		\n		gl_FragColor = texture2D(uSampler, vTextureCoord); \n}	\n";q();function q(){t.createProgram(i,h);if(t.isValid()){t.useProgram();e=t.getUniformLocation("mvpMatrix");a=t.getUniformLocation("relativeHeight");p=t.getUniformLocation("pxScale");m=t.getUniformLocation("imgScale");d=t.getUniformLocation("up");n=t.getUniformLocation("axis");o=t.getUniformLocation("heightScale");g=t.getUniformLocation("bottomHeight");s=t.getAttribLocation("aVertexColor");l=t.getAttribLocation("aVertexPosition");v=t.getAttribLocation("aTextureCoord");j=t.getUniformLocation("uSampler")}}this.render=function(y){if(!t.isValid()){return}if(!y.vertexPosition||y.vertexPosition.length==0){return}t.useProgram();if(!f){f=r.createBuffer()}if(!b){b=r.createBuffer()}if(!k){k=r.createBuffer()}var E=y.relativeHeight||0;var A=y.pxScale||c.calPixelScale();r.uniform1f(a,E);r.uniform1f(p,A);var C=y.imgScale||1;r.uniform1f(m,C);var D=new Float32Array(y.up);var B=new Float32Array(y.axis);r.uniform3fv(d,D);r.uniform3fv(n,B);if(y.offsetZ==undefined||y.offsetZ==0){var w=y.heightScale==undefined?1:y.heightScale;r.uniform1f(o,w);r.uniform1f(g,y.bottomHeight)}else{var w=y.heightScale==undefined?1:y.heightScale;r.uniform1f(o,0);var z=y.keepOffset==true?1:w;r.uniform1f(g,y.bottomHeight+y.offsetZ*z)}var x=new Float32Array(c.mvpMatrix.data);r.uniformMatrix4fv(e,false,x);r.enableVertexAttribArray(s);r.enableVertexAttribArray(l);r.enableVertexAttribArray(v);r.enableVertexAttribArray(j);r.bindBuffer(r.ARRAY_BUFFER,f);r.bufferData(r.ARRAY_BUFFER,y.vertexPosition,r.DYNAMIC_DRAW);r.vertexAttribPointer(l,3,r.FLOAT,false,0,0);r.bindBuffer(r.ARRAY_BUFFER,b);r.bufferData(r.ARRAY_BUFFER,y.vertexColor,r.DYNAMIC_DRAW);r.vertexAttribPointer(s,4,r.FLOAT,false,0,0);r.bindBuffer(r.ARRAY_BUFFER,k);r.bufferData(r.ARRAY_BUFFER,y.texturePosition,r.DYNAMIC_DRAW);r.vertexAttribPointer(v,2,r.FLOAT,false,0,0);r.activeTexture(r.TEXTURE0);r.bindTexture(r.TEXTURE_2D,y.textureData);r.uniform1i(j,0);r.drawArrays(r.TRIANGLES,0,y.vertexPosition.length/3);D=null;x=null;B=null;r.disableVertexAttribArray(s);r.disableVertexAttribArray(l);r.disableVertexAttribArray(v);r.disableVertexAttribArray(j)};this.release=function(){Gd.releaseBuffer(r,f);Gd.releaseBuffer(r,k);Gd.releaseBuffer(r,b);t.release()}};var GQ=GQ||function(r){var q=new Gf(r.gl);var d,p,j;var a,n,k,f;var c=r;var o=c.gl;var e,b;var i,l;var g="uniform mat4 mvpMatrix; \nuniform float relativeHeight; \nuniform float heightScale; \nuniform float bottomHeight; \nuniform float alpha; \nattribute vec4 aVertexColor; \nattribute vec3 aVertexPosition; \nvarying highp vec4 vColor;	\nvarying highp float vAlpha;	\nvoid main(void) {				\n	vec4 pTan = vec4(aVertexPosition, 1.0); \n	float r = pTan.z - bottomHeight;							\n	pTan.z = bottomHeight + r *heightScale  + relativeHeight; \n	gl_Position = mvpMatrix * pTan;	\n	vColor = vec4(aVertexColor.xyz,1.0);		\n	vAlpha = alpha * aVertexColor.w;		\n}		\n";var h="varying highp vec4 vColor;		\nvarying highp float vAlpha;	\n void main(void) {		\n	if(vColor.a == 0.0) discard;	\n		gl_FragColor = vColor * vAlpha; \n}	\n";m();function m(){q.createProgram(g,h);if(q.isValid()){q.useProgram();d=q.getUniformLocation("mvpMatrix");a=q.getUniformLocation("relativeHeight");n=q.getUniformLocation("alpha");k=q.getUniformLocation("heightScale");f=q.getUniformLocation("bottomHeight");p=q.getAttribLocation("aVertexColor");j=q.getAttribLocation("aVertexPosition")}}this.updatePolygonBuffer=function(s){};this.updateLineBuffer=function(s){if(!i){i=o.createBuffer()}if(s.vertexPosition){o.bindBuffer(o.ARRAY_BUFFER,i);o.bufferData(o.ARRAY_BUFFER,s.vertexPosition,o.DYNAMIC_DRAW)}if(!l){l=o.createBuffer()}if(s.vertexColor){o.bindBuffer(o.ARRAY_BUFFER,l);o.bufferData(o.ARRAY_BUFFER,s.vertexColor,o.DYNAMIC_DRAW)}};this.render=function(x){if(!q.isValid()){return}if(!x.vertexPosition||x.vertexPosition.length==0){return}q.useProgram();var t,u;if(x.renderType==GHConstants.RENDER_TYPE_POLYGON){if(!e){e=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,e);o.bufferData(o.ARRAY_BUFFER,x.vertexPosition,o.DYNAMIC_DRAW)}if(!b){b=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,b);o.bufferData(o.ARRAY_BUFFER,x.vertexColor,o.DYNAMIC_DRAW)}t=e;u=b}else{if(x.renderType==GHConstants.RENDER_TYPE_LINE){if(!i){i=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,i);o.bufferData(o.ARRAY_BUFFER,x.vertexPosition,o.DYNAMIC_DRAW)}if(!l){l=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,l);o.bufferData(o.ARRAY_BUFFER,x.vertexColor,o.DYNAMIC_DRAW)}t=i;u=l}}var v=x.relativeHeight||0;o.uniform1f(a,v);var y=x.alpha==undefined?1:x.alpha;o.uniform1f(n,y);var w=x.heightScale==undefined?1:x.heightScale;o.uniform1f(k,w);o.uniform1f(f,x.bottomHeight);var z=new Float32Array(c.mvpMatrix.data);o.uniformMatrix4fv(d,false,z);z=null;o.enableVertexAttribArray(p);o.enableVertexAttribArray(j);o.bindBuffer(o.ARRAY_BUFFER,t);o.vertexAttribPointer(j,3,o.FLOAT,false,0,0);o.bindBuffer(o.ARRAY_BUFFER,u);o.vertexAttribPointer(p,4,o.FLOAT,false,0,0);if(x.renderType==GHConstants.RENDER_TYPE_POLYGON){o.drawArrays(o.TRIANGLES,0,x.vertexPosition.length/3)}else{if(x.renderType==GHConstants.RENDER_TYPE_LINE){var s=x.lineWidth||GHConstants.DEFAULT_LINE_WIDTH;o.lineWidth(s);o.drawArrays(o.LINES,0,x.vertexPosition.length/3)}}Gd.releaseBuffer(o,e);Gd.releaseBuffer(o,b);e=null;b=null;o.disableVertexAttribArray(p);o.disableVertexAttribArray(j)};this.release=function(){Gd.releaseBuffer(o,e);Gd.releaseBuffer(o,b);Gd.releaseBuffer(o,i);Gd.releaseBuffer(o,l);q.release()}};var GR=GR||function(x){var w=new Gf(x.gl);var h,n,z,l,v;var a,s,f,q,y;var b,o,c,s,r,i,p;var e=x;var u=e.gl;var g,m,d;var k="uniform mat4 mvpMatrix; \nuniform mat4 rotateMatrix; \nuniform float rotateAngle;\nuniform vec3 center;\nuniform float heightScale; \nuniform float bottomHeight; \nuniform float relativeHeight; \nuniform float renderFlag;	\nuniform float pxScale;	\nuniform float logoScale;	\nattribute vec3 aVertexPosition; \nattribute vec4 aVertexColor; \nattribute highp vec2 aTextureCoord; \nvarying highp vec2 vTextureCoord; \nvoid main(void) {				\n	vec4 pTan = vec4(aVertexPosition,1.0); \n	if(logoScale < 1.0){ 	\n		pTan.x = (pTan.x - center.x) * logoScale + center.x;	\n		pTan.y = (pTan.y - center.y) * logoScale + center.y;	\n	}													\n	if(renderFlag == 2.0){				\n		pTan.x = center.x + aVertexColor.x * pxScale;	\n		pTan.y = center.y + aVertexColor.y * pxScale;	\n	}									\n	if(rotateAngle != 0.0){	\n		vec4 ct = vec4(center,1.0);	\n		pTan -= ct; \n		pTan.z = 0.0; 	\n		pTan = rotateMatrix *pTan + ct;\n			pTan.z = aVertexPosition.z;	\n		pTan.w = 1.0; \n	} \n	float r = pTan.z - bottomHeight;							\n	pTan.z = bottomHeight + r *heightScale  + relativeHeight; \n	gl_Position = mvpMatrix * pTan;	\n	vTextureCoord = aTextureCoord; \n}		\n";var j=" varying highp vec2 vTextureCoord;		\n uniform sampler2D uSampler; \n void main(void) {		\n		gl_FragColor = texture2D(uSampler, vTextureCoord); \n}	\n";t();function t(){w.createProgram(k,j);if(w.isValid()){w.useProgram();h=w.getUniformLocation("mvpMatrix");a=w.getUniformLocation("relativeHeight");r=w.getUniformLocation("heightScale");i=w.getUniformLocation("bottomHeight");b=w.getUniformLocation("rotateMatrix");o=w.getUniformLocation("rotateAngle");c=w.getUniformLocation("center");y=w.getUniformLocation("renderFlag");s=w.getUniformLocation("pxScale");p=w.getUniformLocation("logoScale");n=w.getAttribLocation("aVertexPosition");z=w.getAttribLocation("aTextureCoord");v=w.getAttribLocation("aVertexColor");l=w.getUniformLocation("uSampler")}}this.render=function(F){if(!w.isValid()){return}if(!F.vertexPosition||F.vertexPosition.length==0){return}w.useProgram();if(!g){g=u.createBuffer()}if(!m){m=u.createBuffer()}if(!d){d=u.createBuffer()}var J=F.relativeHeight||0;var G=F.rotate||0;var A=F.flag||3;var H=F.pxScale||e.calPixelScale();u.uniform1f(a,J);u.uniform1f(o,G);u.uniform1f(y,A);var E=new Float32Array(F.center.data);u.uniform3fv(c,E);u.uniform1f(s,H);var I=F.logoScale||1;u.uniform1f(p,I);var C=F.heightScale==undefined?1:F.heightScale;u.uniform1f(r,C);u.uniform1f(i,F.bottomHeight);var D=new Float32Array(e.mvpMatrix.data);u.uniformMatrix4fv(h,false,D);var B=new Float32Array(F.rotateMatrix.data);u.uniformMatrix4fv(b,false,B);u.enableVertexAttribArray(n);u.enableVertexAttribArray(z);u.enableVertexAttribArray(d);u.bindBuffer(u.ARRAY_BUFFER,d);u.bufferData(u.ARRAY_BUFFER,F.vertexColor,u.DYNAMIC_DRAW);u.vertexAttribPointer(v,4,u.FLOAT,false,0,0);u.bindBuffer(u.ARRAY_BUFFER,g);u.bufferData(u.ARRAY_BUFFER,F.vertexPosition,u.DYNAMIC_DRAW);u.vertexAttribPointer(n,3,u.FLOAT,false,0,0);u.bindBuffer(u.ARRAY_BUFFER,m);u.bufferData(u.ARRAY_BUFFER,F.texturePosition,u.DYNAMIC_DRAW);u.vertexAttribPointer(z,2,u.FLOAT,false,0,0);u.activeTexture(u.TEXTURE0);u.bindTexture(u.TEXTURE_2D,F.textureData);u.uniform1i(l,0);u.drawArrays(u.TRIANGLES,0,F.vertexPosition.length/3);E=null;D=null;B=null;u.disableVertexAttribArray(n);u.disableVertexAttribArray(z);u.disableVertexAttribArray(d);u.bindBuffer(u.ARRAY_BUFFER,null)};this.release=function(){Gd.releaseBuffer(u,g);Gd.releaseBuffer(u,m);Gd.releaseBuffer(u,d);w.release()}};var GS=GS||function(a){var e=new Gf(a.gl);var c=a;var f=c.gl;var d,g;var i;var h="attribute vec3 aVertexPosition; \nattribute highp vec2 aTextureCoord; \nvarying highp vec2 vTextureCoord; \nvoid main(void) {				\n	vec4 pTan = vec4(aVertexPosition,1.0); \n	gl_Position = pTan;	\n	vTextureCoord = aTextureCoord; \n}		\n";var b=" varying highp vec2 vTextureCoord;		\n uniform sampler2D uSampler; \n void main(void) {		\n		gl_FragColor = texture2D(uSampler, vTextureCoord); \n}	\n";j();function j(){e.createProgram(h,b);if(e.isValid()){e.useProgram();d=e.getAttribLocation("aVertexPosition");g=e.getAttribLocation("aTextureCoord");i=e.getUniformLocation("uSampler")}}this.render=function(m){if(!e.isValid()){return}if(!m.vertexPosition||m.vertexPosition.length==0){return}e.useProgram();var l=f.createBuffer();var k=f.createBuffer();f.enableVertexAttribArray(d);f.enableVertexAttribArray(g);f.bindBuffer(f.ARRAY_BUFFER,l);f.bufferData(f.ARRAY_BUFFER,m.vertexPosition,f.DYNAMIC_DRAW);f.vertexAttribPointer(d,3,f.FLOAT,false,0,0);f.bindBuffer(f.ARRAY_BUFFER,k);f.bufferData(f.ARRAY_BUFFER,m.texturePosition,f.DYNAMIC_DRAW);f.vertexAttribPointer(g,2,f.FLOAT,false,0,0);f.activeTexture(f.TEXTURE0);f.bindTexture(f.TEXTURE_2D,m.textureData);f.uniform1i(i,0);f.drawArrays(f.TRIANGLES,0,m.vertexPosition.length/3);Gd.releaseBuffer(f,l);Gd.releaseBuffer(f,k);f.disableVertexAttribArray(d);f.disableVertexAttribArray(g)};this.release=function(){e.release()}};var GT=GT||function(s){var r=new Gf(s.gl);var f,q,l,t,j;var a,n,d,m,e;var c=s;var p=c.gl;var g,k,b;var i="uniform mat4 mvpMatrix; \nuniform float relativeHeight; \nuniform float pxScale;	\nuniform float sameFloor; \nuniform vec3 up; \nuniform vec3 axis; \nattribute vec3 aVertexPosition; \nattribute highp vec2 aTextureCoord; \nvarying highp vec2 vTextureCoord; \nvoid main(void) {				\n	vec4 pTan = vec4(aVertexPosition,1.0); \n	pTan.z = pTan.z + relativeHeight; \n	gl_Position = mvpMatrix * pTan;	\n	vTextureCoord = aTextureCoord; \n}		\n";var h=" varying highp vec2 vTextureCoord;		\n uniform sampler2D uSampler; \n void main(void) {		\n		gl_FragColor = texture2D(uSampler, vTextureCoord); \n}	\n";o();function o(){r.createProgram(i,h);if(r.isValid()){r.useProgram();f=r.getUniformLocation("mvpMatrix");a=r.getUniformLocation("relativeHeight");n=r.getUniformLocation("pxScale");d=r.getUniformLocation("up");m=r.getUniformLocation("axis");e=r.getUniformLocation("sameFloor");l=r.getAttribLocation("aVertexPosition");t=r.getAttribLocation("aTextureCoord");j=r.getUniformLocation("uSampler")}g=p.createBuffer();b=p.createBuffer();k=p.createBuffer()}this.render=function(z){if(!r.isValid()){return}if(!z.vertexPosition||z.vertexPosition.length==0){return}r.useProgram();var x=z.relativeHeight||0;var y=z.sameFloor||1;var w=z.pxScale||c.calPixelScale();p.uniform1f(a,x);p.uniform1f(n,w);var u=new Float32Array(z.up);var v=new Float32Array(z.axis);p.uniform3fv(d,u);p.uniform3fv(m,v);p.uniform1f(e,y);var A=new Float32Array(c.mvpMatrix.data);p.uniformMatrix4fv(f,false,A);p.enableVertexAttribArray(l);p.enableVertexAttribArray(t);p.enableVertexAttribArray(j);p.bindBuffer(p.ARRAY_BUFFER,g);p.bufferData(p.ARRAY_BUFFER,z.vertexPosition,p.DYNAMIC_DRAW);p.vertexAttribPointer(l,3,p.FLOAT,false,0,0);p.bindBuffer(p.ARRAY_BUFFER,k);p.bufferData(p.ARRAY_BUFFER,z.texturePosition,p.DYNAMIC_DRAW);p.vertexAttribPointer(t,2,p.FLOAT,false,0,0);p.activeTexture(p.TEXTURE0);p.bindTexture(p.TEXTURE_2D,z.textureData);p.uniform1i(j,0);p.drawArrays(p.TRIANGLES,0,z.vertexPosition.length/3);u=null;A=null;v=null;p.disableVertexAttribArray(l);p.disableVertexAttribArray(t);p.disableVertexAttribArray(j)};this.release=function(){Gd.releaseBuffer(p,g);Gd.releaseBuffer(p,k);Gd.releaseBuffer(p,b);r.release()}};var GAB=GAB||function(s){var q=new Gf(s.gl);var t=s;var l=t.gl;var e,w,A,F,v,u;var k,D;var z,x,g,i,m,K;var d,a,E,o;var r,C,I;var b;var J={};var c=new Gf(s.gl);var f,h,p;var n="#ifdef GL_FRAGMENT_PRECISION_HIGH                    \nprecision highp float;							      \n#else												  \nprecision mediump float;							  \n#endif												  \n";var B="uniform mat4 mvpMatrix; \nuniform mat4 rttMatrix; \nuniform float bottomHeight; \nuniform float relativeHeight; \nuniform float useRtt; \nuniform vec3  uColor; \nattribute vec3 aVertexPosition; \nattribute vec3 aVertexNomal; \nattribute highp vec2 aTextureCoord; \nvarying highp vec2 vTextureCoord; \nvarying float vRtt; \nvarying vec3 vPosition; \nvarying vec3 vNomal; \nvoid main(void) {				\n	vec4 pTan = vec4(aVertexPosition,1.0); \n	pTan.z = bottomHeight + pTan.z + relativeHeight;  \n	if(useRtt == 1.0){		pTan = rttMatrix * pTan; \n		pTan.w = 1.0;	\n	}	gl_Position = mvpMatrix * pTan;	\n	vTextureCoord = aTextureCoord;	\n	vRtt = useRtt;			\n	vPosition = aVertexPosition;	\n	vNomal = aVertexNomal;	\n}		\n";var y="precision mediump float; \nvarying highp vec2 vTextureCoord; \nvarying float vRtt; \nvarying vec3 vPosition; \nvarying vec3 vNomal; \nuniform vec3  eyeDirection; \nuniform float uUseLight; \nuniform int   uDirLightCount;	\nuniform vec3  uDirLightColor[10];	\nuniform bool  uDirLightKeep[10];	\nuniform vec3  uDirLightDirection[10];\n	uniform int   uPointLightCount;	\nuniform vec3  uPointLightColor[10];	\nuniform bool  uPointLightKeep[10];	\nuniform vec3  uPointLightPosition[10];	\nuniform float  uPointDistance[10];	\nuniform float specularFactor; \nuniform float diffuseMinFactor; \nuniform float diffuseMaxFactor; \nuniform mat4 invMatrix; \n uniform vec3 uAmbient; \n uniform vec3 uDiffuse; \n uniform vec3 uSpecular; \n uniform vec3 uCameraPosition; \n uniform vec3 uSpecularColor; \n uniform sampler2D uSampler; \n uniform float uRenderType; \n void main(void) {		\n	vec4 vDiffuseColor = vec4(1.0);	\n	vec4 vSpecularColor = vec4(1.0);	\n	if(uUseLight == 1.0){	\n		vec3 difColor = vec3(0.0);	\n		vec3 specColor = vec3(0.0);	\n		for(int i = 0; i < 10; i++){	\n			vec3 lightDirection = uDirLightDirection[i];	\n			bool  keep = uDirLightKeep[i];			\n			vec4  dir =  vec4(lightDirection, 0.0);	\n			if(keep) dir = invMatrix * dir;	\n			vec3  invLight =  normalize(dir).xyz;\n			vec3  invEye =  normalize(eyeDirection);\n			vec3  halfLE   = normalize(invLight + invEye);	\n			float diffuse  = clamp(dot(vNomal, invLight), diffuseMinFactor, diffuseMaxFactor); \n			float specular = pow(clamp(dot(vNomal, halfLE), 0.0, 1.0), specularFactor); \n			difColor  +=  uDirLightColor[i] * diffuse;	\n			specColor += specular ;	\n		}	\n		for(int i = 0; i < 10; i++){	\n			vec3 lightDirection = uPointLightPosition[i] - vPosition ;	\n			bool  keep = uPointLightKeep[i];			\n			vec4  dir =  vec4(lightDirection, 0.0);	\n			if(keep) dir = invMatrix * dir;	\n			float lDistance = 1.0;\n				if ( uPointDistance[ i ] > 0.0 )\n				lDistance = 1.0 - min( ( length( dir ) / uPointDistance[ i ] ), 1.0 );\n\n			vec3  invLight =  normalize(dir).xyz;\n			vec3  invEye =  normalize(eyeDirection);\n			vec3  halfLE   = normalize(invLight + invEye);	\n			float diffuse  = clamp(dot(vNomal, invLight), diffuseMinFactor, diffuseMaxFactor); \n			float specular = pow(clamp(dot(vNomal, halfLE), 0.0, 1.0), specularFactor); \n			difColor  +=  uPointLightColor[i] * diffuse * lDistance;	\n			specColor += specular ;	\n		}	\n		vDiffuseColor = vec4(difColor,1.0);	\n		vSpecularColor = vec4(specColor,1.0);	\n	}	\n	vec4 color; \n	vec2 coory = vTextureCoord;	\n	if(uRenderType == 0.0 || (coory.x == -999.0 && coory.y == -999.0)) \n		color = vec4(uSpecular,1.0); \n	else{  \n		color = texture2D(uSampler, coory); \n	} \n	float alpha = color.a;	\n	if(alpha == 0.0) discard; \n	if(vRtt == 1.0) alpha *= 0.8;	\n	if(uUseLight == 1.0)	\n		gl_FragColor = color * vDiffuseColor + vSpecularColor * vec4(uSpecularColor,0.0) + vec4(uAmbient,0.0);\n	else gl_FragColor = color;	gl_FragColor.a = alpha;\n}	\n";var j="attribute vec2 aVertexPosition; \nattribute highp vec2 aTextureCoord; \nvarying highp vec2 vTextureCoord; \nvoid main(void) {				\n	vec4 pTran = vec4(aVertexPosition,0.0,1.0);	\n	gl_Position	= pTran;		\n	vTextureCoord = aTextureCoord; \n}		\n";var H=n+" varying highp vec2 vTextureCoord;		\n uniform sampler2D uSampler; \n void main(void) {		\n	vec4 color = texture2D(uSampler, vTextureCoord); \n	float alpha = color.a;	\n	if(alpha == 0.0) discard;  \n   gl_FragColor = color ; \n}	\n";G();function G(){q.createProgram(B,y);if(q.isValid()){q.useProgram();e=q.getUniformLocation("mvpMatrix");w=q.getUniformLocation("invMatrix");A=q.getUniformLocation("rttMatrix");I=q.getUniformLocation("useRtt");D=q.getUniformLocation("relativeHeight");k=q.getUniformLocation("bottomHeight");a=q.getUniformLocation("specularFactor");E=q.getUniformLocation("diffuseMinFactor");o=q.getUniformLocation("diffuseMaxFactor");F=q.getAttribLocation("aVertexPosition");v=q.getAttribLocation("aVertexNomal");u=q.getAttribLocation("aTextureCoord");z=q.getUniformLocation("uAmbient");x=q.getUniformLocation("uDiffuse");g=q.getUniformLocation("uSpecular");i=q.getUniformLocation("uColor");m=q.getUniformLocation("eyeDirection");K=q.getUniformLocation("uCameraPosition");d=q.getUniformLocation("uUseLight");r=q.getUniformLocation("uSampler");C=q.getUniformLocation("uRenderType");J.uDirLightCount=q.getUniformLocation("uDirLightCount");J.uDirLightColor=q.getUniformLocation("uDirLightColor");J.uDirLightKeep=q.getUniformLocation("uDirLightKeep");J.uDirLightDirection=q.getUniformLocation("uDirLightDirection");J.uPointLightCount=q.getUniformLocation("uPointLightCount");J.uPointLightColor=q.getUniformLocation("uPointLightColor");J.uPointLightKeep=q.getUniformLocation("uPointLightKeep");J.uPointLightPosition=q.getUniformLocation("uPointLightPosition");J.uPointDistance=q.getUniformLocation("uPointDistance");J.uSpecularColor=q.getUniformLocation("uSpecularColor")}c.createProgram(j,H);if(c.isValid()){f=c.getAttribLocation("aVertexPosition");h=c.getAttribLocation("aTextureCoord");p=c.getUniformLocation("uSampler")}}this.start=function(){b=this.createFBO();l.bindFramebuffer(l.FRAMEBUFFER,b);l.bindRenderbuffer(l.RENDERBUFFER,b.depthBuffer)};this.end=function(){l.bindFramebuffer(l.FRAMEBUFFER,null);l.bindRenderbuffer(l.RENDERBUFFER,null)};this.createTexture=function(){var M=l.createTexture();var L=new GF(t.getCamera().width,t.getCamera().height);l.bindTexture(l.TEXTURE_2D,M);l.texImage2D(l.TEXTURE_2D,0,l.RGBA,L.getX(),L.getY(),0,l.RGBA,l.UNSIGNED_BYTE,null);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE);return M};this.useLight=function(){var O=t._getRenderLight();var N=false;if(O.dir){var M=O.dir;l.uniform1i(J.uDirLightCount,M.count);l.uniform3fv(J.uDirLightColor,M.color);l.uniform1iv(J.uDirLightKeep,M.keep);l.uniform3fv(J.uDirLightDirection,M.direction);N=true}if(O.point){var L=O.point;l.uniform1i(J.uPointLightCount,L.count);l.uniform3fv(J.uPointLightColor,L.color);l.uniform1iv(J.uPointLightKeep,L.keep);l.uniform3fv(J.uPointLightPosition,L.position);l.uniform1fv(J.uPointDistance,L.distance);N=true}l.uniform3fv(J.uSpecularColor,t._specucolor);return N};this.render=function(Q){if(!q.isValid()){return}if(!Q.vFlatten||Q.vFlatten.length==0){return}q.useProgram();var P=l.createBuffer();var L=l.createBuffer();var O=l.createBuffer();var R=l.createBuffer();l.uniformMatrix4fv(e,false,new Float32Array(t.mvpMatrix.data));l.uniformMatrix4fv(w,false,new Float32Array(t.invMatrix.data));l.uniformMatrix4fv(A,false,new Float32Array(Q.rttMatrix.data));var T=Q.relativeHeight||0;l.uniform1f(D,T);l.uniform1f(a,t._specularFactor);l.uniform1f(E,t._diffuseMinFactor);l.uniform1f(o,t._diffuseMaxFactor);l.uniform1f(k,Q.bottomHeight);if(Q.useRtt){l.uniform1f(I,1)}else{l.uniform1f(I,0)}Q.ambient=new Float32Array([0,0,0]);l.uniform3fv(z,Q.ambient);l.uniform3fv(x,Q.diffuse);l.uniform3fv(g,Q.specular);l.uniform3fv(K,Q.eye);var M=this.useLight();var S=t.getCamera();var N=S.eye.clone().sub(S.center);l.uniform3fv(m,new Float32Array(N.data));l.enableVertexAttribArray(F);l.enableVertexAttribArray(v);l.enableVertexAttribArray(u);l.bindBuffer(l.ARRAY_BUFFER,P);l.bufferData(l.ARRAY_BUFFER,Q.vFlatten,l.STREAM_DRAW);l.vertexAttribPointer(F,3,l.FLOAT,false,0,0);l.bindBuffer(l.ARRAY_BUFFER,O);l.bufferData(l.ARRAY_BUFFER,Q.tFlatten,l.STREAM_DRAW);l.vertexAttribPointer(u,2,l.FLOAT,false,0,0);l.bindBuffer(l.ARRAY_BUFFER,L);l.bufferData(l.ARRAY_BUFFER,Q.nFlatten,l.STREAM_DRAW);l.vertexAttribPointer(v,3,l.FLOAT,false,0,0);if(Q.useLight&&M){l.uniform1f(d,1)}else{l.uniform1f(d,0)}if(Q.tResult.tDiffuse){l.activeTexture(l.TEXTURE0);l.bindTexture(l.TEXTURE_2D,Q.tResult.tDiffuse);l.uniform1i(r,0);l.uniform1f(C,1)}else{l.uniform1f(C,0)}l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,R);l.bufferData(l.ELEMENT_ARRAY_BUFFER,Q.indices,l.STREAM_DRAW);l.drawElements(l.TRIANGLES,Q.indices.length,l.UNSIGNED_SHORT,0);l.disableVertexAttribArray(F);l.disableVertexAttribArray(v);l.disableVertexAttribArray(u);l.deleteBuffer(P);l.deleteBuffer(L);l.deleteBuffer(O);l.deleteBuffer(R)};this.renderFBO=function(){if(!b){return}c.useProgram();var O=l.createBuffer();var L=l.createBuffer();var N=[-1,-1,-1,1,1,-1,1,1];l.enableVertexAttribArray(f);l.enableVertexAttribArray(h);l.bindBuffer(l.ARRAY_BUFFER,O);l.bufferData(l.ARRAY_BUFFER,new Float32Array(N),l.STREAM_DRAW);l.vertexAttribPointer(f,2,l.FLOAT,false,0,0);var M=[0,0,0,1,1,0,1,1];l.bindBuffer(l.ARRAY_BUFFER,L);l.bufferData(l.ARRAY_BUFFER,new Float32Array(M),l.STREAM_DRAW);l.vertexAttribPointer(h,2,l.FLOAT,false,0,0);l.activeTexture(l.TEXTURE0);l.bindTexture(l.TEXTURE_2D,b.texture);l.uniform1i(p,0);l.drawArrays(l.TRIANGLE_STRIP,0,4);l.disableVertexAttribArray(f);l.disableVertexAttribArray(h);l.deleteBuffer(O);l.deleteBuffer(L);this.release()};this.createFBO=function(){var O=l.createFramebuffer();var M=l.createTexture();var L=new GF(t.getCamera().width,t.getCamera().height);l.bindTexture(l.TEXTURE_2D,M);l.texImage2D(l.TEXTURE_2D,0,l.RGBA,L.getX(),L.getY(),0,l.RGBA,l.UNSIGNED_BYTE,null);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE);O.texture=M;var N=l.createRenderbuffer();l.bindRenderbuffer(l.RENDERBUFFER,N);l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,L.getX(),L.getY());O.depthBuffer=N;l.bindFramebuffer(l.FRAMEBUFFER,O);l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,M,0);l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,N);l.bindFramebuffer(l.FRAMEBUFFER,null);l.bindRenderbuffer(l.RENDERBUFFER,null);return O};this.release=function(){this.deleteFBO()};this.deleteFBO=function(){if(b){l.deleteTexture(b.texture);l.deleteRenderbuffer(b.depthBuffer);l.deleteFramebuffer(b);b=undefined}}};var GAC=GAC||function(a){var g=new Gf(a.gl);var e,f,j,m;var k,h,d;var c=a;var i=c.gl;var l="uniform float imgScale;	\nuniform float screenWidth; \nuniform float screenHeight; \nattribute vec4 aVertexColor; \nattribute vec3 aVertexPosition; \nattribute highp vec2 aTextureCoord; \nvarying highp vec2 vTextureCoord; \nvoid main(void) {				\n	float realScale = imgScale;	\n	float width = realScale * aVertexColor.x;	\n	float height = realScale * aVertexColor.y;	\n	float px = (aVertexPosition.x + width) / screenWidth; \n	float py = 1.0 - (aVertexPosition.y - height) / screenHeight;	\n	px = (px - 0.5) * 2.0;	\n	py = (py - 0.5) * 2.0;	\n	gl_Position  = vec4(px,py,1.0, 1.0); \n	vTextureCoord = aTextureCoord; \n}		\n";var b=" varying highp vec2 vTextureCoord;		\n uniform sampler2D uSampler; \n void main(void) {		\n		gl_FragColor = texture2D(uSampler, vTextureCoord); \n}	\n";n();function n(){g.createProgram(l,b);if(g.isValid()){g.useProgram();d=g.getUniformLocation("imgScale");k=g.getUniformLocation("screenWidth");h=g.getUniformLocation("screenHeight");e=g.getAttribLocation("aVertexColor");f=g.getAttribLocation("aVertexPosition");j=g.getAttribLocation("aTextureCoord");m=g.getUniformLocation("uSampler")}}this.render=function(s){if(!g.isValid()){return}if(!s.vertexPosition||s.vertexPosition.length==0){return}g.useProgram();var q=i.createBuffer();var p=i.createBuffer();var o=i.createBuffer();var r=s.imgScale||1;i.uniform1f(d,r);i.uniform1f(k,c.getCamera().width);i.uniform1f(h,c.getCamera().height);i.enableVertexAttribArray(e);i.enableVertexAttribArray(f);i.enableVertexAttribArray(j);i.bindBuffer(i.ARRAY_BUFFER,q);i.bufferData(i.ARRAY_BUFFER,s.vertexPosition,i.STREAM_DRAW);i.vertexAttribPointer(f,3,i.FLOAT,false,0,0);i.bindBuffer(i.ARRAY_BUFFER,p);i.bufferData(i.ARRAY_BUFFER,s.vertexColor,i.STREAM_DRAW);i.vertexAttribPointer(e,4,i.FLOAT,false,0,0);i.bindBuffer(i.ARRAY_BUFFER,o);i.bufferData(i.ARRAY_BUFFER,s.texturePosition,i.STREAM_DRAW);i.vertexAttribPointer(j,2,i.FLOAT,false,0,0);i.activeTexture(i.TEXTURE0);i.bindTexture(i.TEXTURE_2D,s.textureData);i.uniform1i(m,0);i.drawArrays(i.TRIANGLES,0,s.vertexPosition.length/3);i.disableVertexAttribArray(e);i.disableVertexAttribArray(f);i.disableVertexAttribArray(j);Gd.releaseBuffer(i,q);Gd.releaseBuffer(i,o);Gd.releaseBuffer(i,p)};this.release=function(){g.release()}};var GU=GU||function(A){var c=A;var u=A.gl;var b=new Array();var w=new Array();var t=new Array();var q=new Array();var k=new Array();var m=new Array();var e=new GP(A);var z=0;var j=0;var g=document.createElement("canvas");var f=g.getContext("2d");this.type="poi_image";var p=new GF(0,1);var B=new GF(0,0);var y=new GF(1,0);var d=new GF(1,1);m.push(p);m.push(B);m.push(y);m.push(y);m.push(p);m.push(d);var l=Gd.flatten(m);Gd.releaseObjectArray(m);var o=-1;var s=this;this.add=function(D,C,E){D.height=C;if(this.type=="poi_image"){v(D,C)}else{if(this.type=="poi_text"){n(D,C)}else{if(this.type=="marker"){i(D,C,E)}else{if(this.type=="location"){i(D,C,E)}}}}};this.getObjectSize=function(){return b.length};this.getObject=function(C){return b[C]};function n(E,D){var C=x(E,GHConstants.DEFAULT_SPACE_FONT_SCALE);k.push(C.texture);a(E,C.canvas.width,C.canvas.height,D)}function x(L){var M;var J=1;var H=3;var G="red";if(s.type=="marker"||s.type=="location"){H=L.getFontScale();M=L.getText();G=L.getFontColor()}else{var T=c.getStyleByTypeAndCode(GD.TYPE.POI,L.t);if(T){J=T.fill==1?1:0;if(T.shade){H=T.shade}if(T.color&&T.color.length>0){G="";if(T.color.charAt(0)!="#"){G+="#"}G+=T.color}}if(c.isShowChinese()){M=L.n||"";if(M==""){M=L.on||""}}else{M=L.on||"";if(M==""){M=L.n||""}}}var C=10*H*Gd.getDevicePixelRatio()*GHConstants.DEFAULT_TEXT_SCALE;var U='"Microsoft Yahei","微软雅黑",Tahoma,Arial';var D=C+"px "+U;f.font=D;var P=3;if(J==1){var R=f.measureText(M);g.height=C+10;g.width=R.width+7}else{var Q=f.measureText("国").width;var N=Q*M.length;g.width=Q;g.height=N+7+(M.length-1)*P}f.clearRect(0,0,g.width,g.height);f.textAlign="center";f.textBaseline="middle";f.font=D;f.fillStyle=G;f.strokeStyle="white";f.strokeWidth=GHConstants.DEFAULT_TEXT_STROKE_WIDTH;if(J==1){var I=g.width/2;var O=g.height/2;if(s.type!="marker"&&s.type!="location"&&GHConstants.DEFAULT_TEXT_STROKE_WIDTH>0){f.strokeText(M,I,O)}f.fillText(M,I,O)}else{var F=g.width/2,E;for(var S=0;S<M.length;S++){var U=M.charAt(S);E=g.width/2+5+S*g.width+P*S;f.strokeText(U,F,E);f.fillText(U,F,E)}}var K=u.createTexture();u.bindTexture(u.TEXTURE_2D,K);u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,g);u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR);u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE);u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE);u.bindTexture(u.TEXTURE_2D,null);return{texture:K,canvas:g}}function v(F,C){var E=F.style;var D=F.t+"";var G=GHConstants.IMAGE_PRE+D+".png";z++;c._imageTextureLoader.load(G,function(I,H){if(I){a(F,I.width,I.height,C)}z--;if(z==0){c.updatePoi();c.refresh()}},{},Gd.getDevicePixelRatio()*c.getImageScale()/2)}this.clearMark=function(){Gd.releaseObjectArray(b);Gd.releaseObjectArray(w);Gd.releaseObjectArray(t);Gd.releaseObjectArray(q);Gd.releaseTextureArray(u,k)};function i(F,C,E){var D=F.getImageSrc();F.visible=true;j++;c._imageTextureLoader.load(D,function(H,G){j--;if(H){a(F,H.width,H.height,C);r(F,C);if(E){E()}if(j==0){c.refresh()}}else{r(F,C);a(F,0,0,C)}},{},Gd.getDevicePixelRatio())}function r(F,D){var E=F.getText();if(F.getTextPosition()==GHMark.TextPosition.NONE||!E||E==""){k.push(undefined)}else{var C=x(F);k.push(C.texture);a(F,C.canvas.width,C.canvas.height,D,true)}q.push(w.length)}function a(L,S,O,V,F){var I=S/2;var P=O/2;L.visible=true;if(L.getHeight){V+=L.getHeight()}if(!F){b.push(L)}if(F){L.textWidth=S;L.textHeight=O}else{L.imageWidth=S;L.imageHeight=O}var K,J;var Y=0;if(s.type=="marker"||s.type=="location"){var U=L.getPoint();K=U.x;J=U.y;Y=L.getAngle()==undefined||0;if(Y!=0){Y=Gd.angleToRadians(Y)}}else{K=L.x;J=L.y}var R;if(V<0){R=new GH(K,J,0)}else{R=new GH(K,J,V)}var M,aa,C,Q;if(s.type=="marker"||s.type=="location"){var G=L.getAnchor();var E=L.getTextPosition();var Z=L.getOffSetX();var X=L.getOffsetY();var N;var D,H;var N=3;var W=1;if(L.getImageScale&&L.getImageScale()>0){W=L.getImageScale()}if(F){switch(E){case GHMark.TextPosition.RIGHT:D=N+L.imageWidth*W/2;H=-L.textHeight/2;break;case GHMark.TextPosition.LEFT:D=-N-L.imageWidth*W/2-L.textWidth;H=-L.textHeight/2;break;case GHMark.TextPosition.TOP:D=-L.textWidth/2;H=N+L.imageHeight*W/2;break;case GHMark.TextPosition.BOTTOM:D=-L.textWidth/2;H=-L.imageHeight*W/2-N-L.textHeight;break}if(!H){return}if(G==GHMark.Anchor.BOTTOM){H+=L.imageHeight*W/2}D+=Z;H+=X;M=new GI(D,H,0,0);aa=new GI(D,H+L.textHeight,0,0);Q=new GI(D+L.textWidth,H,0,0);C=new GI(D+L.textWidth,H+L.textHeight,0,0)}else{var T=s.type=="marker"?(L.isFlat()===true?1:0):(GHConstants.LOC_STATE==1?1:0);if(V==-999){T=1}if(G==GHMark.Anchor.CENTER){M=new GI(-I,-P,Y,T);aa=new GI(-I,P,Y,T);C=new GI(I,P,Y,T);Q=new GI(I,-P,Y,T)}else{if(G==GHMark.Anchor.BOTTOM){M=new GI(-I,0,Y,T);aa=new GI(-I,O,Y,T);C=new GI(I,O,Y,T);Q=new GI(I,0,Y,T)}}M.setX(M.getX()+Z);aa.setX(aa.getX()+Z);C.setX(C.getX()+Z);Q.setX(Q.getX()+Z);M.setY(M.getY()+X);aa.setY(aa.getY()+X);C.setY(C.getY()+X);Q.setY(Q.getY()+X)}}else{M=new GI(-I,-P,0,0);aa=new GI(-I,P,0,0);C=new GI(I,P,0,0);Q=new GI(I,-P,0,0)}w.push(R);w.push(R);w.push(R);w.push(R);w.push(R);w.push(R);t.push(M);t.push(aa);t.push(C);t.push(C);t.push(M);t.push(Q);if(s.type!="marker"&&s.type!="location"){q.push(w.length)}}this.updatePositionByIndex=function(J,L,H,C){if(J<0||J>=this.getObjectSize()){return false}var D=b[J];var K=Gd.getIndicatesStartEnd(J,q);var G=c._getFloorHeightByName(H)+D.getHeight();if(L.z!=undefined){G+=L.z}var I=new GH(L.x,L.y,G);for(var F=K[0];F<K[1];F++){w[F].set(I)}var E=b[J];E.vFlatten=undefined;E.tvFlatten=undefined;return true};this.updatePositionByObject=function(F,E,D,G){var C=b.indexOf(F);if(C>-1){return this.updatePositionByIndex(C,E,D,G)}return false};this.updateAngleByIndex=function(C,G){if(C<0||C>=this.getObjectSize()){return false}var E=Gd.getIndicatesStartEnd(C,q);for(var D=E[0];D<E[1];D++){t[D].setZ(G)}var F=b[C];F.cFlatten=undefined;F.tcFlatten=undefined;return true};this.updateAngleByObject=function(D,E){var C=b.indexOf(D);if(C>-1){return this.updateAngleByIndex(C,E)}return false};this.removeMarkByIndex=function(D){if(D<0||D>=b.length){return false}var F=Gd.getIndicatesStartEnd(D,q);var C=F[1]-F[0];b.splice(D,1);for(var E=D+1;E<q.length;E++){q[E]-=C}q.splice(D,1);w.splice(F[0],C);t.splice(F[0],C);k.splice(D,1);return true};this.removeMark=function(D){var C=b.indexOf(D);if(C>-1){return this.removeMarkByIndex(C)}return false};this.indexOf=function(C){return b.indexOf(C)};this.render=function(K,M){M=M==undefined?false:M;var E=this.type=="marker";var G=Gd.clone(K);var O=c.getCamera().extent;for(var L=0;L<b.length;L++){var J=b[L];if(!J.visible){continue}G.imageScale=1;var P=Gd.getIndicatesStartEnd(L,q);var R;if(E||this.type=="location"){if(E){var H=J.getVisible();if(H){var D=J.getPoint();if(O.minx>D.x||O.maxx<D.x||O.miny>D.y||O.maxy<D.y){H=false}}if(!H){continue}}if(J.getImageScale){G.imgScale=J.getImageScale()}var F=P[0];var I=P[0]+6;var N=J.vFlatten;if(!N){N=Gd.flatten(w.slice(F,I));J.vFlatten=N}var Q=J.cFlatten;if(!Q){Q=Gd.flatten(t.slice(F,I));J.cFlatten=Q}R=c._imageTextureLoader.get(J.getImageSrc());G.textureData=R;G.vertexPosition=N;G.vertexColor=Q;G.texturePosition=l;G.offsetZ=J.getOffsetZ();G.keepOffset=J.isKeepOffset();e.render(G);G.imgScale=1;F=I;I=P[1];if(J.getIsShowText()&&F!=I&&I!=undefined){N=J.tvFlatten;if(!N){N=Gd.flatten(w.slice(F,I));J.tvFlatten=N}Q=J.tcFlatten;if(!Q){Q=Gd.flatten(t.slice(F,I));J.tcFlatten=Q}R=k[L];G.textureData=R;G.vertexPosition=N;G.vertexColor=Q;G.texturePosition=l;e.render(G)}}else{if(this.type=="poi_image"){var C=GHConstants.IMAGE_PRE+J.t+".png";R=c._imageTextureLoader.get(C);G.imgScale=J.imageScale}else{if(this.type=="poi_text"){R=k[L]}}var N=J.vFlatten;if(!N){N=Gd.flatten(w.slice(P[0],P[1]));J.vFlatten=N}var Q=J.cFlatten;if(!Q){Q=Gd.flatten(t.slice(P[0],P[1]));J.cFlatten=Q}G.textureData=R;G.vertexPosition=N;G.vertexColor=Q;G.texturePosition=l;e.render(G)}}};this.updatePoi=function(C,E){for(var D=0;D<b.length;D++){var F=b[D];F.visible=true;if(Gd.rectContains(E,F.x,F.y)){h(F);if(F.visible){if(Gd.intersects(F.extent,C)){F.visible=false}else{C.push(F.extent)}}}else{F.visible=false}}};function h(L){var E=L.getHeight?L.getHeight():GHConstants.FLOOR_HEIGHT;var P=E*c._getHeightScale();var M=c.gp2px(L.x,L.y,P);var S,R,Q,K;var T=L.angle||0;var O=new GK();O.rotate(-T,new GH(0,0,1));var J=L.imageWidth/2;var N=L.imageHeight/2;R=new GH(-J,-N,0);S=new GH(-J,N,0);Q=new GH(J,N,0);K=new GH(J,-N,0);if(T!=0){R.multMat4(O);S.multMat4(O);Q.multMat4(O);K.multMat4(O)}var C=1;var D={};var G=M.x;var F=M.y;var I=(R.getX()>Q.getX()?Q.getX():R.getX());var H=(S.getX()>K.getX()?K.getX():S.getX());D.minx=G+(I>H?H:I)*C-1;I=(R.getX()<Q.getX()?Q.getX():R.getX());H=(S.getX()<K.getX()?K.getX():S.getX());D.maxx=G+(I<H?H:I)*C+1;I=(R.getY()>Q.getY()?Q.getY():R.getY());H=(S.getY()>K.getY()?K.getY():S.getY());D.miny=F+(I>H?H:I)*C-1;I=(R.getY()<Q.getY()?Q.getY():R.getY());H=(S.getY()<K.getY()?K.getY():S.getY());D.maxy=F+(I<H?H:I)*C+1;L.extent=D}this.release=function(){this.clearMark();Gd.releaseObjectArray(m);e.release()};this.searchPoiByCode=function(E){for(var D=0;D<b.length;D++){var F=b[D];if(F.service==E){var C={};C.name=F.n||"";C.oname=F.on||"";C.type=F.t;C.x=F.x;C.y=F.y;C.service=F.s||"";C.code=F.s||"";return C}}return undefined};this._clickSelect=function(P,N,ac,I){var Y=[];if(b.length==0){if(I){return Y}else{return undefined}}var ab=c.calPixelScale();var af=c.getCamera();var H=af.axis;var ai=af.up;H.normalize();ai.normalize();var R=af._getRay(P,N);var ag=s.type=="marker";var U=1;var J=-1;var F=[];for(var ae=b.length-1;ae>=0;ae--){var S=b[ae];if(!S.visible){continue}var G=S.getHeight?S.getHeight():GHConstants.FLOOR_HEIGHT;var X=G*c._getHeightScale();var M=S.imageWidth/2;var V=S.imageHeight/2;var ak,C,E,W;ak=-M;C=M;var P,N;if(ag){P=S.getPoint().x;N=S.getPoint().y;var K=S.getAnchor();if(K==GHMark.Anchor.CENTER){E=V;W=-V}else{if(K==GHMark.Anchor.BOTTOM){E=S.imageHeight;W=0}}var aj=S.getOffSetX();var ah=S.getOffsetY();ak+=aj;C+=aj;E+=ah;W+=ah;U=S.getImageScale()||1}else{E=V;W=-V;P=S.x;N=S.y;U=S.imageScale||1}ak*=ab*U;C*=ab*U;E*=ab*U;W*=ab*U;var T=new GH(P,N,X+c.getCurFloorHeight());var O=H.clone().multNum(ak).clone().add(ai.clone().multNum(E)).clone().add(T);var D=H.clone().multNum(ak).clone().add(ai.clone().multNum(W)).clone().add(T);var Z=H.clone().multNum(C).clone().add(ai.clone().multNum(E)).clone().add(T);var ad=H.clone().multNum(C).clone().add(ai.clone().multNum(W)).clone().add(T);var L=R.intersectTriangle(D,O,ad);if(!L){L=R.intersectTriangle(ad,O,Z)}if(L){J=ae;F.push(ae);if(!I){break}}}if(!I){if(J!=-1){if(this.type=="poi_image"||this.type=="poi_text"){var S=b[J];if(!ac){if(this.type=="poi_image"){S.imageScale=1.5;o=J}return}else{var Q={};Q.name=S.n||"";Q.oname=S.on||"";Q.type=S.t;Q.x=S.x;Q.y=S.y;Q.service=S.s||"";Q.code=S.s||"";return Q}}return b[J]}}else{for(var aa=0;aa<F.length;aa++){Y.push(b[F[aa]])}}if(I){return Y}return undefined};this._clearSelect=function(){if(o!=-1&&this.type!="marker"){var C=b[o];C.imageScale=1}o=-1}};var GV=GV||function(a){var d=a;var e=new GQ(d);this.type=GD.TYPE.DEC_LINE;var j=new Array();var g=new Array();var c=new Array();var l=new Array();var f=new Array();var i=new Array();var h;var b={solid:[],dotted:[]};this.add=function(A,y){h=y;l.push(A);var n=A.getStyle();var q="fill";var m="color";var z="shade";if(this.type=GD.TYPE.OVERLAY){q="solid";m="strokeColor";z="strokeWidth"}var u=Gd.getJsonValue(n,q,1);var v=Gd.getJsonValue(n,m,GHConstants.DEFAULT_LINE_COLOR);v=Gd.getVector4FromColorStr(v);var t=Gd.getJsonValue(n,z,GHConstants.DEFAULT_LINE_WIDTH);var s=A.getData();for(var r=0;r<s.length-1;r++){var x;var p=s[r].z==undefined?y:s[r].z;if(r==0){x=new GH(s[r].x,s[r].y,p)}else{x=j[j.length-1]}var o=s[r+1].z==undefined?y:s[r+1].z;var w=new GH(s[r+1].x,s[r+1].y,o);j.push(x);j.push(w);g.push(v);g.push(v)}i.push(u);f.push(t);c.push(j.length)};this.updateFlatten=function(){b.solid.length=0;for(var o=0;o<l.length;o++){if(i[o]==1){var p=Gd.getIndicatesStartEnd(o,c);var m=f[o];var r=k(b.solid,m);if(r==null){r={lineWidth:m,vertexFlatten:undefined,colorFlatten:undefined};b.solid.push(r)}var q=Gd.flatten(j.slice(p[0],p[1]));var n=Gd.flatten(g.slice(p[0],p[1]));r.vertexFlatten=Gd.addArrayData(r.vertexFlatten,q);r.colorFlatten=Gd.addArrayData(r.colorFlatten,n)}}};this.removeByIndex=function(n){if(n<0||n>=l.length){return false}var p=Gd.getIndicatesStartEnd(n,c);var m=p[1]-p[0];l.splice(n,1);for(var o=n+1;o<c.length;o++){c[o]-=m}c.splice(n,1);j.splice(p[0],m);g.splice(p[0],m);f.splice(n,1);i.splice(n,1);return true};this.remove=function(m){var n=l.indexOf(m);if(n>-1){return this.removeByIndex(n)}return false};this._clickSelect=function(u,t){var n=10;var r=-1;for(var q=0;q<l.length;q++){var v=l[q].getData();var s=false;for(var p=0;p<v.length-1;p++){var m=v[p];m=d.gp2px(m.x,m.y);var o=v[p+1];o=d.gp2px(o.x,o.y);var w=Gd.pointDisToSegment(u,t,m.x,m.y,o.x,o.y);if(w.distance<=n){s=true;break}}if(s){r=q;break}}if(r>-1){return l[r]}return undefined};this.updateDottedFlatten=function(){b.dotted.length=0;var F=d.calPixelScale();var q=GHConstants.DOTTED_LENGTH*F;for(var D=0;D<l.length;D++){if(i[D]==0){var G=Gd.getIndicatesStartEnd(D,c);var m=f[D];var y=k(b.dotted,m);if(y==null){y={lineWidth:m,vertexFlatten:undefined,colorFlatten:undefined};b.dotted.push(y)}var p=[];var w=[];for(var C=G[0];C<G[1]-1;C++){var o=j[C];var n=j[C+1];var E=g[D];var z=n.clone().sub(o);var r=z.length();var A=r/F;var u=A/GHConstants.DOTTED_LENGTH;z.normalize();z.multNum(q);var t=o.clone();var s=o.clone();u=parseInt(u);if(u==0){p.push(o);p.push(n);w.push(E);w.push(E)}else{for(var B=0;B<u;B++){s.add(z);if(B%2==0){p.push(t.clone());p.push(s.clone());w.push(E);w.push(E)}t.add(z)}}}var v=Gd.flatten(p);var x=Gd.flatten(w);y.vertexFlatten=Gd.addArrayData(y.vertexFlatten,v);y.colorFlatten=Gd.addArrayData(y.colorFlatten,x)}}};function k(n,m){for(var o=0;o<n.length;o++){if(n[o].lineWidth==m){return n[o]}}return null}this.render=function(p){var o=Gd.clone(p);o.renderType=GHConstants.RENDER_TYPE_LINE;var m=b.solid;if(m){for(var n=0;n<m.length;n++){var q=m[n];o.vertexPosition=q.vertexFlatten;o.vertexColor=q.colorFlatten;o.lineWidth=q.lineWidth;e.updateLineBuffer(o);e.render(o)}}m=b.dotted;if(m){for(var n=0;n<m.length;n++){var q=m[n];o.vertexPosition=q.vertexFlatten;o.vertexColor=q.colorFlatten;o.lineWidth=q.lineWidth;e.updateLineBuffer(o);e.render(o)}}};this.clear=function(){Gd.releaseObjectArray(j);Gd.releaseObjectArray(g);Gd.releaseObjectArray(c);Gd.releaseObjectArray(l);Gd.releaseObjectArray(f);Gd.releaseObjectArray(i);b.solid.length=0;b.dotted.length=0};this.release=function(){Gd.releaseObjectArray(j);Gd.releaseObjectArray(g);Gd.releaseObjectArray(c);Gd.releaseObjectArray(l);Gd.releaseObjectArray(f);Gd.releaseObjectArray(i);b.solid.length=0;b.dotted.length=0;e.release()}};var GW=GW||function(a){var e=a;var g=new GQ(e);var o=new Array();var l=new Array();var f=new Array();var d=new Array();var h=new Array();var m=new Array();var j=new Array();this.type;var k=Gd.getVector4FromColorStr(GHConstants.DEFAULT_SPACE_BOTTOM_COLOR);var c,b,i,n;this.add=function(y,E,p){o.push(y);var v=true;var q=false;var A="color";var D="color";if(this.type==GD.TYPE.OVERLAY){A="fillColor";D="strokeColor"}var x=Gd.getJsonValue(y.getStyle(),A,GHConstants.DEFAULT_FILL_COLOR);x=Gd.getVector4FromColorStr(x);var t=y.getData();var w=E;var r=GTP.triangulate(t);if(y.getOffsetZ&&y.getOffsetZ()){w=y.getOffsetZ()}for(var s=0;s<r.length;s++){var F=r[s];var C=new GH(F.a.x,F.a.y,w);var B=new GH(F.b.x,F.b.y,w);var z=new GH(F.c.x,F.c.y,w);l.push(C);l.push(B);l.push(z);f.push(x);f.push(x);f.push(x);r[s]=null}r.length=0;d.push(l.length);if(v){x=Gd.getJsonValue(y.getStyle(),D,GHConstants.DEFAULT_LINE_COLOR);x=Gd.getVector4FromColorStr(x);for(var s=0;s<t.length;s++){var C;if(s==0){C=new GH(t[s].x,t[s].y,E)}else{C=h[h.length-1]}var u=s+1;if(u==t.length){u=0}var B=new GH(t[u].x,t[u].y,E);h.push(C);h.push(B);m.push(x);m.push(x)}}j.push(h.length)};this.updateFlatten=function(){if(c){c.length=0}if(b){b.length=0}if(i){i.length=0}if(n){n.length=0}c=Gd.flatten(l);b=Gd.flatten(f);i=Gd.flatten(h);n=Gd.flatten(m);var p={};p.vertexPosition=c;p.vertexColor=b;g.updatePolygonBuffer(p);p.vertexPosition=i;p.vertexColor=n;g.updateLineBuffer(p)};this.clearHighlight=function(){this.highlight([])};this.highlight=function(q){var z="color";if(this.type==GD.TYPE.OVERLAY){z="fillColor"}for(var t=0;t<o.length;t++){var s=o[t];var x=Gd.getJsonValue(s.getStyle(),z,GHConstants.DEFAULT_FILL_COLOR);x=Gd.getVector4FromColorStr(x);var w=Gd.getIndicatesStartEnd(t,d);var p=w[0];f[p].set(x)}for(var t=0;t<q.length;t++){var s=q[t];var y=typeof s;var v=-1;switch(y){case"object":v=o.indexOf(s);break;case"string":for(var r=0;r<o.length;r++){if(s==o[r].getCode()){v=r;break}}break;case"number":v=s;break}if(v>=0){var u=e.highlightColor;u=Gd.getVector4FromColorStr(u);var w=Gd.getIndicatesStartEnd(v,d);var p=w[0];f[p].set(u)}}this.updateFlatten();e.refresh()};this._clickSelect=function(r,v){var q;var s=-1;var u=e.px2gp(r,v);for(var t=0;t<o.length;t++){if(o[t].geometry.contains(u.x,u.y)){s=t;break}}if(s!=-1){q=o[s]}return q};this.removeByIndex=function(q){if(q<0||q>=o.length){return false}var s=Gd.getIndicatesStartEnd(q,d);var p=s[1]-s[0];o.splice(q,1);for(var r=q+1;r<d.length;r++){d[r]-=p}d.splice(q,1);l.splice(s[0],p);f.splice(s[0],p);s=Gd.getIndicatesStartEnd(q,j);p=s[1]-s[0];for(var r=q+1;r<j.length;r++){j[r]-=p}j.splice(q,1);h.splice(s[0],p);m.splice(s[0],p);return true};this.remove=function(q){var p=o.indexOf(q);if(p>-1){return this.removeByIndex(p)}return false};this.clear=function(){Gd.releaseObjectArray(o);Gd.releaseObjectArray(l);Gd.releaseObjectArray(f);Gd.releaseObjectArray(d);Gd.releaseObjectArray(h);Gd.releaseObjectArray(m);Gd.releaseObjectArray(j);Gd.releaseObjectArray(c);Gd.releaseObjectArray(b);Gd.releaseObjectArray(i);Gd.releaseObjectArray(n)};this.render=function(q){if(!c){return}var p=Gd.clone(q);p.alpha=e.opAlpha;p.vertexPosition=c;p.vertexColor=b;p.renderType=GHConstants.RENDER_TYPE_POLYGON;g.render(p);p.vertexPosition=i;p.vertexColor=n;p.renderType=GHConstants.RENDER_TYPE_LINE;g.render(p)};this.release=function(){Gd.releaseObjectArray(o);Gd.releaseObjectArray(l);Gd.releaseObjectArray(f);Gd.releaseObjectArray(d);Gd.releaseObjectArray(h);Gd.releaseObjectArray(m);Gd.releaseObjectArray(j);Gd.releaseObjectArray(c);Gd.releaseObjectArray(b);Gd.releaseObjectArray(i);Gd.releaseObjectArray(n);g.release()}};var GX=GX||function(D,g){var e=D;var x=e.gl;this.type=g||"space";var f=new GQ(e);var i=new GQ(e);var E=new GR(e);var b=new Array();var y=new Array();var v=new Array();var u=new Array();var h=new Array();var p=new Array();var s=new Array();var k=new Array();var d=new Array();var l=new Array();var r=new Array();var t,C,o,n,z,j;var B=new GZ(D);B.type="space_text";var m=new GZ(D);m.type="logo";this._floorLayer;this.height=0;var q=-1;var w=Gd.getVector4FromColorStr(GHConstants.DEFAULT_SPACE_BOTTOM_COLOR);var a=w.clone().setW(GHConstants.DEFAULT_WALL_ALPHA);var A=new Array();this.add=function(ah,aa){var am=ah.polygon.getData();if(am.length==0){return}var Y=undefined;if(ah.t){Y=Gd.getJsonFromArray(e._baseStyle,"type",ah.t)}if(Y){var L=Gd.getJsonValue(Y,"visible",true);if(!L){return}}b.push(ah);ah.sideImage_vFlatten=undefined;ah.sideImage_cFlatten=undefined;ah.sideImage_tFlatten=undefined;ah.sideImage_texture=undefined;var W={minx:Number.MAX_VALUE,miny:Number.MAX_VALUE,maxx:-1,maxy:-1};var aj=undefined;if(Y){aj=Gd.getJsonValue(Y,"color")}if(!aj){aj=Gd.getJsonValue(ah.polygon.getStyle(),"color",GHConstants.DEFAULT_FILL_COLOR)}aj=Gd.getVector4FromColorStr(aj);var S=aj.clone().setW(GHConstants.DEFAULT_WALL_ALPHA);var ae=Gd.getJsonValue(ah.polygon.getStyle(),"fill",false)||this.type=="areaface";var Z=false;var M=false;var I=undefined;if(Y){I=Gd.getJsonValue(Y,"height")}if(!I){I=Gd.getJsonValue(ah.polygon.getStyle(),"height",1)}if(this.type=="decface"){if(ah.t>=600000&&ah.t<=610000){I=0}else{if(ah.t>=666666||ah.t<600000){}else{I=0;Z=true}}}else{if(this.type=="areaface"){Z=true}}var ab=GHConstants.FLOOR_HEIGHT*I;ah.rHeight=ab;if(ae||!ah.t){var ac=GTP.triangulate(am);var H=aa+ab;for(var af=0;af<ac.length;af++){var ad=ac[af];if(!ad){continue}var K=new GH(ad.a.x,ad.a.y,H);var J=new GH(ad.b.x,ad.b.y,H);var G=new GH(ad.c.x,ad.c.y,H);y.push(K);y.push(J);y.push(G);if(Gd.isWall(ah.t)){v.push(S);v.push(S);v.push(S)}else{v.push(aj);v.push(aj);v.push(aj)}delete ac[af];ac[af]=null}ac.length=0;delete ac;ac=null}u.push(y.length);var R=Gd.isRoad(ah.t);var O={};var ag=0;var ai=Gd.addColor(aj,-35);for(var af=0;af<am.length-1;af++){var an=am[af];var al=am[af+1];if(R){var V=al.x-an.x;var U=al.y-an.y;var X=V*V+U*U;if(X>ag){ag=X;O.p1=an;O.p2=al;O.dx=V;O.dy=U}}W.minx=Math.min(W.minx,an.x);W.miny=Math.min(W.miny,an.y);W.maxx=Math.max(W.maxx,an.x);W.maxy=Math.max(W.maxy,an.y);if(I>0){M=true;var K=new GH(an.x,an.y,aa);var J=new GH(al.x,al.y,aa);var G=new GH(al.x,al.y,H);var F=new GH(an.x,an.y,H);h.push(K);h.push(J);h.push(G);h.push(K);h.push(G);h.push(F);if(Gd.isWall(ah.t)){p.push(a);p.push(a);p.push(S);p.push(a);p.push(S);p.push(S)}else{p.push(ai);p.push(ai);p.push(aj);p.push(ai);p.push(aj);p.push(aj)}}}if(R){var ak=V==0?Math.PI/2:Math.atan2(U,V);if(ak<0){ak+=2*Math.PI}ah.edgeAngle=ak}var an=am[am.length-1];W.minx=Math.min(W.minx,an.x);W.miny=Math.min(W.miny,an.y);W.maxx=Math.max(W.maxx,an.x);W.maxy=Math.max(W.maxy,an.y);ah.extent=W;s.push(h.length);if(this.type=="space"||Z){if(this.type=="space"){aj=Gd.getVector4FromColorStr(GHConstants.DEFAULT_SPACE_LINE_COLOR)}else{if(this.type=="decface"){aj=Gd.getVector4FromColorStr(GHConstants.DEFAULT_DECFACE_LINE_COLOR)}else{aj=Gd.getVector4FromColorStr(GHConstants.DEFAULT_LINE_COLOR)}}for(var af=0;af<am.length-1;af++){var Q=af+1;var K,J;var N=H+Gd.calRelativeHeight(H,0.2);if(af==0){K=new GH(am[af].x,am[af].y,N)}else{K=k[k.length-1]}J=new GH(am[Q].x,am[Q].y,N);k.push(K);k.push(J);d.push(aj);d.push(aj)}l.push(k.length)}var T;if(e.isShowChinese()){T=ah.n||"";if(T==""){T=ah.on||""}}else{T=ah.on||"";if(T==""){T=ah.n||""}}T=T==""||Gd.isForbid(ah.t)||Gd.isDecArea(ah.t);if(!T){setTimeout(function(){B.add(ah,H+Gd.calRelativeHeight(H,0.2))},0)}if(e._loadSkin){if(M&&ah.t&&ah.t!=""){var P=GHConstants.IMAGE_PRE+"skin/"+ah.t+".png";var am={index:b.length-1};setTimeout(function(){e._imageTextureLoader.load(P,c,am,1,true)},200)}}};function c(S,ac){if(!S){return}var O=b[ac.index];O.sideImage=true;A.push(ac.index);var ad=Gd.getIndicatesStartEnd(ac.index,s);for(var X=ad[0];X<ad[1];X++){p[X].setW(0)}var N=Gd.flatten(p);var Q={};Q.vertexColor=N;i.updatePolygonBuffer(Q);var R=h[ad[0]+2].getZ()-h[ad[0]].getZ();var L=S.width;var aa=S.height;var Y=Gd.toFixed(R/aa);var J=h.slice(ad[0],ad[1]);var M=new Array();var K=new Array();var V=O.polygon.getData();for(var X=0;X<V.length-1;X++){var H=V[X];var F=V[X+1];var T=Gd.getDistance(H.x,H.y,F.x,F.y);var G=Gd.toFixed(T/L);var U=new GF(0,Y);var ab=new GF(0,0);var Z=new GF(G,0);var I=new GF(G,Y);var P=new GI();for(var W=0;W<6;W++){M.push(P)}K.push(U);K.push(I);K.push(Z);K.push(U);K.push(Z);K.push(ab)}O.sideImage_vFlatten=Gd.flatten(J);O.sideImage_cFlatten=Gd.flatten(M);O.sideImage_tFlatten=Gd.flatten(K);O.sideImage_texture=S.texture;setTimeout(function(){e.refresh()},0)}this.addWallLine=function(F,G,K,R,H){r.push(H);var J=Gd.getVector4FromColorStr(GHConstants.DEFAULT_SPACE_LINE_COLOR);var N=R+Gd.calRelativeHeight(R,0.2);var Q=new GH(F[0],F[1],N);var P=new GH(G[0],G[1],N);var O=new GH(F[0],F[1],K);var M=new GH(F[0],F[1],R);var L=new GH(G[0],G[1],K);var I=new GH(G[0],G[1],N);k.push(Q);k.push(P);k.push(O);k.push(M);k.push(L);k.push(I);d.push(J);d.push(J);d.push(J);d.push(J);d.push(J);d.push(J);l.push(k.length)};this.setCodeLogo=function(I,F,K){for(var G=0;G<b.length;G++){var J=b[G];if(J.code==I){J.logo=F;J.angle=K;var H=this.height+J.rHeight;m.add(J,H+Gd.calRelativeHeight(H,0.2));return true}}return false};this.searchSpaceByCode=function(H){for(var G=0;G<b.length;G++){var I=b[G];if(I.code==H){var F={};F.oname=I.on||"";F.name=I.n||"";F.code=I.code||"";F.type=I.t;F.x=I.x;F.y=I.y;F.height=I.rHeight;F.offsetZ=I.rHeight;F.radius=B._getMDis(I);return F}}return undefined};this.updateFlatten=function(){if(t){t.length=0}if(C){t.length=0}if(o){t.length=0}if(n){t.length=0}if(z){t.length=0}if(j){t.length=0}t=Gd.flatten(y);C=Gd.flatten(v);o=Gd.flatten(h);n=Gd.flatten(p);z=Gd.flatten(k);j=Gd.flatten(d)};this.render=function(J){var I=Gd.clone(J);I.vertexPosition=o;I.vertexColor=n;I.renderType=GHConstants.RENDER_TYPE_POLYGON;i.render(I);for(var H=0;H<A.length;H++){var K=b[A[H]];if(!K){continue}I.textureData=K.sideImage_texture;I.vertexPosition=K.sideImage_vFlatten;I.texturePosition=K.sideImage_tFlatten;I.vertexColor=K.sideImage_cFlatten;I.center=new GH(0,0,0);I.rotate=0;I.rotateMatrix=new GK();E.render(I)}I.vertexPosition=t;I.vertexColor=C;I.renderType=GHConstants.RENDER_TYPE_POLYGON;f.render(I);var G=I.relativeHeight;var F=I.showArea;if(!e.is3DAll()){x.blendFuncSeparate(x.ONE,x.ONE_MINUS_SRC_ALPHA,x.ONE,x.ONE_MINUS_SRC_ALPHA);I.relativeHeight=G+0.4;if(this.type=="areaface"){if(F){m.render(I);this.renderSpaceMark(I)}}else{if(this.type=="space"){if(!F){m.render(I);this.renderSpaceMark(I)}}else{I.type="decface";m.render(I);this.renderSpaceMark(I)}}x.blendFunc(x.SRC_ALPHA,x.ONE_MINUS_SRC_ALPHA)}if(this.type=="space"){if(!I.showArea&&(e._getHeightScale()<=0.1||!e._isFade())){I.relativeHeight=G+0.2;I.vertexPosition=z;I.vertexColor=j;I.renderType=GHConstants.RENDER_TYPE_LINE;f.render(I)}}else{I.relativeHeight=Gd.toFixed(G);I.vertexPosition=z;I.vertexColor=j;I.renderType=GHConstants.RENDER_TYPE_LINE;f.render(I)}};this.renderSpaceMark=function(F){B.render(F)};this.updatePoi=function(F,G){B.updatePoi(F,G,e.calPixelScale(),e.getRotate())};this.getObjectSize=function(){return b.length};this.getObject=function(F){return b[F]};this.showCode=function(G){for(var I=0;I<b.length;I++){var L=b[I];L._visible=true;if(G.indexOf(L.code)<0){L._visible=false;var K=Gd.getIndicatesStartEnd(I,u);for(var F=K[0];F<K[1];F++){v[F].setW(0)}K=Gd.getIndicatesStartEnd(I,s);for(var F=K[0];F<K[1];F++){p[F].setW(0)}if(r.length==0){K=Gd.getIndicatesStartEnd(I,l);for(var F=K[0];F<K[1];F++){d[F].setW(0)}}}else{L._visible=true;var K=Gd.getIndicatesStartEnd(I,u);for(var F=K[0];F<K[1];F++){v[F].setW(1)}K=Gd.getIndicatesStartEnd(I,s);for(var F=K[0];F<K[1];F++){p[F].setW(1)}if(r.length==0){K=Gd.getIndicatesStartEnd(I,l);for(var F=K[0];F<K[1];F++){d[F].setW(1)}}}}if(r.length>0){for(var I=0;I<r.length;I++){var H=r[I];if(G.indexOf(H[0])<0&&G.indexOf(H[1])<0){var K=Gd.getIndicatesStartEnd(I,l);for(var F=K[0];F<K[1];F++){d[F].setW(0)}}else{var K=Gd.getIndicatesStartEnd(I,l);for(var F=K[0];F<K[1];F++){d[F].setW(1)}}}}this.updateFlatten();if(this.type=="space"){var J={vertexColor:C};f.updatePolygonBuffer(J);J.vertexColor=n;i.updatePolygonBuffer(J)}else{if(this.type=="space_line"){var J={vertexColor:j};f.updateLineBuffer(J)}}};this._clickSelect=function(S,R,U,W){var T;var P=-1;var F={};if(e._getHeightScale()>0.1){for(var ad=0;ad<b.length;ad++){var V=b[ad];if(V._visible==false){continue}if(W&&!Gd.isDecArea(V.t)){continue}var Y=F[V.rHeight.toFixed(2)];if(!Y){Y=e.px2gp(S,R,V.rHeight);F[V.rHeight.toFixed(2)]=Y}if(V.geometry.contains(Y.x,Y.y)){P=ad;break}}if(P==-1){var af=e.getCamera().screenToWorld(S,R,0.99999999);var ag=e.getCamera().screenToWorld(S,R,1e-8);var Q=10000000;for(var ad=0;ad<b.length;ad++){var V=b[ad];if(V._visible==false){continue}if(W&&!Gd.isDecArea(V.t)){continue}var aa=V.rHeight;var ai=V.polygon.getData();for(var ac=0;ac<ai.length;ac++){var I=ai[ac];var M=new GH(I.x,I.y,this.height);var L=new GH(I.x,I.y,this.height+aa);var H;if(ac==ai.length-1){H=ai[0]}else{H=ai[ac+1]}var K=new GH(H.x,H.y,this.height+aa);var J=new GH(H.x,H.y,this.height);var Z=Gd.getPointToPolygonCross(ag,af,M,L,K);if(Z){if(Gd.isPointInPolygon(Z,M,L,K,J)){var ah=new GH(V.x,V.y,this.height);var ab=e.getCamera().eye.clone().sub(ah).length();if(Q>ab){Q=ab;P=ad}}}}}}}if(P==-1){Y=e.px2gp(S,R,0);for(var ad=0;ad<b.length;ad++){if(b[ad]._visible==false){continue}if(W&&!Gd.isDecArea(b[ad].t)){continue}if(b[ad].geometry.contains(Y.x,Y.y)){P=ad;break}}}if(P!=-1&&Gd.isForbid(b[P].t)){return T}if(P!=-1&&U){var V=b[P];T={};T.name=V.n||"";T.oname=V.on||"";T.type=V.t;T.x=V.x;T.y=V.y;T.code=V.code||"";T.offsetZ=V.rHeight;return T}if(P!=-1){var G=Gd.getVector4FromColorStr(e.getSelectSpaceColor());if(v.length==0){return}var aj=Gd.getIndicatesStartEnd(P,u);var O=aj[0];var N=aj[1];v[O].set(G);aj=Gd.getIndicatesStartEnd(P,s);O=aj[0];N=aj[1];if(O+2<=N){var ae=Gd.addColor(G,-35);p[O].set(G);p[O+2].set(G)}C=Gd.flatten(v);n=Gd.flatten(p);var X={vertexColor:C};f.updatePolygonBuffer(X);X.vertexColor=n;i.updatePolygonBuffer(X);q=P;T=true}return T};this._clearSelect=function(){if(q!=-1){var I=b[q];var L;if(I.highlight){L=D.highlightColor}else{if(I.countColor){L=I.countColor}else{L=Gd.getJsonValue(I.polygon.getStyle(),"color",GHConstants.DEFAULT_FILL_COLOR)}}L=Gd.getVector4FromColorStr(L);var H=Gd.getIndicatesStartEnd(q,u);var K=H[0];var F=H[1];v[K].set(L);H=Gd.getIndicatesStartEnd(q,s);K=H[0];F=H[1];if(A.indexOf(q)==-1){if(K+2<F){var J=Gd.addColor(L,-35);p[K].set(J);p[K+2].set(L)}}C=Gd.flatten(v);n=Gd.flatten(p);var G={vertexColor:C};f.updatePolygonBuffer(G);G.vertexColor=n;i.updatePolygonBuffer(G);q=-1;return true}q=-1;return false};this.release=function(){Gd.releaseObjectArray(b);Gd.releaseObjectArray(y);Gd.releaseObjectArray(v);Gd.releaseObjectArray(u);Gd.releaseObjectArray(h);Gd.releaseObjectArray(p);Gd.releaseObjectArray(s);Gd.releaseObjectArray(k);Gd.releaseObjectArray(d);Gd.releaseObjectArray(l);Gd.releaseObjectArray(r);f.release();m.release();i.release();B.release();E.release()};this.setColorByCode=function(P){var V=false;for(var S=0;S<b.length;S++){var M=b[S];var I=Gd.getJsonValue(M.polygon.getStyle(),"height",1);var O=GHConstants.FLOOR_HEIGHT*I;var X=Gd.getIndicatesStartEnd(S,u);var K=X[0];var J=X[1];var T=Gd.getIndicatesStartEnd(S,s);var L=T[0];var W=T[1];var G=false;var H=Gd.getJsonValue(M.polygon.getStyle(),"color",GHConstants.DEFAULT_FILL_COLOR);H=Gd.getVector4FromColorStr(H);v[K].set(H);delete M.count;delete M.countHeight;delete M.countColor;if(!M.code||M.code==""){continue}for(var R=0;R<P.length;R++){if(P[R].code==M.code){if(P[R].count){V=true;M.count=P[R].count;M.countColor=P[R].color}if(P[R].height){M.countHeight=P[R].height;G=true}var H=P[R].colorValue;v[K].set(H);p[L+2].set(H);break}}var U=M.countHeight||1;M.rHeight=O*U;var F=this.height+M.rHeight;for(var Q=K;Q<J;Q++){y[Q].setZ(F)}for(var Q=L;Q<W;Q+=6){h[Q+2].setZ(F);h[Q+5].setZ(F)}}C=Gd.flatten(v);n=Gd.flatten(p);t=Gd.flatten(y);o=Gd.flatten(h);var N={vertexColor:C,vertexPosition:t};f.updatePolygonBuffer(N);N.vertexColor=n;N.vertexPosition=o;i.updatePolygonBuffer(N);if(V){this.updateLanguage()}};this.clearHighlight=function(){this.highlight([])};this.highlight=function(F){for(var K=0;K<b.length;K++){var J=b[K];if(!J.code||J.code==""){continue}var M=false;for(var I=0;I<F.length;I++){if(F[I]==J.code){M=true;break}}var L;if(M){L=D.highlightColor;J.highlight=true}else{L=Gd.getJsonValue(b[K].polygon.getStyle(),"color",GHConstants.DEFAULT_FILL_COLOR);J.highlight=undefined}L=Gd.getVector4FromColorStr(L);var N=Gd.getIndicatesStartEnd(K,u);var G=N[0];end=N[1];v[G].set(L);N=Gd.getIndicatesStartEnd(K,s);G=N[0];end=N[1];p[G+2].set(L)}C=Gd.flatten(v);n=Gd.flatten(p);var H={vertexColor:C};f.updatePolygonBuffer(H);H.vertexColor=n;i.updatePolygonBuffer(H);e.refresh()};this.getMinMax=function(){var G=Number.MAX_VALUE;var F=G;var M=Number.MIN_VALUE;var L=M;for(var I=0;I<b.length;I++){var K=b[I].polygon.getData();for(var H=0;H<K.length;H++){var J=K[H];G=Math.min(G,J.x);F=Math.min(F,J.y);M=Math.max(M,J.x);L=Math.max(L,J.y)}}return{minx:G,miny:F,maxx:M,maxy:L}};this.updateLanguage=function(){B.clear();for(var G=0;G<b.length;G++){var I=b[G];var F;if(e.isShowChinese()){F=I.n||"";if(F==""){F=I.on||""}}else{F=I.on||"";if(F==""){F=I.n||""}}F=F==""||Gd.isForbid(I.t);delete I.vFlatten;delete I.tFlatten;delete I.cFlatten;if(!F){var H=this.height+I.rHeight;B.add(I,H+0.1)}}}};var GY=GY||function(t,u,d){var a=t;this.floorName=u;this.height=0;this.floorNum=d;this.index=0;var s=new GW(a);var k=new GX(a,"decface");var c=new GX(a,"areaface");var o=new GV(a);var f=new GU(a);var b=new GX(a,"decface");var e=new GAA(a);var n=new GCL(a);var m=new GU(a);m.type="poi_text";var h=[];var l=new GX(a);var p=new GX(a,"space_line");var q=new GW(a);q.type=GD.TYPE.OVERLAY;var g=new GU(a);g.type="marker";var j=new GV(a);j.type=GD.TYPE.OVERLAY;var r=this;this.render=function(w){var z=a.gl;var y={center:w,relativeHeight:GHConstants.RENDER_FLOOR_HEIGHT,pxScale:a.getCamera().calPixelScale(),bottomHeight:this.height,heightScale:a._getHeightScale()};var v=a._onlyShowArea||c.getObjectSize()>0&&a.getCamera().showAreaFace();y.showArea=v;y.relativeHeight=GHConstants.RENDER_FLOOR_HEIGHT;s.render(y);y.relativeHeight=GHConstants.RENDER_DECFACE_HEIGHT;b.render(y);k.render(y);if(!a._onlyShowArea){y.relativeHeight=GHConstants.RENDER_SPACE_HEIGHT;l.render(y)}var x=false;y.alpha=a._onlyShowArea==true?1:a.getCamera().getAreaFaceAlpha();if(v&&y.alpha>0&&!a.is3DAll()){y.relativeHeight=GHConstants.RENDER_AREAFACE_HEIGHT+2;c.render(y);x=true}y.alpha=1;y.relativeHeight=GHConstants.RENDER_SPACE_HEIGHT;if(!x&&a._getHeightScale()>0.1){p.render(y)}y.relativeHeight=GHConstants.RENDER_DECLINE_HEIGHT;o.render(y);y.relativeHeight=GHConstants.RENDER_OVERLAY_POLYGON_HEIGHT;q.render(y);j.render(y)};this.renderObj=function(w){var x={center:w,relativeHeight:0,bottomHeight:this.height,heightScale:a._getHeightScale()};var v=a._onlyShowArea||c.getObjectSize()>0&&a.getCamera().showAreaFace();if(!v){x.rttMatrix=GK.makeRtt(0,0,1,this.height);e.render(x)}};this.renderOutDoor=function(v){var w={center:v,relativeHeight:GHConstants.RENDER_DECFACE_HEIGHT,bottomHeight:this.height,heightScale:a._getHeightScale()};b.render(w)};this.addFloor=function(v){s.add(v,this.height);s.updateFlatten()};this.addData=function(I){this.geom=I.g;var F=I.g;var G=Gd.dataArrayToPolygon(F);G.setStyle(a.getStyleByTypeAndCode(GD.TYPE.FLOOR,this.floorName));this.addFloor(G);delete I.g;var A=I.s;for(var y=0;y<A.length;y++){this.addSpace(A[y])}l.updateFlatten();var D=this.height;var K;var E=D+0.1;var C,B;if(a._isFade()){var H=I.sl;var J=I.slt;for(var y=0;y<H.length;y+=2){var w=H[y];var x=H[y+1];var v=Gd.getJsonFromArray(a._baseStyle,"type",J[y]);if(!v){v=a.getStyleByTypeAndCode(GD.TYPE.SPACE,J[y])}C=Gd.getJsonValue(v,"height",1);v=Gd.getJsonFromArray(a._baseStyle,"type",J[y+1]);if(!v){v=a.getStyleByTypeAndCode(GD.TYPE.SPACE,J[y+1])}B=Gd.getJsonValue(v,"height",1);K=E+Math.min(C,B)*GHConstants.FLOOR_HEIGHT;var z=[];z.push(J[y]);z.push(J[y+1]);p.addWallLine(w,x,D,K,z)}p.updateFlatten()}delete I.sl;delete I.slt};this.addDecFace=function(v){var w=Gd.dataArrayToPolygon(v.g);w.setStyle(a.getStyleByTypeAndCode(GD.TYPE.DEC_FACE,v.t));w.type=v.t;v.polygon=w;if(w.type>=666666){b.add(v,this.height)}else{v.geometry=new GL();v.geometry.setData(w.getData());k.add(v,this.height)}delete v.g};this.addAreaFace=function(v){var w=Gd.dataArrayToPolygon(v.g);w.setStyle(a.getStyleByTypeAndCode(GD.TYPE.AREA_FACE,v.t));w.type=v.t;v.polygon=w;c.add(v,this.height);delete v.g};this.addDecLine=function(w){var v=Gd.dataArrayToLine(w.g);v.setStyle(a.getStyleByTypeAndCode(GD.TYPE.DEC_LINE,w.t));o.add(v,this.height);delete w.g};this.updateDecLineFlatten=function(){o.updateFlatten();o.updateDottedFlatten()};this.updateDecLineDottedFlatten=function(){o.updateDottedFlatten();j.updateDottedFlatten()};this.updateDecFaceFlatten=function(){k.updateFlatten();b.updateFlatten()};this.updateAreaFaceFlatten=function(){c.updateFlatten()};this.addSpace=function(w){var v=Gd.dataArrayToPolygon(w.g);v.setStyle(a.getStyleByTypeAndCode(GD.TYPE.SPACE,w.t));w.polygon=v;w.geometry=new GL();w.geometry.setData(v.getData());l.add(w,this.height);delete w.g;delete w.fn};this.updateLanguage=function(){l.updateLanguage();c.updateLanguage();m.clearMark();for(var v=0;v<h.length;v++){var w=h[v];delete w.vFlatten;delete w.cFlatten;m.add(w,this.height+GHConstants.FLOOR_HEIGHT)}};this.addPubPoi=function(v){if(v.t.length>0){var w=v.t.charAt(0);if(w=="1"){f.add(v,this.height+GHConstants.FLOOR_HEIGHT)}else{if(w=="0"){m.add(v,this.height+GHConstants.FLOOR_HEIGHT);h.push(v)}}}};this.renderPoi=function(w){var z=a.gl;var x=a.getCamera();var y={center:w,relativeHeight:GHConstants.RENDER_FLOOR_HEIGHT,up:x.up.data,axis:x.axis.data,pxScale:x.calPixelScale(),bottomHeight:this.height,heightScale:a._getHeightScale()};var v=a._onlyShowArea||c.getObjectSize()>0&&a.getCamera().showAreaFace();z.blendFuncSeparate(z.ONE,z.ONE_MINUS_SRC_ALPHA,z.ONE,z.ONE_MINUS_SRC_ALPHA);if(!a._onlyShowObj){if(!v&&a.isPubPoiVisible()){f.render(y)}}if(!v){m.render(y);g.render(y)}n.render(y);z.blendFunc(z.SRC_ALPHA,z.ONE_MINUS_SRC_ALPHA)};this.renderDepthPoi=function(w){var z=a.gl;var x=a.getCamera();var y={center:w,relativeHeight:GHConstants.RENDER_FLOOR_HEIGHT,up:x.up.data,axis:x.axis.data,pxScale:x.calPixelScale(),bottomHeight:this.height,heightScale:a._getHeightScale()};var v=a._onlyShowArea||c.getObjectSize()>0&&a.getCamera().showAreaFace();if(!v){g.render(y,true)}};this.addOverlayPolygon=function(w){w.geometry=new GL();var v=w.getData();w.geometry.setData(v);q.add(w,this.height+GHConstants.FLOOR_HEIGHT);q.updateFlatten()};this.removeOverlayPolygon=function(v){if(q.remove(v)){q.updateFlatten();return true}return false};this.clearOverlayPolygon=function(){q.clear();q.updateFlatten()};this.addOverlayMark=function(v){g.add(v,this.height+GHConstants.FLOOR_HEIGHT)};this.removeOverlayMark=function(v){return g.removeMark(v)};this.clearOverlayMark=function(){g.clearMark()};this._updateMark=function(w,v,x){g.updatePositionByObject(w,v,this.floorName,x)};this._updateMarkAngle=function(v,w){var x=g.updateAngleByObject(v,Gd.angleToRadians(w));if(x){a.refresh()}};this._indexOfMark=function(v){return g.indexOf(v)};this.addOverlayLine=function(v){j.add(v,this.height+GHConstants.FLOOR_HEIGHT);j.updateFlatten();j.updateDottedFlatten()};this.removeOverlayLine=function(v){if(j.remove(v)){j.updateFlatten();j.updateDottedFlatten();return true}return false};this.clearOverlayLine=function(){j.clear();j.updateFlatten();j.updateDottedFlatten()};this.setClusters=function(v){n.setObjects(v)};this.setClusterFontScale=function(v){n.setFontScale(v)};this.setClusterRadius=function(v){n.setRadius(v)};this.setClusterFillColor=function(v){n.setFillColor(v)};this.setClusterAnimationColor=function(v){n.setAnimationColor(v)};this.setClusterSleepTime=function(v){n.setSleepTime(v)};this.setClusterFontColor=function(v){n.setTextColor(v)};this.addClusterLegendColor=function(v){n.addFillLegendColor(v.min,v.max,v.color)};this.clearClusterLegendColor=function(){n.clearFillLegendColor()};this.clearCluster=function(){n.clear()};this.updateClusterFlatten=function(){n.update()};this.addClusterGroup=function(v){n.addGroup(v)};this.setClusterTextGap=function(v){n.setTextGap(v)};this.clearGroup=function(v){n.clearGroup()};this.searchSpace=function(C,v,B){var A=l;if(B){A=c}var E=[];var D=A.getObjectSize();for(var z=0;z<D;z++){var x=true;var y=A.getObject(z);if(C&&""!=C){x=y.t&&y.t.indexOf(C)>-1}if(x&&v&&""!=v){x=y.n&&y.n.indexOf(v)>-1}if(x){var w={};w.name=y.n||"";w.oname=y.on||"";w.x=y.x;w.y=y.y;w.type=y.t||"";w.fname=this.floorName;w.code=y.code||"";w.offsetZ=y.rHeight||0;E.push(w)}}return E};this.searchPoi=function(z,x){var v=i(z,x,true);var w=i(z,x);for(var y=0;y<w.length;y++){v.push(w[y])}return v};this.showCode=function(v){l.showCode(v);p.showCode(v)};function i(C,v,z){var E=[];var A=f;if(z){A=m}var D=A.getObjectSize();for(var y=0;y<D;y++){var w=true;var x=A.getObject(y);if(C&&""!=C){w=x.t&&x.t.indexOf(C)>-1}if(w&&v&&""!=v){w=x.n&&x.n.indexOf(v)>-1}if(w){var B={};B.name=x.n||"";B.oname=x.on||"";B.x=x.x;B.y=x.y;B.type=x.t||"";B.service=x.s||"";B.fname=r.floorName;B.code=x.s||"";E.push(B)}}return E}this.updatePoi=function(){var w=[];var x=Gd.rectExpandNew(a.getCamera().extent,-10,-10);var v=a._onlyShowArea||c.getObjectSize()>0&&a.getCamera().showAreaFace();if(!v){m.updatePoi(w,x);f.updatePoi(w,x);l.updatePoi(w,x)}k.updatePoi(w,x);b.updatePoi(w,x);if(v&&!a.is3DAll()){c.updatePoi(w,x)}};this._clickSelect=function(v,w){l._clickSelect(v,w,false);f._clickSelect(v,w,false);return true};this._selectSpace=function(w,A,z){var v=l._clickSelect(w,A,z);if(v){v.fname=this.floorName}return v};this._selectDecArea=function(w,z){var v=k._clickSelect(w,z,true,true);if(v){v.fname=this.floorName}return v};this._selectPoi=function(v,A,z){var w=m._clickSelect(v,A,z);if(!w){w=f._clickSelect(v,A,z)}if(w){w.fname=this.floorName}return w};this._selectMarker=function(v,w){return g._clickSelect(v,w)};this._codeSelectMarker=function(v,w){return g._clickSelect(v,w,false,true)};this._selectPolygon=function(v,w){return q._clickSelect(v,w)};this._selectLine=function(v,w){return j._clickSelect(v,w)};this._selectCluster=function(v,w){return n._clickSelect(v,w)};this.setCodeLogo=function(w,v,x){return l.setCodeLogo(w,v,x)};this.searchSpaceByCode=function(v){var w=l.searchSpaceByCode(v);if(w){w.fname=this.floorName}return w};this.searchPoiByCode=function(v){var w=f.searchPoiByCode(v);if(w){w.fname=this.floorName}return w};this._clearSelect=function(){l._clearSelect();f._clearSelect();return false};this.release=function(){s.release();k.release();o.release();f.release();m.release();l.release();p.release();q.release();g.release();j.release();b.release();c.release();n.release();e.release()};this.setHeight=function(v){this.height=v;l.height=v;c.height=v;n._height=v};this.addObjData=function(v){e.setData(v);a.refresh()};this.setAreaColorByCode=function(w,v){var x=this;setTimeout(function(){if(w==1){c.setColorByCode(v)}else{l.setColorByCode(v)}x.updatePoi();a.refresh()},0)};this.highlightSpace=function(v){setTimeout(function(){l.highlight(v)},0)};this.highlightArea=function(v){setTimeout(function(){c.highlight(v)},0)};this.highlightOverlayPolygon=function(v){setTimeout(function(){q.highlight(v)},0)};this.clearHighlight=function(){setTimeout(function(){c.clearHighlight();l.clearHighlight();q.clearHighlight()},0)};this.getAreaMinMax=function(){return c.getMinMax()};this._getWorldCoord=function(x,w){var v=e.getWorldCoord(x,w,this.height);if(v){v.setZ(v.getZ()-this.height)}return v};this.updateClusterPosition=function(){n.updatePosition()};this.setClusterHeight=function(v){n.setHeight(v)};this._getPiexls=function(){var x=[];for(var y=0;y<this.geom.length;y++){var w=this.geom[y];var z=a.gp2px(w[0],w[1]);x.push(z)}return new GL(x)}};var GZ=GZ||function(u){var b=u;var p=u.gl;var a=new Array();var q=new Array();var o=new Array();var n=new Array();var t=new Array();var i=new Array();var k=new GR(u);var e=document.createElement("canvas");var d=e.getContext("2d");this.type="space_text";var l=new GF(0,1);var v=new GF(0,0);var s=new GF(1,0);var c=new GF(1,1);this.add=function(x,w){x.height=w;if("space_text"==this.type){j(x,w)}else{if("logo"==this.type){g(x,w)}}};function j(O,K){a.push(O);O.visible=false;var G;if(b.isShowChinese()){G=O.n||"";if(G==""){G=O.on||""}}else{G=O.on||"";if(G==""){G=O.n||""}}var E=r(G,GHConstants.DEFAULT_SPACE_FONT_SCALE,O.count);O.textWidth=E.canvas.width;O.textHeight=E.canvas.height;var x,B,z,A,y,C;x=m(O);if(Gd.isRoad(O.t)){C=f(x,E.canvas.width,E.canvas.height);x=C.width*3;O.minDis=x}else{C=h(x,E.canvas.width,E.canvas.height)}var M=C.width;var N=C.height;B=O.x-M;A=O.x+M;z=O.y-N;y=O.y+N;var F=window.devicePixelRatio||1;var L;if(/[\u4e00-\u9fa5]/.test(G)){L=150/F}else{L=265/F}if(!b.isShowChinese()){L*=2}var Q=b.getCamera().calPixelScale();Q=x/Q/G.length/b.getCamera().width;Q*=L;Q/=Math.pow(2,b.getZoom()-2);O.zoomLength=b.getCamera().zoomLength*Q*1.3*u.fontScale;O.minZoomLength=u.getCamera().zoomLength*Q*0.5*u.fontScale;t.push(E.texture);var H=new GH(B,z,K);var P=new GH(B,y,K);var w=new GH(A,y,K);var J=new GH(A,z,K);q.push(H);q.push(P);q.push(w);q.push(w);q.push(H);q.push(J);var D=e.width/2;var I=e.height/2;o.push(new GI(-D,-I,0,0));o.push(new GI(-D,I,0,0));o.push(new GI(D,I,0,0));o.push(o[o.length-1]);o.push(o[o.length-4]);o.push(new GI(D,-I,0,0));i.push(l);i.push(v);i.push(s);i.push(s);i.push(l);i.push(c);n.push(q.length)}function m(A){var w=Number.MAX_VALUE;if(!A.minDis){var z=A.polygon.getData();var C={x:A.x,y:A.y};for(var y=0;y<z.length-1;y++){var D=z[y];var B=z[y+1];if(!eqPoint(D,B)){var x=Gd.pointToLineDistance(C,D,B);if(x<w){w=x}}}A.minDis=w}else{w=A.minDis}return w}this._getMDis=m;function h(x,y,w){var C=y*1/w;var A=x;var z=x;if(C>1){z/=C}else{if(C<1){A*=C}}var B=0.8;A*=B;z*=B;return{width:A,height:z}}function f(y,z,x){var w=y*0.95;var A=w*z/x;return{width:A,height:w}}function g(x,w){var y=new Image();y.crossOrigin="Anonymous";y.onload=function(){a.push(x);var N=p.createTexture();p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);p.bindTexture(p.TEXTURE_2D,N);p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,this);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);p.bindTexture(p.TEXTURE_2D,null);p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);x.imageWidth=this.width;x.imageHeight=this.height;var K=m(x);var z=h(K,this.width,this.height);var J=z.width;var G=z.height;var M=x.x-J;var H=x.x+J;var L=x.y-G;var F=x.y+G;t.push(N);var I=new GH(M,L,w);var B=new GH(M,F,w);var D=new GH(H,F,w);var A=new GH(H,L,w);q.push(I);q.push(B);q.push(D);q.push(D);q.push(I);q.push(A);var C=this.width/2;var E=this.height/2;o.push(new GI(-C,-E,0,0));o.push(new GI(-C,E,0,0));o.push(new GI(C,E,0,0));o.push(o[o.length-1]);o.push(o[o.length-4]);o.push(new GI(C,-E,0,0));i.push(l);i.push(v);i.push(s);i.push(s);i.push(l);i.push(c);x.showLogo=true;n.push(q.length);b.updatePoi();b.refresh()};y.src=x.logo}function r(I,D,C){var J=10*D*Gd.getDevicePixelRatio();var F='"Microsoft Yahei","微软雅黑",Tahoma,Arial';var y=J+"px "+F;d.font=y;var z=d.measureText(I);var w=z.width+5;var H=J+10;var G=H;if(C){z=d.measureText(C+"");var A=z.width+5;w=Math.max(w,A);H=H+H}e.width=w;e.height=H;d.save();d.clearRect(0,0,e.width,e.height);d.textAlign="center";d.textBaseline="middle";var B=e.width/2;var E=G/2;d.font=y;if(GHConstants.DEFAULT_SPACE_TEXT_SHOW_STROKE){d.strokeStyle=GHConstants.DEFAULT_SPACE_TEXT_STROKE_COLOR;d.lineWidth=GHConstants.DEFAULT_SPACE_TEXT_STROKE_WIDTH;d.strokeText(I,B,E);if(C){d.strokeText(C+"",B,E+G)}}d.fillStyle=GHConstants.DEFAULT_SPACE_TEXT_COLOR;d.fillText(I,B,E);if(C){d.fillText(C,B,E+G)}d.restore();var x=p.createTexture();p.bindTexture(p.TEXTURE_2D,x);p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,e);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);p.bindTexture(p.TEXTURE_2D,null);return{texture:x,canvas:e}}this.updatePoi=function(F,E){var B=b.getCamera().eye.clone();var w=b.getCamera().center.clone();var C=B.clone().sub(w).length();var x=new GH();var y;var D=new GH();for(var A=0;A<a.length;A++){var z=a[A];if(z._visible==false){z.visible=false;continue}x.setValue(z.x,z.y,z.height);z.visible=true;D.set(B);D.sub(x);y=D.length();if(!z.showLogo&&z.zoomLength&&y>z.zoomLength&&y>b.getCamera().minLength*2){z.visible=false}else{if(!Gd.rectContains(E,z.x,z.y)){z.visible=false}else{if(z.showLogo){z.logoScale=1}else{z.logoScale=C/z.minZoomLength;if(z.logoScale>u._fontScale2){z.logoScale=u._fontScale2}}}}}};this.render=function(A){var w=Gd.clone(A);var y=b.getRotate();y=Gd.angleToRadians(y);var C=y;var x=new GK();var J=this.type=="space_text";if(J){x.rotate(C,new GH(0,0,1))}for(var B=0;B<a.length;B++){var z=a[B];if(!z.visible){continue}if(J&&z.showLogo){continue}var E=Gd.getIndicatesStartEnd(B,n);var I=t[B];C=y;if(Gd.isRoad(z.t)){x=new GK();C=y-z.edgeAngle;if(C<0){C+=Math.PI*2}if(C>Math.PI/2&&C<Math.PI*3/2){x.rotate(z.edgeAngle+Math.PI,new GH(0,0,1));C=z.edgeAngle+Math.PI}else{x.rotate(z.edgeAngle,new GH(0,0,1));C=z.edgeAngle}}else{if(this.type=="logo"){if(z.angle){x.identity();C=Gd.angleToRadians(z.angle);x.rotate(C,new GH(0,0,1))}}}var H="vFlatten";if(!J){H="logo_"+H}var D=z[H];if(!D){D=Gd.flatten(q.slice(E[0],E[1]));z[H]=D}H="tFlatten";if(!J){H="logo_"+H}var G=z[H];if(!G){G=Gd.flatten(i.slice(E[0],E[1]));z[H]=G}H="cFlatten";if(!J){H="logo_"+H}var F=z[H];if(!F){F=Gd.flatten(o.slice(E[0],E[1]));z[H]=F}w.textureData=I;w.vertexPosition=D;w.texturePosition=G;w.vertexColor=F;w.center=new GH(z.x,z.y,0);w.rotate=C;w.rotateMatrix=x;w.logoScale=z.logoScale;k.render(w)}};this.release=function(){this.clear();k.release()};this.clear=function(){Gd.releaseObjectArray(a);Gd.releaseObjectArray(q);Gd.releaseObjectArray(o);Gd.releaseObjectArray(n);Gd.releaseObjectArray(i);Gd.releaseTextureArray(b.gl,t)}};var Ga=Ga||function(p){var b=p;var m=p.gl;var a=new Array();var n=new Array();var j=new Array();var e=new Array();var r=new Array();var i=new GF(0,1);var q=new GF(0,0);var o=new GF(1,0);var c=new GF(1,1);var g=new GS(p);var h=10,f=10;var k=this;function d(u,s){var v=GHConstants.IMAGE_PRE+s;var t=new Image();t.crossOrigin="Anonymous";t.onload=function(){var I=m.createTexture();m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);m.bindTexture(m.TEXTURE_2D,I);m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,this);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.bindTexture(m.TEXTURE_2D,null);m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);r.push(I);var D=Gd.getDevicePixelRatio();var H=this.width*D*b.getImageScale();var B=this.height*D*b.getImageScale();if(u.name=="logo"){H*=b.logoScale;B*=b.logoScale}else{H*=b.compassScale;B*=b.compassScale}u.visible=true;u.width=H;u.height=B;a.push(u);var y=new GH();if(u.name=="logo"){u.visible=b.logoVisible;var G=b.getCamera().width/2;var C=b.getCamera().height/2;var x=new GH(G,C,1);var F=-G+h;var E=-C+f;var A=F+u.width;var z=E+u.height;y.setX(F);y.setY(E);y.div(x);n.push(y.clone());y.setX(F);y.setY(z);y.div(x);n.push(y.clone());y.setX(A);y.setY(z);y.div(x);n.push(y.clone());n.push(y.clone());y.setX(F);y.setY(E);y.div(x);n.push(y.clone());y.setX(A);y.setY(E);y.div(x);n.push(y.clone())}else{u.visible=b.compassVisible;n.push(y.clone());n.push(y.clone());n.push(y.clone());n.push(y.clone());n.push(y.clone());n.push(y.clone())}e.push(i);e.push(q);e.push(o);e.push(o);e.push(i);e.push(c);j.push(n.length);k.update()};t.onerror=function(){};t.src=v}function l(){d({name:"compass"},"compass.png");d({name:"logo"},"logo.png")}this.updateAll=function(){if(n.length==0){return}this.update();for(var y=0;y<a.length;y++){var x=a[y];if(x.name=="logo"){var D=b.getCamera().width/2;var z=b.getCamera().height/2;var s=new GH(D,z,1);var A=Gd.getIndicatesStartEnd(y,j);var u=A[0];var C=-D+h;var B=-z+f;var w=C+x.width;var v=B+x.height;var t=new GH(C,B,0);t.setX(C);t.setY(B);t.div(s);n[u+0].set(t);n[u+4].set(t);t.setX(C);t.setY(v);t.div(s);n[u+1].set(t);t.setX(w);t.setY(v);t.div(s);n[u+2].set(t);n[u+3].set(t);t.setX(w);t.setY(B);t.div(s);n[u+5].set(t);break}}};this.update=function(){if(n.length==0){return}var v=b.getCamera().width/2;var w=b.getCamera().height/2;var B=new GH(v,w,1);var z=-1;for(var H=0;H<a.length;H++){if(a[H].name=="compass"){z=H;break}}if(z==-1){return}var C=a[z];var J=Gd.getIndicatesStartEnd(z,j);var u=J[0];var E=C.width;var D=C.height;var A=0;var y=0;var t=0;var s=0;if(b.compassPosition==GHConstants.COMPASS_RIGHT_TOP){A=v-E-h;y=w-D-f}else{A=-v+h;y=w-D-f}t=A+E;s=y+D;var G=new GK();var I=b.getRotate();I=Gd.angleToRadians(I);G.rotate(I,new GH(0,0,-1));var F,x;x=new GH((A+t)/2,(y+s)/2,0);F=new GH(A,y,0);F=F.sub(x).multMat4(G);F.add(x);F.div(B);n[u+0].set(F);n[u+4].set(F);F.setValue(A,s,0);F=F.sub(x).multMat4(G);F.add(x);F.div(B);n[u+1].set(F);F.setValue(t,s,0);F=F.sub(x).multMat4(G);F.add(x);F.div(B);n[u+2].set(F);n[u+3].set(F);F.setValue(t,y,0);F=F.sub(x).multMat4(G);F.add(x);F.div(B);n[u+5].set(F)};this.setLogoVisible=function(t){for(var s=0;s<a.length;s++){if(a[s].name=="logo"){a[s].visible=t;break}}};this.getLogoVisible=function(t){for(var s=0;s<a.length;s++){if(a[s].name=="logo"){return a[s].visible}}};this.setCompassVisible=function(t){for(var s=0;s<a.length;s++){if(a[s].name=="compass"){a[s].visible=t;break}}};this.getCompassVisible=function(){for(var s=0;s<a.length;s++){if(a[s].name=="compass"){return a[s].visible}}};this._onCompassClick=function(t){for(var s=0;s<a.length;s++){if(a[s].name=="compass"){var u={};if(b.compassPosition==GHConstants.COMPASS_RIGHT_TOP){u.maxx=b.getCamera().width-h;u.minx=u.maxx-a[s].width;u.miny=f;u.maxy=u.miny+a[s].height}else{u.minx=h;u.miny=f;u.maxx=u.minx+a[s].width;u.maxy=u.miny+a[s].height}if(Gd.rectContains(u,t.x,t.y)){var v=new Gh.ROTATE(b);var w=b.getRotate();if(w<=180){v.setValue(-w)}else{v.setValue(-w+360)}v.start()}}}};this.render=function(){var v={};for(var u=0;u<a.length;u++){var z=a[u];if(!z.visible){continue}var w=Gd.getIndicatesStartEnd(u,j);var s=r[u];var y=Gd.flatten(n.slice(w[0],w[1]));var x=z.tFlatten;if(!x){x=Gd.flatten(e.slice(w[0],w[1]));z.tFlatten=x}v.textureData=s;v.vertexPosition=y;v.texturePosition=x;g.render(v)}};this.release=function(){Gd.releaseObjectArray(a);Gd.releaseObjectArray(n);Gd.releaseObjectArray(j);Gd.releaseObjectArray(e);Gd.releaseTextureArray(m,r);g.release()};l()};var Gb=Gb||function(x){var y=x;var l=y.gl;var F,z,r,h;var I;var q=new GU(y);q.type="marker";var g=new GU(y);g.type="marker";var f=new GU(y);f.type="marker";var n=new GT(y);var d=this;var j={};var A={};var i=[];var c=126;var H=126;var B,b,p;var k=new GF(0,1);var J=new GF(0,0);var m=new GF(1,0);var G=new GF(1,1);var C=new Array();var v=new Array();var s=1,a=2,K=3,e=4;function D(){var M=GHConstants.IMAGE_PRE+"route.png";y._imageTextureLoader.load(M,function(O,N){if(O){B=O.texture;H=O.width/2;c=O.height/2}})}this.setStartPoint=function(M,N,O){r=N;F=M;if(O){w(M,s,N,false)}};this.setEndPoint=function(M,N,O){h=N;z=M;if(O){w(M,a,N,false)}};this.compuRoute=function(M,N,O,P){O.v3d="1";M.routing(N,O,function(Q){t(Q);d.update();if(P){P(d.getResult())}y.refresh()})};this.render=function(M,O){var Q={center:M,relativeHeight:0.3+GHConstants.FLOOR_HEIGHT*0.1,bottomHeight:O.height,heightScale:y._getHeightScale()};var P=O!=undefined?O.floorNum:y.getCurFloorNum();var S=j[P];Q.pxScale=y.calPixelScale();var T=y.getCamera();Q.up=T.up.data;Q.axis=T.axis.data;if(S){var U=A[P];Q.vertexPosition=Gd.flatten(S);Q.texturePosition=Gd.flatten(U);Q.textureData=B;Q.sameFloor=1;n.render(Q)}if(!y.is3DAll()){for(var R=0;R<i.length;R++){var N=i[R];if(N.startFloor==P||N.endFloor==P){Q.vertexPosition=Gd.flatten(N.vertex);Q.texturePosition=Gd.flatten(N.texture);Q.sameFloor=2;Q.textureData=B;n.render(Q)}}}};this.renderUpDownRoute=function(M){var Q={center:M,relativeHeight:0.3};Q.pxScale=y.calPixelScale();var O=y.getCamera();Q.up=O.up.data;Q.axis=O.axis.data;for(var N=0;N<i.length;N++){var P=i[N];Q.vertexPosition=Gd.flatten(P.vertex);Q.texturePosition=Gd.flatten(P.texture);Q.sameFloor=2;Q.textureData=B;n.render(Q)}};this.renderPoi=function(M,O){var R={center:M,relativeHeight:0.3,bottomHeight:O.height,heightScale:y._getHeightScale()};R.pxScale=y.calPixelScale();var V=y.getCamera();R.up=V.up.data;R.axis=V.axis.data;var T=O!=undefined?O.floorName:y.getCurFloorName();if(T==r){q.render(R)}if(T==h){g.render(R)}if(y.is3DAll()){var P=O!=undefined?O.floorNum:y.getCurFloorNum();var U=f.getObjectSize();for(var S=0;S<U;S++){var Q=f.getObject(S);var N=Q.getData();if(N.startFloor!=P){Q.visible=false}else{Q.visible=true}}}f.render(R)};this.update=function(){if(!I){return}E();var S=f.getObjectSize()==0;var V=H/2;var ab=y.calPixelScale();var R=V*ab*0.5;var Q=ab*c;var T=0;for(var aa=0;aa<v.length-1;aa++){var ah=v[aa];var af=v[aa+1];var O=ah.point;var N=af.point;var ad=O.getW();if(O.getW()==N.getW()){var ae=j[ad];if(!ae){ae=[];j[ad]=ae}var X=A[ad];if(!X){X=[];A[ad]=X}T=L(ah,af,ae,X,R,Q,T)}else{T=0;var Y=Math.abs(N.getZ()-O.getZ());var ac=Y/Q;var P=y.getCamera().axis.clone();P.normalize();P.multNum(R);var ah=new GH(O.getX(),O.getY(),O.getZ());var af=new GH(N.getX(),N.getY(),N.getZ());var ak=ah.clone().sub(P);var aj=ah.clone().add(P);var ai=af.clone().add(P);var ag=af.clone().sub(P);var al={};al.startFloor=O.getW();al.endFloor=N.getW();var Z=[],M=[];Z.push(ak);Z.push(aj);Z.push(ag);Z.push(aj);Z.push(ai);Z.push(ag);M.push(new GF(0,0));M.push(new GF(1,0));M.push(new GF(0,ac));M.push(new GF(1,0));M.push(new GF(1,ac));M.push(new GF(0,ac));al.vertex=Z;al.texture=M;i.push(al);if(S){var W=new GHMark(new GHPoint2D(O.getX(),O.getY()));W.setAnchor(GHMark.Anchor.CENTER);var U=GHConstants.IMAGE_PRE;if(O.getW()<N.getW()){U+="up.png"}else{U+="down.png"}W.setOffset(40*Gd.getDevicePixelRatio(),0);W.setImageSrc(U);var al={startFloor:O.getW(),endFloor:N.getW()};W.setData(al);f.add(W,O.getZ()+GHConstants.FLOOR_HEIGHT,function(){d.updateUpDown()})}}}this.updateUpDown()};function L(T,R,ab,V,S,Q,Z){var X=T.point;var N=new GH(X.getX(),X.getY(),X.getZ());X=R.point;var M=new GH(X.getX(),X.getY(),X.getZ());var U=M.clone().sub(N);var aa=U.length();if(aa==0){return}aa/=Q;var af,ae,ad,ac,O,Y;if(T.center&&R.center&&R.center.getX()==T.center.getX()&&R.center.getY()==T.center.getY()){var P=N.clone().sub(T.center);O=new GF(P.getX(),P.getY());O.normalize();O.multNum(S);Y=new GH(O.getX(),O.getY(),0);af=N.clone().add(Y);ae=N.clone().sub(Y);P=M.clone().sub(R.center);O=new GF(P.getX(),P.getY());O.normalize();O.multNum(S);Y=new GH(O.getX(),O.getY(),0);ad=M.clone().sub(Y);ac=M.clone().add(Y)}else{O=new GF(-U.getY(),U.getX());O.normalize();O.multNum(S);Y=new GH(O.getX(),O.getY(),0);af=N.clone().add(Y);ae=N.clone().sub(Y);ad=M.clone().sub(Y);ac=M.clone().add(Y)}ab.push(af);ab.push(ae);ab.push(ac);ab.push(ae);ab.push(ad);ab.push(ac);var W=Z+aa;V.push(new GF(0,Z));V.push(new GF(1,Z));V.push(new GF(0,W));V.push(new GF(1,Z));V.push(new GF(1,W));V.push(new GF(0,W));return W%1}this.updateUpDown=function(){if(y.is3DAll()){return}var N=f.getObjectSize();var O=y.getCurFloorNum();for(var M=0;M<N;M++){var P=f.getObject(M);P.visible=true;if(O!=P.getData().startFloor){P.visible=false}}};this._clickSelect=function(M,P){f._clearSelect();var O=f._clickSelect(M,P);if(O){var N=O.getData().endFloor;y.setCurFloor(y._getFloorNameByNum(N));return true}return false};this.clear=function(){E();F=undefined;z=undefined;r=undefined;h=undefined;I=undefined;C.length=0;v.length=0;E();q.clearMark();g.clearMark();f.clearMark()};function E(){for(var M in j){j[M].length=0;delete j[M]}for(var M in A){A[M].length=0;delete A[M]}i.length=0}this.release=function(){this.clear();q.release();g.release();n.release();f.release()};function w(V,U,R,O){var T;var S;var P=GHMark.Anchor.BOTTOM;var Q;if(O){Q=y._getFloorHeightByNum(R,GHConstants.FLOOR_HEIGHT)}else{Q=y._getFloorHeightByName(R,GHConstants.FLOOR_HEIGHT)}switch(U){case s:T="start_point";S=q;S.clearMark();break;case a:T="end_point";S=g;S.clearMark();break;case K:break;case e:break}var N=new GHMark();N.setPoint(new GHPoint2D(V.x,V.y));var M=GHConstants.IMAGE_PRE+T+".png";N.setImageSrc(M);N.setAnchor(P);N.setImageScale(y.startEndPointScale);S.add(N,Q)}function t(N){q.clearMark();g.clearMark();f.clearMark();var P=N.body;I=P;var U=[];var Z=I.data[0];var S=Z.startFloor;var W=y._getFloorHeightByNum(S,2);Z.startPoint.z=W;U.push(new GI(Z.startPoint.x,Z.startPoint.y,Z.startPoint.z,S));w(Z.startPoint,s,S,true);var R=Z.roads;for(var Q=0;Q<R.length;Q++){Z=R[Q];S=Z.startFloor;W=y._getFloorHeightByNum(S,2);Z.startPoint.z=W;U.push(new GI(Z.startPoint.x,Z.startPoint.y,Z.startPoint.z,S));if(Q==R.length-1){S=Z.endFloor;W=y._getFloorHeightByNum(S,2);Z.endPoint.z=W;U.push(new GI(Z.endPoint.x,Z.endPoint.y,Z.endPoint.z,S))}}Z=I.data[0];S=Z.endFloor;W=y._getFloorHeightByNum(S,2);Z.endPoint.z=W;U.push(new GI(Z.endPoint.x,Z.endPoint.y,Z.endPoint.z,S));w(Z.endPoint,a,S,true);C.length=0;for(var Q=0;Q<U.length;Q++){var M=U[Q];var Y=false;if(C.length<2){Y=true}else{var X=C[C.length-2];var V=C[C.length-1];if(M.getW()==X.getW()&&X.getW()==V.getW()){if(o(X,V,M)){C.splice(C.length-1);Y=true}else{Y=true}}else{Y=true}}if(Y){C.push(M)}}v.length=0;if(C.length>0){v.push({point:C[0]});for(var Q=1;Q<C.length-1;Q++){var X=C[Q-1];var V=C[Q];var T=C[Q+1];var aa=u(X,V,T);if(!aa){v.push({point:V})}else{for(var O=0;O<aa.length;O++){v.push(aa[O])}}if(Q==C.length-2){v.push({point:T})}}}}function u(S,O,N){var ao=[];var ak=15;var al=20;if(S.getW()==O.getW()&&O.getW()==N.getW()){var aa=new GH(S.getX(),S.getY(),S.getZ());var Z=new GH(O.getX(),O.getY(),O.getZ());var W=new GH(N.getX(),N.getY(),N.getZ());var am=Z.clone().sub(aa);var Y=W.clone().sub(Z);var af=am.length();var ae=Y.length();while(af<ak*2){ak*=0.95}while(ae<ak*2){ak*=0.95}am.normalize();Y.normalize();var X=aa.clone().add(am.clone().multNum(af-ak));var V=Z.clone().add(Y.clone().multNum(ak));var ad=new GH(-am.getY(),am.getX(),X.getZ()).add(X);var ab=new GH(-Y.getY(),Y.getX(),V.getZ()).add(V);var ap=Gd.lineIntersect(X,ad,V,ab);var ac=ap.clone().sub(X).length();var U=new GF(X.getX()-ap.getX(),X.getY()-ap.getY());var Q=new GF(V.getX()-ap.getX(),V.getY()-ap.getY());var T=Math.atan2(U.getY(),U.getX());var P=Math.atan2(Q.getY(),Q.getX());var aq=T-P;while(aq>Math.PI){aq-=Math.PI*2}while(aq<-Math.PI){aq+=Math.PI*2}var ag=aq/al;for(var an=0;an<al;an++){var M=T-an*ag;var ai=ac*Math.cos(M);var ah=ac*Math.sin(M);var aj=new GI(ap.getX()+ai,ap.getY()+ah,ap.getZ(),S.getW());ao.push({point:aj,center:ap})}ao.push({point:new GI(V.getX(),V.getY(),V.getZ(),S.getW()),center:ap});return ao}return false}this.getResult=function(){var M=[];for(var N=0;N<C.length;N++){var O=C[N];M.push({x:O.getX(),y:O.getY(),fnum:O.getW(),fname:Gd.floorNumToName(O.getW())})}return M};function o(S,R,Q){var P=R.getX()-S.getX();var O=R.getY()-S.getY();var N=Gd.radiansToAngle(Math.atan2(O,P));P=Q.getX()-R.getX();O=Q.getY()-R.getY();var M=Gd.radiansToAngle(Math.atan2(O,P));return Math.abs(M-N)<1}D()};var Gc=Gc||function(d){var f=d;var g=new GU(d);g.type="location";var a=new GU(d);a.type="location";var b,c;e();function e(){var h=GHConstants.IMAGE_PRE+"location.png";b=new GHMark(new GHPoint2D(0,0));b.setAnchor(GHConstants.LOC_ANCHOR);b.setData({floor:-999});b.setImageSrc(h);b.setOffsetZ(2);b.setHeight(0);g.add(b,0);h=GHConstants.IMAGE_PRE+"location_radius.png";c=new GHMark(new GHPoint2D(0,0));c.setAnchor(GHMark.Anchor.CENTER);c.setData({floor:-999});c.setOffsetZ(2);c.setHeight(0);c.setImageSrc(h);a.add(c,-999)}this.updatePointAndFloor=function(i,h){var j=false;if(g.updatePositionByObject(b,i,h,f._locFlat)){b.getData().floor=h;j=true}if(a.updatePositionByObject(c,i,h,f._locFlat)){c.getData().floor=h;j=true}if(j){f.refresh()}};this.updateAngle=function(h){var i=g.updateAngleByObject(b,h);if(i){f.refresh()}};this.hide=function(){b.getData().floor="-99999";c.getData().floor="-99999";f.refresh()};this.render=function(h){var k={center:h,relativeHeight:3,bottomHeight:f.getCurFloorHeight()};k.pxScale=f.calPixelScale();var i=f.getCamera();k.up=i.up.data;k.axis=i.axis.data;var j=f.getCurFloorName();if(a.getObjectSize()>0&&g.getObjectSize()>0){if(b.getData().floor==j){a.render(k);g.render(k)}}};this.release=function(){a.release();g.release()}};var GAA=GAA||function(c){var e=c;var d=c.gl;var a=new GAB(c);var b;this.setData=function(n){if(!b){b=[]}b.push(n);var k=c.getCurFloorHeight();var m=n.data;for(var f=0;f<m.length;f++){var l=m[f].vFlatten;if(l.length>0){m[f]._box=new GOA()}else{m[f]._box=undefined}for(var g=0;g<l.length;g+=3){var o=new GH(l[g],l[g+1],l[g+2]+k);m[f]._box.add(o)}}};this.getWorldCoord=function(s,o,q){var m=c.getCamera()._getRay(s,o);var t=Number.MAX_VALUE;var l;for(var v=0;v<b.length;v++){var w=b[v].data;for(var u=0;u<w.length;u++){if(w[u]._box&&!m.intersectBox(w[u]._box)){continue}var p=w[u].vFlatten;var k=w[u].indices;for(var v=0;v<k.length;v+=3){var h=k[v]*3;var g=k[v+1]*3;var f=k[v+2]*3;var A=new GH(p[h],p[h+1],p[h+2]+q);var z=new GH(p[g],p[g+1],p[g+2]+q);var y=new GH(p[f],p[f+1],p[f+2]+q);var n=m.intersectTriangle(A,z,y);if(n!==null){var x=n.distanceTo(m.origin);if(x<t){t=x;l=n}}}}}return l};this.isGround=function(f){return f.option.type=="ground"};this.render=function(h){if(!b){return}var l=e.gl;var f=Gd.clone(h);f.eye=Gd.flatten([e._e()]);l.enable(l.STENCIL_TEST);l.stencilFunc(l.ALWAYS,1,1);l.stencilOp(l.KEEP,l.KEEP,l.REPLACE);var m=false;for(var k=0;k<b.length;k++){var o=b[k];m=m||o.option.useRtt;if(!this.isGround(o)){continue}f.useLight=o.option.useLight;f.useRtt=false;var n=o.data;for(var g=0;g<n.length;g++){var q=n[g];for(var p in q){f[p]=q[p]}a.render(f)}}l.stencilFunc(l.EQUAL,1,1);l.stencilOp(l.KEEP,l.KEEP,l.KEEP);if(m){a.start();for(var k=0;k<b.length;k++){var o=b[k];if(!o.option.useRtt||this.isGround(o)){continue}f.useLight=o.option.useLight;f.useRtt=true;var n=o.data;for(var g=0;g<n.length;g++){var q=n[g];for(var p in q){f[p]=q[p]}a.render(f)}}a.end();l.disable(l.DEPTH_TEST);a.renderFBO()}l.disable(l.STENCIL_TEST);l.enable(l.DEPTH_TEST);for(var k=0;k<b.length;k++){var o=b[k];if(this.isGround(o)){continue}f.useLight=o.option.useLight;f.useRtt=false;var n=o.data;for(var g=0;g<n.length;g++){var q=n[g];for(var p in q){f[p]=q[p]}a.render(f)}}};this.release=function(){var n=e.gl;for(var g=0;g<b.length;g++){var m=b[g];var l=m.data;for(var f=0;f<l.length;f++){var h=l[f];var k=h.tResult;if(k){if(k.tAmbient){n.deleteTexture(k.tAmbient)}if(k.tDiffuse){n.deleteTexture(k.tDiffuse)}}}}}};var GCL=GCL||function(a){this._map=a;this._objects=new Array();this._fillColor="#0000FF80";this._textColor="#FFFFFF";this._fillLegend=new Array();this._radius=50;this._offsetZ=0;this._groups=new Array();this._dataInit=false;this._renderData;this._canvas=document.createElement("canvas");this._context=this._canvas.getContext("2d");this._pointRender=new GAC(a);this._tFlatten=this.initVFlatten();this._cFlatten=[];this._fontScale=1;this._animationColor="#ff000080";this._animationScale=0;this._height=0;this._textGap=5;this._sleepTime=250;this._needUpdatePositon=false};GCL.prototype={setTextGap:function(a){if(this._textGap!=a){this.releaseGroup();this._textGap=a;this.update()}},getTextGap:function(){return this._textGap},setObjects:function(a){this.releaseGroup();this._objects=a;this.update()},addObject:function(a){this.releaseGroup();this._objects.push(a);this.update()},clear:function(){this.releaseGroup();this._objects.length=0;this.update()},setFontScale:function(a){if(a!=this._fontScale){this.releaseGroup();this._fontScale=a;this.update()}},getFontScale:function(){return this._fontScale},getObjectSize:function(){return this._objects.length},setFillColor:function(a){if(a!=this._fillColor){this.releaseGroup();this._fillColor=a;this.update()}},getFillColor:function(){return this._fillColor},setTextColor:function(a){if(a!=this._textColor){this.releaseGroup();this._textColor=a;this.update()}},getTextColor:function(){return this._textColor},addFillLegendColor:function(c,a,b){this.releaseGroup();this._fillLegend.push({min:c,max:a,color:b});this.update()},clearFillLegendColor:function(){this.releaseGroup();this._fillLegend.length=0;this.update()},setOffsetZ:function(a){this._offsetZ=a;this._map.refresh()},getOffsetZ:function(){return this._offsetZ},setRadius:function(a){this._radius=a*2},getRadius:function(){return this._radius/2},setAnimationColor:function(a){if(this._animationColor!=a){this.releaseGroup();this._animationColor=a;this.update()}},addGroup:function(a){this.releaseGroup();this._groups.push(a);this.update()},clearGroup:function(){this.releaseGroup();this._groups.length=0;this.update()},update:function(){this.releaseGroup();this._renderData=undefined;var a=this._group();this._renderData=this._mergeOverlappingClusters(a);while(this._renderData.merge){delete this._renderData.merge;this._renderData=this._mergeOverlappingClusters(this._renderData)}delete this._renderData.merge;for(var m in this._renderData){var f=this._renderData[m];f.texture=this._createCountTexture(f);var h=new Array();for(var g=0;g<6;g++){h.push(new GH(f.sx,f.sy,0))}f.vFlatten=Gd.flatten(h)}var n=this._radius/2;var c=0;var j=0;var l=new GI(-n,-n,c,j);var e=new GI(-n,n,c,j);var k=new GI(n,n,c,j);var b=new GI(n,-n,c,j);var d=new Array();d.push(l);d.push(e);d.push(k);d.push(k);d.push(l);d.push(b);this._cFlatten=Gd.flatten(d);this._map.refresh()},releaseGroup:function(){if(this._renderData){var e=this._map.gl;for(var a in this._renderData){var d=this._renderData[a];if(d.texture){var d=this._renderData[a];var c=d.texture;for(var b in c){if(c[b]){e.deleteTexture(c[b]);d[b]=undefined}}d.texture=undefined}}}},setSleepTime:function(a){this._sleepTime=a},release:function(){this.releaseGroup();this._pointRender.release()},_createCountTexture:function(g){var l={};var f=this._canvas;var b=this._context;var o=g.count;var j=this._fontScale*2;var d=10*j*Gd.getDevicePixelRatio();var z='"Microsoft Yahei","微软雅黑",Tahoma,Arial';var e=d+"px "+z;f.width=this._radius;f.height=this._radius;b.clearRect(0,0,f.width,f.height);var u=f.width/2;b.textAlign="center";b.textBaseline="middle";var q;if(this._map._useClusterAnimation){q=Gd.getContextColor(this._animationColor);b.fillStyle=q.color;b.globalAlpha=q.alpha;b.beginPath();b.arc(u,u,u,0,2*Math.PI,true);b.closePath();b.fill();var v=this._map.gl;var m=v.createTexture();v.bindTexture(v.TEXTURE_2D,m);v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,f);v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR);v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE);v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE);v.bindTexture(v.TEXTURE_2D,null);l.animationTexture=m;b.clearRect(0,0,f.width,f.height)}var s=this._fillColor;for(var w=0;w<this._fillLegend.length;w++){var C=this._fillLegend[w];if(o>C.min&&o<=C.max){s=C.color}}q=Gd.getContextColor(s);b.fillStyle=q.color;b.globalAlpha=q.alpha;b.beginPath();b.arc(u,u,u,0,2*Math.PI,true);b.closePath();b.fill();b.font=e;q=Gd.getContextColor(this._textColor);b.fillStyle=q.color;b.globalAlpha=q.alpha;var y=this._groups;if(y.length>0){var x=[];for(var w=0;w<y.length;w++){var n="";var k=y[w];var p=k.unit;var D=k.name;var B=g.groups[D];if(!B){B=0}n+=B;n+=p;x.push(n)}var r=this._textGap;var A;var a=parseInt(x.length/2);if(x.length%2==1){A=u-(d+r)*a}else{A=u-(d+r)*(a-0.5)}var h=A;for(var w=0;w<x.length;w++){var z=x[w];b.fillText(z,u,h);h+=d+r}}else{b.fillText(o,u,u)}var v=this._map.gl;var m=v.createTexture();v.bindTexture(v.TEXTURE_2D,m);v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,f);v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR);v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE);v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE);v.bindTexture(v.TEXTURE_2D,null);l.texture=m;return l},_group:function(){var c={};for(var g=0;g<this._objects.length;g++){var f=this._objects[g];var b=f.getPoint();if(!b){continue}var j=this._map.gp2px(b.x,b.y,this.getHeight());var e=parseInt(j.x/this._radius);var d=parseInt(j.y/this._radius);var k=e+"_"+d;var h=c[k];if(h){h.x=(h.x+b.x)/2;h.y=(h.y+b.y)/2;h.sx=(h.sx+j.x)/2;h.sy=(h.sy+j.y)/2;h.count++}else{h={cx:e,cy:d,sx:j.x,sy:j.y,x:b.x,y:b.y,count:1,groups:{},data:new Array()};c[k]=h}var a=f.getGroup();if(a){if(h.groups[a]){h.groups[a]++}else{h.groups[a]=1}}h.data.push(f)}return c},_mergeOverlappingClusters:function(c){var e={};var g=false;for(var d in c){var b=c[d];if(b.count==0){continue}g=this._searchAndMerge(c,b,1,0)||g;g=this._searchAndMerge(c,b,-1,0)||g;g=this._searchAndMerge(c,b,0,1)||g;g=this._searchAndMerge(c,b,0,-1)||g;g=this._searchAndMerge(c,b,1,1)||g;g=this._searchAndMerge(c,b,1,-1)||g;g=this._searchAndMerge(c,b,-1,1)||g;g=this._searchAndMerge(c,b,-1,-1)||g;var a=parseInt(b.sx/this._radius);var f=parseInt(b.sy/this._radius);b.cx=a;b.cy=f;var d=a+"_"+f;e[d]=b}e.merge=g;return e},_searchAndMerge:function(d,h,b,a){var i=false;var f=h.cx+b;var e=h.cy+a;var j=f+"_"+e;var g=d[j];if(g&&g.count>0){var l=g.sx-h.sx;var k=g.sy-h.sy;var c=Math.sqrt(l*l+k*k);if(c<this._radius){this._merge(h,g);i=true}}return i},_merge:function(a,e){var d=a.count+e.count;a.sx=(a.count*a.sx+e.count*e.sx)/d;a.sy=(a.count*a.sy+e.count*e.sy)/d;a.x=(a.count*a.x+e.count*e.x)/d;a.y=(a.count*a.y+e.count*e.y)/d;for(var c in e.groups){if(a.groups[c]){a.groups[c]+=e.groups[c]}else{a.groups[c]=e.groups[c]}e.groups[c]=0}for(var b=0;b<e.data.length;b++){a.data.push(e.data[b])}a.count=d;e.count=0;e.data.length=0},initVFlatten:function(){var d=new GF(0,1);var e=new GF(0,0);var a=new GF(1,0);var f=new GF(1,1);var b=new Array();b.push(d);b.push(e);b.push(a);b.push(a);b.push(d);b.push(f);var c=Gd.flatten(b);return c},render:function(a){(function(f){f._dataInit=true;if(!f._renderData){return}if(f._needUpdatePositon){f._needUpdatePositon=false;for(var n in f._renderData){var g=f._renderData[n];if(!g||!g.texture){continue}var m=f._map.gp2px(g.x,g.y,f.getHeight());g.sx=m.x;g.sy=m.y;var j=new Array();for(var h=0;h<6;h++){j.push(new GH(g.sx,g.sy,0))}g.vFlatten=Gd.flatten(j)}}var l=f._map.getCamera();var e=l.eye.clone().sub(l.center);var k=e.length();var d=Gd.clone(a);var c=l.width;var o=l.height;var b=1;for(var n in f._renderData){var g=f._renderData[n];if(!g||!g.texture){continue}if(0>g.sx||c<g.sx||0>g.sy||o<g.sy){continue}d.vertexPosition=g.vFlatten;d.vertexColor=f._cFlatten;d.texturePosition=f._tFlatten;if(f._map._useClusterAnimation&&f._animationScale>0&&g.texture){d.textureData=g.texture.animationTexture;d.imgScale=f._animationScale;f._pointRender.render(d)}d.imgScale=b;d.textureData=g.texture.texture;f._pointRender.render(d)}if(f._map._useClusterAnimation){if(f._timeId){clearTimeout(f._timeId)}f._timeId=setTimeout(function(){if(f._animationScale>=b){f._animationScale=0}else{f._animationScale+=0.1}f._map.refresh()},f._sleepTime)}})(this)},getHeight:function(){var a=this._height*this._map._getHeightScale;return a},setHeight:function(a){this._height=a;this._needUpdatePositon=true;this._map.refresh()},updatePosition:function(){this._needUpdatePositon=true},_clickSelect:function(f,e){if(!this._renderData){return undefined}var p=this._map;var n=p.getCamera();var k=p.calPixelScale();var n=p.getCamera();var c=n.axis;var o=n.up;c.normalize();o.normalize();var h=n._getRay(f,e);var l=this._radius/2;var a=l*k;var r=-a;var s=undefined;for(var t in this._renderData){var q=this._renderData[t];var i=new GH(q.x,q.y,this.getHeight());var g=c.clone().multNum(r).clone().add(o.clone().multNum(a)).clone().add(i);var b=c.clone().multNum(r).clone().add(o.clone().multNum(r)).clone().add(i);var j=c.clone().multNum(a).clone().add(o.clone().multNum(a)).clone().add(i);var m=c.clone().multNum(a).clone().add(o.clone().multNum(r)).clone().add(i);var d=h.intersectTriangle(b,g,m);if(!d){d=h.intersectTriangle(m,g,j)}if(d){s=t;break}}if(s){var q=this._renderData[s];return{x:q.x,y:q.y,groups:q.groups,count:q.count,data:q.data}}return undefined}};var Gd={angleToRadians:function(a){return a*Math.PI/180},radiansToAngle:function(a){return a*180/Math.PI},getAngle:function(h,f,e){var d=e.clone();d.sub(h);var c=f.clone();c.sub(h);var g=d.dot(c)/(d.length()*c.length());if(g>1){g=1}else{if(g<-1){g=-1}}return Math.acos(g)},clone:function(b){var c={};for(var a in b){c[a]=b[a]}return c},point2DToVector3:function(c,b){b=b||0;var a=new GH(c.x,c.y,b);return a},addArrayData:function(b,a){var d=[];if(b){for(var c=0;c<b.length;c++){d.push(b[c])}}for(var c=0;c<a.length;c++){d.push(a[c])}return new Float32Array(d)},flatten:function(d){var c=[];for(var b=0;b<d.length;b++){for(var a=0;a<d[b].data.length;a++){c.push(d[b].data[a])}}return new Float32Array(c)},getJsonValue:function(c,b,a){if(c&&c[b]!=undefined){return c[b]}return a},getJsonFromArray:function(f,d,e){var a;for(var c=0;c<f.length;c++){var b=f[c];if(b[d]&&b[d]==e){a=b;break}}return a},getVector4FromColorStr:function(f){var b=f;var h=b.charAt(0);if(h=="#"){b=b.substr(1)}var a=[0,0,0,255];var d=0;for(var e=0;e<b.length;e+=2){var g=b.substring(e,e+2);a[d]=parseInt(g,16);d++}return new GI(a[0]/255,a[1]/255,a[2]/255,a[3]/255)},getContextColor:function(e){var d=e;var g=d.charAt(0);if(g=="#"){d=d.substr(1)}var g=d.substring(0,6);var b=1;if(d.length==8){var f=d.substring(6,8);b=parseInt(f,16)/255}return{color:"#"+g,alpha:b}},getDistance:function(d,f,c,e){var b=c-d;var a=e-f;return Math.sqrt(b*b+a*a)},getRotate:function(e,g,d,f){var c=d-e;var b=f-g;var a=Math.atan2(b,c);return Gd.radiansToAngle(a)},eqVec3:function(b,a){if(b&&a){return b.getX()==a.getX()&&b.getY()==a.getY()&&b.getZ()==a.getZ()}if(b&&!a){return false}if(!b&&a){return false}return true},dataArrayToPolygon:function(a){var c=new GHPolygon();if(a.length<3){return c}for(var b=0;b<a.length;b++){var d=a[b];c.addPoint(new GHPoint2D(d[0],d[1]))}return c},dataArrayToLine:function(a){var b=new GHLine();if(a.length<2){return b}for(var c=0;c<a.length;c++){var d=a[c];b.addPoint(new GHPoint2D(d[0],d[1]))}return b},createDiv:function(a){var b=document.createElement("div");if(a){b.className=a}return b},getIndicatesStartEnd:function(c,b){var d=c==0?0:b[c-1];var a=b[c];return[d,a]},getDevicePixelRatio:function(){var a=window.devicePixelRatio||1;if(a>=2){a/=2}return a},rectContains:function(b,a,c){return b.minx<a&&a<b.maxx&&b.miny<c&&c<b.maxy},intersect:function(b,a){return b.minx<a.maxx&&a.minx<b.maxx&&b.miny<a.maxy&&a.miny<b.maxy},rectContainsRect:function(b,a){return b.minx<=a.minx&&b.maxx>=a.maxx&&b.miny<=a.miny&&b.maxy>=a.maxy},intersects:function(d,a){for(var b=0;b<a.length;b++){var c=a[b];if(Gd.intersect(d,c)){return true}}return false},rectExpandNew:function(d,b,a){var c=Gd.clone(d);c.minx+=b;c.maxx-=b;c.miny+=a;c.maxy-=a;return c},pointToLineDistance:function(u,j,i){var o=u.x;var n=u.y;var A=j.x;var l=j.y;var w=i.x;var k=i.y;var G=w-A;var F=o-A;var E=k-l;var D=n-l;var C=o-w;var B=n-k;var m=G*F+E*D;if(m<=0){return Math.sqrt(F*F+D*D)}var H=G*G+E*E;if(m>=H){return Math.sqrt(C*C+B*B)}var t=m/H;var s=A+G*t;var q=l+E*t;var z=o-s;var v=n-q;return Math.sqrt(z*z+v*v)},spanHtml:function(b,a){var c=document.getElementById("span");if(c){if(a){c.innerHTML+=b}else{c.innerHTML=b}}},releaseObjectArray:function(b){if(!b){return}for(var a=0;a<b.length;a++){b[a]=null}b.length=0},releaseTextureArray:function(d,a){if(!a||!d){return}for(var b=0;b<a.length;b++){var c=a[b];d.deleteTexture(c);a[b]=undefined}a.length=0},releaseBuffer:function(b,a){if(a){b.deleteBuffer(a);a=undefined}},getPointToPolygonCross:function(i,h,f,e,d){if(Gd.eqVec3(f,e)||Gd.eqVec3(e,d)||Gd.eqVec3(f,d)){return undefined}var c=(d.clone().sub(f)).cross(e.clone().sub(f));var a=((i.clone().sub(f)).dot(c))*((h.clone().sub(i)).length())/((h.clone().sub(i)).dot(c));if(a<0){a=-a}var b=h.clone().sub(i);b.normalize();var g=b.multNum(a).add(i);return g},isPointInPolygon:function(k,j,h,f,e){if(Gd.eqVec3(k,j)||Gd.eqVec3(k,h)||Gd.eqVec3(k,f)||Gd.eqVec3(k,e)){return true}var c=j.clone().sub(k);var b=h.clone().sub(k);var a=f.clone().sub(k);var i=c.cross(b);var g=b.cross(a);if(i.dot(g)<0){return false}var l=e.clone().sub(k);i.set(g);g=a.cross(l);if(i.dot(g)<0){return false}i.set(g);g=l.cross(c);if(i.dot(g)<0){return false}var d=c.length();if(d>(j.clone().sub(f)).length()){return false}return true},floorNumToName:function(a){if(a<0){return"B"+Math.abs(a)}return"F"+a},pointDisToSegment:function(m,l,v,j,t,i){var n={};var D=t-v;var C=m-v;var B=i-j;var A=l-j;var z=m-t;var w=l-i;var k=D*C+B*A;if(k<=0){n.distance=Math.sqrt(C*C+A*A);n.x=v;n.y=j;return n}var E=D*D+B*B;if(k>=E){n.distance=Math.sqrt(z*z+w*w);n.x=t;n.y=i;return n}var q=k/E;var p=v+D*q;var o=j+B*q;var u=m-p;var s=l-o;n.x=p;n.y=o;n.distance=Math.sqrt(u*u+s*s);return n},transformPoint:function(b,g,a,d){var j;for(var c=0;c<g.length-1;c++){var h=g[c];var f=g[c+1];if(d==h.fname&&h.fname==f.fname){var e=Gd.pointDisToSegment(b.x,b.y,h.x,h.y,f.x,f.y);if(!j){j=e}else{if(j.distance>e.distance){j=e}}}}if(j&&j.distance<=a){return new GHPoint2D(Gd.toFixed(j.x),Gd.toFixed(j.y))}return b},toFixed:function(b,a){a=a==undefined?2:a;return parseFloat(b.toFixed(a))},isRoad:function(a){return a=="600002"},isForbid:function(a){return a&&a.length==4&&9==a.charAt("0")},isWall:function(a){return a.indexOf("999")==0||a=="570006"},isDecArea:function(a){return a=="1001"||a=="1002"||a=="1003"||a=="1004"},queryByAttr:function(d,b,c){for(var a=0;a<d.length;a++){if(d[a][b]==c){return d[a]}}return undefined},isPowerOf2:function(a){return(a&(a-1))==0},calRelativeHeight:function(b,a){return a},lineIntersect:function(o,n,m,l){var k={x:o.getX(),y:o.getY()};var i={x:n.getX(),y:n.getY()};var g={x:m.getX(),y:m.getY()};var f={x:l.getX(),y:l.getY()};var e=(i.y-k.y)*(f.x-g.x)-(k.x-i.x)*(g.y-f.y);if(e==0){return false}var j=((i.x-k.x)*(f.x-g.x)*(g.y-k.y)+(i.y-k.y)*(f.x-g.x)*k.x-(f.y-g.y)*(i.x-k.x)*g.x)/e;var h=-((i.y-k.y)*(f.y-g.y)*(g.x-k.x)+(i.x-k.x)*(f.y-g.y)*k.y-(f.x-g.x)*(i.y-k.y)*g.y)/e;return new GH(j,h,o.getZ())},copyTo:function(c,a){a=a||{};for(var b in c){a[b]=c[b]}return a},addColor:function(d,b){var a=new GI();a.setW(1);var b=b/256;a.setX(d.getX()+b);a.setY(d.getY()+b);a.setZ(d.getZ()+b);if(a.getX()<0){a.setX(0)}else{if(a.getX()>1){a.setX(1)}}if(a.getY()<0){a.setY(0)}else{if(a.getY()>1){a.setY(1)}}if(a.getZ()<0){a.setZ(0)}else{if(a.getZ()>1){a.setZ(1)}}return a}};var GHConstants={FLOOR_HEIGHT:20,FLOOR_GAP:1500,RENDER_FLOOR_HEIGHT:0,RENDER_DECFACE_HEIGHT:1,RENDER_DECLINE_HEIGHT:1.3,RENDER_SPACE_HEIGHT:1.4,RENDER_SPACE_LINE_HEIGHT:1.6,RENDER_OVERLAY_POLYGON_HEIGHT:3,RENDER_AREAFACE_HEIGHT:4,DBCLICK_INTERVAL:250,DEFAULT_FILL_COLOR:"#FFFFFF",DEFAULT_LINE_COLOR:"#CCCCCC",DEFAULT_DECFACE_LINE_COLOR:"#FFFFFF",DEFAULT_SPACE_LINE_COLOR:"#FFFFFF",DEFAULT_SPACE_BOTTOM_COLOR:"#787878",DEFAULT_SPACE_TEXT_COLOR:"black",DEFAULT_SPACE_TEXT_STROKE_COLOR:"white",DEFAULT_SPACE_TEXT_STROKE_WIDTH:2,DEFAULT_SPACE_TEXT_SHOW_STROKE:true,DEFAULT_TEXT_SCALE:1,DEFAULT_TEXT_STROKE_WIDTH:0,DEFAULT_WALL_ALPHA:1,RENDER_TYPE_POLYGON:"polygon",RENDER_TYPE_LINE:"line",DEFAULT_LINE_WIDTH:2,DEFAULT_SPACE_FONT_SCALE:3,LOC_STATE:1,LOC_ANCHOR:GHMark.Anchor.CENTER,IMAGE_PRE:"./image/",COMPASS_LEFT_TOP:1,COMPASS_RIGHT_TOP:2,DOTTED_LENGTH:10};var GHType=GHType||{POI:100,SPACE:101};var Ge=Ge||function(w,s){var p=this;var c=w;this.floorItemArray=s;var j=Gd.createDiv("floorTitle");var i=Gd.createDiv("floorItemContainer");var d=w._defaultFloorName;var m=800,u=25;var q;var n=-9999,l=-9999;function r(){var A=document.getElementById("floorView");if(!A||!p.floorItemArray){return}g();A.innerHTML="";if(p.floorItemArray&&p.floorItemArray.length>0){j.innerHTML=d;j.onclick=function(){a()};q=p.floorItemArray.length*u+37;A.appendChild(j);for(var y=0;y<p.floorItemArray.length;y++){var x=p.floorItemArray[y];var z;z=Gd.createDiv("floorItem");if(n==x.floorName){z.className="floorItemStart"}else{if(l==x.floorName){z.className="floorItemEnd"}else{if(d==x.floorName){z.className="floorItemSeleted"}}}z.innerHTML=x.floorName;z.floorName=x.floorName;z.onclick=function(){t(this)};i.appendChild(z)}if(q>=m){q=m}e=q;i.style.height=q+"pt";A.appendChild(i)}}function g(){var z=false;for(var y=0;y<p.floorItemArray.length;y++){var x=p.floorItemArray[y];if(d==x.floorName){z=true;break}}if(!z){d=p.floorItemArray[0]["floorName"]}c.setCurFloor(d)}this.findFloorItemByIndex=function(z){for(var y=0;y<p.floorItemArray;y++){var x=p.floorItemArray[y];if(floorName==x.floorName){return x}}return null};this.getFloor=function(){return floorName};this.setStartFloor=function(x){n=x;f()};this.setEndFloor=function(x){l=x;f()};this.clearStartEndFloor=function(){n=-9999;l=-9999;f()};function t(x){p.setFloor(x.floorName)}this.setFloor=function(x){if(x!=d){d=x;j.innerHTML=x;f();c.setCurFloor(x)}};function f(){var z=i.children;for(var y=0;y<z.length;y++){var x=z[y];if(n==x.floorName){x.className="floorItemStart"}else{if(l==x.floorName){x.className="floorItemEnd"}else{if(d==x.floorName){x.className="floorItemSeleted"}else{x.className="floorItem"}}}}}this.setData=function(x){this.floorItemArray=x;r()};this.setMaxHeight=function(x){m=x;r()};this.render=function(){f()};var b=1;var o=2;var h=0;var k=h;var e=0;var v;function a(){if(k==h){if(e==0){k=b}else{k=o}v=setInterval("_aa()",10)}else{if(k==b){k=o}else{k=b}}}window._aa=function(){if(k==b){i.style.display="";e+=10;i.style.height=e+"pt";if(e>=q){e=q;clearInterval(v);v=null;k=h}}else{e-=10;i.style.height=e+"pt";if(e<=0){e=0;clearInterval(v);v=null;k=h;i.style.height="0pt"}}};r()};var Gf=Gf||function(f){var b=f;var d=null;var e,a;this.createProgram=function(h,g){e=c(b.VERTEX_SHADER,h);a=c(f.FRAGMENT_SHADER,g);d=f.createProgram();f.attachShader(d,e);f.attachShader(d,a);f.linkProgram(d);if(!b.getProgramParameter(d,f.LINK_STATUS)){alert("Unable to initialize the shader program: "+f.getProgramInfoLog(d));return null}};this.getAttribLocation=function(g){return f.getAttribLocation(d,g)};this.getUniformLocation=function(g){return f.getUniformLocation(d,g)};this.useProgram=function(){f.useProgram(d)};this.getId=function(){return d};this.isValid=function(){return d!=null};function c(h,i){var g=f.createShader(h);b.shaderSource(g,i);b.compileShader(g);if(!b.getShaderParameter(g,b.COMPILE_STATUS)){alert("An error occurred compiling the shaders: "+b.getShaderInfoLog(g));alert(i);return null}return g}this.release=function(){f.deleteShader(e);f.deleteShader(a);f.deleteProgram(d);e=undefined;a=undefined;d=undefined}};var Gg=Gg||function(){this.screenToWord=function(j,i,h,l,k,g,m){var n=[0,0,g,m];var o=d(j,i,h,l,k,n);return o};this.worldToScreen=function(k,i,h,j,m,l,g){var n=[0,0,l,g];return b(k,i,h,j,m,n)};function b(m,k,i,l,n,h){var g=new Array(4);g[0]=m;g[1]=k;g[2]=i;g[3]=1;var j=e(l,g);g=e(n,j);if(g[3]==0){return new GH()}g[0]/=g[3];g[1]/=g[3];g[2]/=g[3];g[0]=g[0]*0.5+0.5;g[1]=g[1]*0.5+0.5;g[2]=g[2]*0.5+0.5;g[0]=g[0]*h[2]+h[0];g[1]=g[1]*h[3]+h[1];return new GH(g[0],g[1],g[2])}function d(j,i,h,n,m,o){var p=new GH();var g=f(n,m);g=c(g);if(!g){return undefined}var l=[j,i,h,1];l[0]=(l[0]-o[0])/o[2];l[1]=(l[1]-o[1])/o[3];l[0]=l[0]*2-1;l[1]=l[1]*2-1;l[2]=l[2]*2-1;var k=e(g,l);if(k[3]==0){return undefined}k[0]/=k[3];k[1]/=k[3];k[2]/=k[3];p.setX(k[0]);p.setY(k[1]);p.setZ(k[2]);return p}function f(l,m){var g=new GK();for(var k=0;k<4;k++){for(var h=0;h<4;h++){g.data[k*4+h]=l.data[k*4+0]*m.data[0*4+h]+l.data[k*4+1]*m.data[1*4+h]+l.data[k*4+2]*m.data[2*4+h]+l.data[k*4+3]*m.data[3*4+h]}}return g}function e(h,g){var j=[0,0,0,0];for(var k=0;k<4;k++){j[k]=g[0]*h.data[0*4+k]+g[1]*h.data[1*4+k]+g[2]*h.data[2*4+k]+g[3]*h.data[3*4+k]}return j}function c(m){var p,n,l,q;var o;var h=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];for(p=0;p<4;p++){for(n=0;n<4;n++){h[p][n]=m.data[p*4+n]}}var g=new GK();g.identity();for(p=0;p<4;p++){q=p;for(n=p+1;n<4;n++){if(Math.abs(h[n][p])>Math.abs(h[p][p])){q=n}}if(q!=p){for(l=0;l<4;l++){o=h[p][l];h[p][l]=h[q][l];h[q][l]=o;o=g.data[p*4+l];g.data[p*4+l]=g.data[q*4+l];g.data[q*4+l]=o}}if(h[p][p]==0){return undefined}o=h[p][p];for(l=0;l<4;l++){h[p][l]/=o;g.data[p*4+l]/=o}for(n=0;n<4;n++){if(n!=p){o=h[n][p];for(l=0;l<4;l++){h[n][l]-=h[p][l]*o;g.data[n*4+l]-=g.data[p*4+l]*o}}}}return g}function a(h){var l=new GK();var g=[];g[0]=h[5]*h[10]*h[15]-h[5]*h[11]*h[14]-h[9]*h[6]*h[15]+h[9]*h[7]*h[14]+h[13]*h[6]*h[11]-h[13]*h[7]*h[10];g[4]=-h[4]*h[10]*h[15]+h[4]*h[11]*h[14]+h[8]*h[6]*h[15]-h[8]*h[7]*h[14]-h[12]*h[6]*h[11]+h[12]*h[7]*h[10];g[8]=h[4]*h[9]*h[15]-h[4]*h[11]*h[13]-h[8]*h[5]*h[15]+h[8]*h[7]*h[13]+h[12]*h[5]*h[11]-h[12]*h[7]*h[9];g[12]=-h[4]*h[9]*h[14]+h[4]*h[10]*h[13]+h[8]*h[5]*h[14]-h[8]*h[6]*h[13]-h[12]*h[5]*h[10]+h[12]*h[6]*h[9];g[1]=-h[1]*h[10]*h[15]+h[1]*h[11]*h[14]+h[9]*h[2]*h[15]-h[9]*h[3]*h[14]-h[13]*h[2]*h[11]+h[13]*h[3]*h[10];g[5]=h[0]*h[10]*h[15]-h[0]*h[11]*h[14]-h[8]*h[2]*h[15]+h[8]*h[3]*h[14]+h[12]*h[2]*h[11]-h[12]*h[3]*h[10];g[9]=-h[0]*h[9]*h[15]+h[0]*h[11]*h[13]+h[8]*h[1]*h[15]-h[8]*h[3]*h[13]-h[12]*h[1]*h[11]+h[12]*h[3]*h[9];g[13]=h[0]*h[9]*h[14]-h[0]*h[10]*h[13]-h[8]*h[1]*h[14]+h[8]*h[2]*h[13]+h[12]*h[1]*h[10]-h[12]*h[2]*h[9];g[2]=h[1]*h[6]*h[15]-h[1]*h[7]*h[14]-h[5]*h[2]*h[15]+h[5]*h[3]*h[14]+h[13]*h[2]*h[7]-h[13]*h[3]*h[6];g[6]=-h[0]*h[6]*h[15]+h[0]*h[7]*h[14]+h[4]*h[2]*h[15]-h[4]*h[3]*h[14]-h[12]*h[2]*h[7]+h[12]*h[3]*h[6];g[10]=h[0]*h[5]*h[15]-h[0]*h[7]*h[13]-h[4]*h[1]*h[15]+h[4]*h[3]*h[13]+h[12]*h[1]*h[7]-h[12]*h[3]*h[5];g[14]=-h[0]*h[5]*h[14]+h[0]*h[6]*h[13]+h[4]*h[1]*h[14]-h[4]*h[2]*h[13]-h[12]*h[1]*h[6]+h[12]*h[2]*h[5];g[3]=-h[1]*h[6]*h[11]+h[1]*h[7]*h[10]+h[5]*h[2]*h[11]-h[5]*h[3]*h[10]-h[9]*h[2]*h[7]+h[9]*h[3]*h[6];g[7]=h[0]*h[6]*h[11]-h[0]*h[7]*h[10]-h[4]*h[2]*h[11]+h[4]*h[3]*h[10]+h[8]*h[2]*h[7]-h[8]*h[3]*h[6];g[11]=-h[0]*h[5]*h[11]+h[0]*h[7]*h[9]+h[4]*h[1]*h[11]-h[4]*h[3]*h[9]-h[8]*h[1]*h[7]+h[8]*h[3]*h[5];g[15]=h[0]*h[5]*h[10]-h[0]*h[6]*h[9]-h[4]*h[1]*h[10]+h[4]*h[2]*h[9]+h[8]*h[1]*h[6]-h[8]*h[2]*h[5];var k=h[0]*g[0]+h[1]*g[4]+h[2]*g[8]+h[3]*g[12];if(k===0){return false}k=1/k;for(var j=0;j<16;j=j+1){l.data[j]=g[j]*k}return l}};var Gh=Gh||function(a,c){this.sleepTime=30;this.count=15;this.map=a;this.camera=a.getCamera();this.index=0;this.animationId=c;var b=this;this.ID;this.start=function(){b.index=0;b.ID=setTimeout(b.run,10);if(b.animationId!=Gh.TYPE.LOCATION){b.map._onAnimationStart(b.animationId)}};this.stop=function(){if(b.ID){clearTimeout(b.ID);b.ID=undefined;if(b.animationId!=Gh.TYPE.LOCATION){b.map._onAnimationEnd(b.animationId)}}};this.run=function(){};this.runing=function(){if(b.animationId!=Gh.TYPE.LOCATION){b.map._onAnimationing(b.animationId)}}};Gh.TYPE={ZOOM_IN:100,ZOOM_OUT:200,PAN:300,SWITCH:400,LOCATION:500,ROTATION:600,VALUE_ANIMATION:700,MARK_ROTATE:800};Gh.Translate=function(b,d){Gh.call(this,b,d);var a;var c=this;this.run=function(){c.index++;if(c.animationId==Gh.TYPE.PAN){c.camera.eyeAndCenterTranslate(a)}else{c.camera.eyeTranslate(a)}if(c.index<c.count){c.runing();c.ID=setTimeout(c.run,c.sleepTime)}else{c.stop()}if(c.animationId==Gh.TYPE.PAN){c.map.updatePoi()}else{c.map._mapScaleListener()}c.map.refresh()};this.setVec=function(e){a=e.multNum(1/c.count)}};Gh.Switch=function(c){Gh.call(this,c,Gh.TYPE.SWITCH);var a,b;var d=this;this.setValue=function(e,f){a=e/d.count;b=f/d.count};this.run=function(){d.index++;d.map._setHeightScale(d.map._getHeightScale()+b,false);d.camera.setPitch(Gd.angleToRadians(d.map.getPitch()+a));if(d.index<d.count){d.runing();d.ID=setTimeout(d.run,d.sleepTime)}else{d.stop()}d.map.updatePoi();d.map.refresh()}};Gh.ROTATE=function(b){Gh.call(this,b,Gh.TYPE.ROTATION);var a;var c=this;this.setValue=function(d){a=d/c.count};this.run=function(){c.index++;c.camera.setNorth(Gd.angleToRadians(c.map.getRotate()+a));if(c.index<c.count){c.runing();c.ID=setTimeout(c.run,c.sleepTime)}else{c.stop()}c.map.updatePoi();c.map.refresh()}};Gh.AnimationTo=function(d,g){Gh.call(this,d,Gh.TYPE.VALUE_ANIMATION);var c=g;var f=this;var e=g.getPoint();var b,a;this.count=10;this.sleepTime=100;this.index=0;this.autoCenter=false;this.setValue=function(h,i){b=(h.x-e.x)/f.count;a=(h.y-e.y)/f.count;this.autoCenter=i};this.run=function(){e.x+=b;e.y+=a;f.index++;if(f.index<f.count){f.runing();f.ID=setTimeout(f.run,f.sleepTime)}else{f.stop()}f.map.updateMark(c,new GHPoint2D(e.x,e.y));if(f.autoCenter==true){f.map.setCenter(c.getPoint())}else{f.map.refresh()}}};Gh.Location=function(d){Gh.call(this,d,Gh.TYPE.LOCATION);var a,e;var g;var b=false;var c;var f=this;this.count=10;this.sleepTime=100;this.setLocLayer=function(h){g=h};this.setValue=function(h,k){b=false;if(a==undefined||a!=k){b=true}a=k;if(!e||b){e=new GHPoint2D(h.x,h.y);c=undefined}else{var j=(h.x-e.x)/f.count;var i=(h.y-e.y)/f.count;c=new GHPoint2D(j,i)}};this.run=function(){if(b||!c){g.updatePointAndFloor(e,a);f.stop();return}f.index++;e.x+=c.x;e.y+=c.y;if(f.index<f.count){f.runing();f.ID=setTimeout(f.run,f.sleepTime)}else{f.stop()}g.updatePointAndFloor(e,a)};this.clear=function(){a=undefined;e=undefined;c=undefined}};var Gi=Gi||function(b){var c=b;var k=53;this.eye=new GH();this.center=new GH();this.up=new GH();this.axis=new GH();this.width=0;this.height=0;this.aspect=0;this.znear=0;this.zfar=0;var f=0;this.projMatrix=new GK();this.modelMatrix=new GK();this.mvpMatrix=new GK();var j;var d=0;this.zoomLength=0;this.maxLength=0;this.minLength=0;var i=0;var e=0;var a=0;var h=this;this.extent={};this.initViewPort=function(m,l){this.width=m;this.height=l;this.aspect=m/l;c.gl.viewport(0,0,this.width,this.height);c.gl.scissor(0,0,this.width,this.height)};this.resize=function(m,l){this.initViewPort(m,l);this.makeMvp();this.calPixelScale()};this.setCenter=function(l){this.center.set(l)};this.zoomBox=function(x,v,s,q){var u=s-x;var p=q-v;var o=(s+x)/2;var n=(q+v)/2;var m=u/p;var l=u;if(m<this.aspect){l=p}var r=Gd.angleToRadians(k);var t=l/(2*Math.tan(r/2));this.center.setX(o);this.center.setY(n);this.center.setZ(c.getCurFloorHeight());this.eye.setValue(o,n,t+this.center.getZ());this.up.set(new GH(0,1,0));if(x==0&&v==0&&s==c._dataWidth&&q==c._dataHeight){this.zoomLength=t;this.maxLength=this.zoomLength*2;this.minLength=this.zoomLength/Math.pow(2,c.getMaxZoom()-1);i=this.zoomLength/Math.pow(2,0.5);e=this.zoomLength/Math.pow(2,1.5);a=i-e}this.setPitch(f,this.center,true);this.makeMvp()};this.zoomToExtent=function(){this.zoomBox(0,0,c._dataWidth,c._dataHeight)};this.setZoom=function(n){if(!n){return}if(n<1){n=1}else{if(n>c.getMaxZoom()){n=c.getMaxZoom()}}var l=Math.pow(2,n);l=this.maxLength/l;var m=this.eye.clone().sub(this.center);m.normalize();m.multNum(l);m.add(this.center);this.eye.set(m);this.makeMvp();this.calPixelScale()};this.getZoom=function(){var m=this.eye.clone().sub(this.center);var l=m.length();l=this.maxLength/l;return Gd.toFixed(Math.log(l)/Math.log(2)+1)};this.centerTranslate=function(l){this.eye.center.add(l);this.makeMvp()};this.eyeTranslate=function(l){this.eye.add(l);this.makeMvp()};this.eyeAndCenterTranslate=function(n){var l=this.center.clone().add(n);var m=c._getMaxHeight();if(l.getZ()<-m/2||l.getZ()>m*2){return}this.center.add(n);this.eye.add(n);this.makeMvp();if(this._canMove()){c._mapMoveListener()}else{this.center.sub(n);this.eye.sub(n);this.makeMvp()}};this.scale=function(p,m){if(p==1){return}var r=m||this.center;var q=this.eye.clone();q.sub(r);var l=q.length();var o=l*p;if(p>1){if(o>this.maxLength){o=this.maxLength}}else{if(o<this.minLength){o=this.minLength}}q.normalize();q.multNum(o);var n=r.clone();n.add(q);this.eye.set(n);this.makeMvp();c._mapScaleListener()};this.scaleAnimation=function(o,r){if(o==1){return}var q=this.center;var p=this.eye.clone();p.sub(q);var l=p.length();var n=l*o;if(o>1){if(n>this.maxLength){n=this.maxLength}}else{if(n<this.minLength){n=this.minLength}}p.normalize();p.multNum(n);var m=q.clone();m.add(p);m.sub(this.eye);if(!m.isEmpty()){c._panAnimation(m,r)}};this.setNorth=function(r,l){var s=this.getNorth();var p=r-s;if(p==0){return}var q=l||this.center;var n=new GH(0,0,1);var t=new GK();t.rotate(p,n);var m=this.eye.clone();m.sub(q);var o=m.multMat4(t);this.up=this.up.multMat4(t);this.up.normalize();o.add(q);this.eye.set(o);this.makeMvp();c._mapRotateListener()};this.getNorth=function(){var m=new GH(0,1,0);var l=new GH(this.up.getX(),this.up.getY(),0);var n=Gd.getAngle(new GH(0,0,0),m,l);if(l.getX()>0){n=2*Math.PI-n}return n};this.setPitch=function(n,m,v){if(f==n&&!v){return false}var u=Gd.angleToRadians(c.getMaxPitch());if(n>u){n=u}if(n<0){n=0}var q=m||this.center;f=n;var s=this.eye.clone();var o=this.center.clone();var p=new GH(this.up.getX(),this.up.getY(),0);var r=new GH(0,0,s.clone().sub(o).length());var l=new GK();l.rotate(n,p.cross(r));s=r.multMat4(l).add(o);var t=p.multMat4(l);this.eye.set(s);this.up.set(t);this.makeMvp();c._mapPitchListener();return true};this.getPitch=function(){return f};this.setFloorCount=function(l){j=GHConstants.FLOOR_HEIGHT*l+(l-1)*GHConstants.FLOOR_GAP};this.makeMvp=function(){this.makeLookAt();this.makePerspective();var n=new Array(4);n[0]=c.px2gp(0,0);n[1]=c.px2gp(this.width,this.height);n[2]=c.px2gp(0,this.height);n[3]=c.px2gp(this.width,0);var m=Number.MAX_VALUE;var l=Number.MAX_VALUE;var r=Number.MIN_VALUE;var p=Number.MIN_VALUE;for(var o=0;o<4;o++){var q=n[o];m=Math.min(m,q.x);r=Math.max(r,q.x);l=Math.min(l,q.y);p=Math.max(p,q.y)}this.extent={minx:m,maxx:r,miny:l,maxy:p}};this.makeLookAt=function(){this.modelMatrix.lookAt(this.eye,this.center,this.up);var l=this.eye.clone().sub(this.center);this.axis=this.up.cross(l);this.axis.normalize();this.up.normalize()};var g=false;this.makePerspective=function(){var m=this.eye.clone().sub(this.center).length();var o=Math.tan(f)*Math.tan(Gd.angleToRadians(k)/2);var n=m*o/(1+o);if(c.is3DAll()){var q=c._getMaxHeight();var p=q>this.center.getZ()?(q-this.center.getZ()):(q+this.center.getZ());this.znear=m-Math.max(p,Math.max(c._dataWidth,c._dataHeight))-10}else{this.znear=m-n-GHConstants.FLOOR_HEIGHT*c.getStyleMaxHeightScale()-GHConstants.FLOOR_GAP-10}if(this.znear<=0){this.znear=10}this.zfar=m+Math.max(c._dataWidth,c._dataHeight)+100000;this.projMatrix.identity();this.projMatrix.perspective(k,this.aspect,this.znear,this.zfar)};this.calPixelScale=function(m){var n=this.eye.clone().sub(this.center);if(!m){m=0}var o=n.length()-m/Math.cos(f);var l=o*Math.tan(Gd.angleToRadians(k)/2)*2/this.height;return l};this.cal3DAllPixelScale=function(){var m=this.eye.clone().sub(this.center).length();var l=m/Math.tan(Gd.angleToRadians(k)/2)/(this.height*2);return l};this.screenToWorld=function(w,v,r){var m=this.modelMatrix.clone();var x=this.projMatrix.clone();var n=w;var l=this.height-v;var y;if(r>0&&r<1){y=c.project.screenToWord(n,l,r,m,x,this.width,this.height);return y}var u=this.screenToWorld(w,v,0.9999999);var t=this.screenToWorld(w,v,1e-7);var q,p,o;q=new GH(this.center.getX(),this.center.getY(),this.center.getZ()+r);p=new GH(q.getX()+10,q.getY(),q.getZ());o=new GH(q.getX(),q.getY()+10,q.getZ());var s=Gd.getPointToPolygonCross(t,u,q,p,o);return s};this.worldToScreen=function(m,q){var l=this.modelMatrix.clone();var r=this.projMatrix.clone();var n;if(q){n=m.getZ()}else{n=m.getZ()+this.center.getZ()}var s=new GH(m.getX(),m.getY(),n);var t=c.project.worldToScreen(s.getX(),s.getY(),s.getZ(),l,r,this.width,this.height);var p=t.getX();var o=this.height-t.getY();return new GHPixel(Gd.toFixed(p),Gd.toFixed(o))};this.showAreaFace=function(){if(!c.showArea){return false}var m=this.eye.clone().sub(this.center);var l=m.length();return l>e};this.getAreaFaceAlpha=function(){var n=this.eye.clone().sub(this.center);var m=n.length();var l=0;if(m>e){if(m<=i){l=(m-e)/a}else{l=1}}return l};this._getRay=function(s,q){var n=this.modelMatrix.clone();var t=this.projMatrix.clone();var o=s;var m=this.height-q;var p=this.eye.clone();var r=c.project.screenToWord(o,m,0.5,n,t,this.width,this.height);var l=r.clone().sub(p);return new GOB(p,l)};this._canMove=function(){var m=c._b();var o=this.cal3DAllPixelScale();var p=o*this.width/4;var n=o*this.height/4;var l={minx:this.extent.minx+p,maxx:this.extent.maxx-p,miny:this.extent.miny+n,maxy:this.extent.maxy-n};return Gd.intersect(m,l)||Gd.rectContainsRect(m,l)||Gd.rectContainsRect(l,m)}};var GHMap=GHMap||function(M,G,ab,m,Z){this.CLASSNAME="GHMap";if(!Z){Z={}}var v=this;this._mode=Z.mode===undefined?1:Z.mode;this.logoScale=Z.logoScale||1;this.compassScale=Z.compassScale||1;this.highlightColor=Z.highlightColor||"#FFFF00";this.opAlpha=Z.opAlpha||0.8;this.showArea=Z.showArea!=undefined?Z.showArea:true;this.compassVisible=Z.compassVisible==undefined?true:Z.compassVisible;this.logoVisible=Z.logoVisible==undefined?true:Z.logoVisible;this.compassPosition=Z.compassPosition==undefined?GHConstants.COMPASS_LEFT_TOP:Z.compassPosition;this.startEndPointScale=Z.startEndPointImageScale==undefined?1:Z.startEndPointImageScale;this._loadSkin=Z.loadSkin==true?true:false;this._logoAngle=Z.logoAngle==undefined?0:Z.logoAngle;this._objOffsetZ=Z.objOffsetZ==undefined?0:Z.objOffsetZ;this._useObj=Z.useObj==undefined?true:Z.useObj;this._baseStyle=Z.baseStyle==undefined?new Array():Z.baseStyle;this._onlyShowObj=Z.onlyShowObj;this._useClusterAnimation=Z.useClusterAnimation;this._specularFactor=Z.specularFactor||50;var R=Z.specularColor||"#FFFFFF";var y=Gd.getVector4FromColorStr(R);this._specucolor=new Float32Array([y.getX(),y.getY(),y.getZ()]);this._diffuseMinFactor=Z.diffuseMinFactor==undefined?0:Z.diffuseMinFactor;this._diffuseMaxFactor=Z.diffuseMaxFactor==undefined?1:Z.diffuseMaxFactor;this._useLight=Z.useLight==undefined?false:Z.useLight;this._lights=[];this._renderLight={};this._onlyShowArea=Z.onlyShowArea;_heatmapPointCount=Z.heatMapPointCount||36;this._plugins=new Array();var H;this.gl;var ay;var A=m;this.mvpMatrix;var at={};var ax=false;var F;var e=new Array();var aC,d;var S;var X=false;var a=false,aB=false;this.fontScale=1;this._fontScale2=1;var r=50;if(v._mode==2){r=89}var af=Z.maxZoom||6;var p=false;this.project=new Gg();var ap=1;var an=Z.fade==undefined?true:Z.fade;var l="http://app.guangyihengxin.com:8080/mapapi/";if(Z&&Z.serverurl){l=Z.serverurl}var am=(Z&&Z.objurl)||l;var ah=(Z&&Z.objscale)||1;var k=l+"api/";var j=ab;var w=new GA(k,j);var b=G;var f;var C="3dmap";this.onMapClickListener;this.onMapDoubleClickListener;this.onMapMoveListener;var ak,aA;var U,K,ar;var ag="#e84647";var W=false;var B=true;var E=true;this._dataWidth;this._dataHeight;var ac;var P=[];var av=new GDList(this);var O=Z.showChinese==undefined?true:Z.showChinese;var ae=Z.imageScale||1;var L=new ObjLoader(this);var az=false;var Q;this._imageTextureLoader=new Gj(this);var V=0;var T=0;var ai=0;this._defaultFloorName=Z.floorName||"F1";var I=new GCN(this);var J=new Ge(this);var u=true;function ad(){var aF=document.head.childElementCount;for(var aE=0;aE<aF;aE++){var aI=document.head.children[aE];if(aI.hasAttribute("name")&&aI.getAttribute("name")=="viewport"){if(aI.hasAttribute("content")){az=aI.getAttribute("content").indexOf("width=device-width")>-1}break}}Q=document.getElementById(M);Q.style.width=Q.width+"px";Q.style.height=Q.height+"px";if(window.screen.width){v.fontScale=Q.width/window.screen.width;if(!az){v.fontScale/=window.devicePixelRatio}v._fontScale2=1/v.fontScale/v.fontScale}if(az){Q.width*=window.devicePixelRatio;Q.height*=window.devicePixelRatio}S=new GO(v,Q);if(!Q.getContext){alert("该设备不支持WebGL");return}var aH={stencil:true};v.gl=Q.getContext("webgl",aH)||Q.getContext("experimental-webgl",aH);if(!v.gl){alert("该设备不支持WebGL");return}ay=new Gi(v);aC=new Gb(v);d=new Gc(v);f=new Ga(v);ay.initViewPort(Q.width,Q.height);var aG="0";var c=GC.get(b+"_v");if(c&&"undefined"!=c){aG=c}var aH={buildNum:b,v3d:"1",versionNum:aG};w.getBuilding(C,aH,function(aJ){ao(aJ,aH)})}function ao(aG,aK){var aL;if(aG&&aG.body){if(aG.body.vn==undefined||aG.body.vn>parseInt(aK.versionNum)){aL=aG.body;GC.set(b+"",JSON.stringify(aL));GC.set(b+"_v",aG.body.vn+"")}else{aL=GC.get(b+"");if(aL){aL=JSON.parse(aL)}}}else{aL=GC.get(b+"");if(aL){aL=JSON.parse(aL)}}if(!aL){alert("网络错误");return}F={minx:aL.minX,miny:aL.minY,maxx:aL.maxX,maxy:aL.maxY};ac=aL.scale||10;ay.setFloorCount(aL.c.length);z(aL.ss);var aR=aL.maxY-aL.minY;var aF=aL.maxX-aL.minX;v._dataWidth=aF;v._dataHeight=aR;var aT=[];var aH=aL.c;for(var aM=0;aM<aH.length;aM++){var aO=new GY(v,Gd.floorNumToName(aH[aM].fn),aH[aM].fn);var aN=(aH.length-aM-1)*(GHConstants.FLOOR_HEIGHT+GHConstants.FLOOR_GAP);aO.setHeight(aN);e.push(aO);aO.index=aM;if(aO.floorName==v._defaultFloorName){H=aO}aT.push({floorName:Gd.floorNumToName(aH[aM].fn),floorNum:aH[aM].fn})}if(!H){H=e[0]}ay.zoomToExtent();J.setData(aT);T=aH.length;for(var aM=0;aM<aH.length;aM++){var aS=aH[aM];var aJ=N(aS.fn);setTimeout(n(aJ,aS),aM*300)}var aI=aL.dfs;V=aI.length;for(var aM=0;aM<aI.length;aM++){var aJ=N(aI[aM].fn);var aP=aI[aM];setTimeout(aq(aJ,aP),aM*2)}var aQ=aL.afs;ai=aQ.length;for(var aM=0;aM<aQ.length;aM++){var aJ=N(aQ[aM].fn);var aE=aQ[aM];setTimeout(Y(aJ,aE),aM*2)}var c=aL.dls;for(var aM=0;aM<c.length;aM++){var aJ=N(c[aM].fn);aJ.addDecLine(c[aM])}for(var aM=0;aM<e.length;aM++){e[aM].updateDecLineFlatten()}setTimeout(aw(aL),200);setTimeout(aD(v),1500);aL=null}function aD(c){return function(){if(V==0&&T==0&&ai==0){c.setPitch(r);a=true;A(c);aB=true;f.update();setTimeout(function(){c.refresh()},0)}else{setTimeout(aD(c),200)}}}function n(aE,c){return function(){aE.addData(c);T=0}}function aq(aE,c){return function(){V--;aE.addDecFace(c);if(V==0){for(var aF=0;aF<e.length;aF++){e[aF].updateDecFaceFlatten()}}}}function Y(c,aE){return function(){ai--;c.addAreaFace(aE);if(ai==0){for(var aF=0;aF<e.length;aF++){e[aF].updateAreaFaceFlatten()}}}}function aw(aG){var c=aG.ps;for(var aF=0;aF<c.length;aF++){var aE=N(c[aF].fn);aE.addPubPoi(c[aF])}}function z(aE){for(var c=0;c<aE.length;c++){av.addLineStr(aE[c])}}this.refresh=function(c){if(!a){return}if(this._renderId){cancelAnimationFrame(this._renderId);this._renderId=undefined}(function(aE){aE._renderId=requestAnimationFrame(function(){aE._R();aE._renderId=undefined})})(this)};this.isLoadEnd=function(){return a};this.getNavigation=function(){return I};this._getDataScale=function(){return ac};this._R=function(){var aF=this.gl;aF.enable(aF.SCISSOR_TEST);X=true;this.mvpMatrix=ay.projMatrix.mult(ay.modelMatrix);this.invMatrix=ay.modelMatrix.inverse();var c=ay.center.clone();if(at.rgba){aF.clearColor(at.rgba.getX(),at.rgba.getY(),at.rgba.getZ(),1)}else{aF.clearColor(0.88,0.88,0.88,1)}aF.clearDepth(1);aF.clear(aF.COLOR_BUFFER_BIT|aF.DEPTH_BUFFER_BIT|aF.STENCIL_BUFFER_BIT);aF.enable(aF.DEPTH_TEST);aF.depthFunc(aF.LEQUAL);aF.enable(aF.BLEND);aF.blendFunc(aF.SRC_ALPHA,aF.ONE_MINUS_SRC_ALPHA);aF.blendEquation(aF.FUNC_ADD);if(ax){for(var aE=e.length-1;aE>=0;aE--){e[aE].render(c.data);aC.render(c.data,e[aE]);aF.disable(aF.DEPTH_TEST);aC.renderPoi(c.data,e[aE]);aF.enable(aF.DEPTH_TEST)}aC.renderUpDownRoute(c.data);for(var aE=e.length-1;aE>=0;aE--){e[aE].renderOutDoor(c.data)}}else{if(!this._onlyShowObj){H.render(c.data)}H.renderObj(c.data);aC.render(c.data,H);aF.disable(aF.DEPTH_TEST);H.renderPoi(c.data,H);aC.renderPoi(c.data,H);aF.enable(aF.DEPTH_TEST)}aF.disable(aF.DEPTH_TEST);aF.blendFuncSeparate(aF.ONE,aF.ONE_MINUS_SRC_ALPHA,aF.ONE,aF.ONE_MINUS_SRC_ALPHA);f.render();aF.blendFunc(aF.SRC_ALPHA,aF.ONE_MINUS_SRC_ALPHA);if(!ax){d.render(c.data)}for(var aE=0;aE<aa.length;aE++){aa[aE].render()}for(var aE=0;aE<this._plugins.length;aE++){this._plugins[aE].render()}X=false;aF.disable(aF.SCISSOR_TEST)};this._getClipPolygon=function(){return H._getPiexls()};this.zoomToExtent=function(aJ,aF){switch(aJ){case 1:var c=H.getAreaMinMax();ay.zoomBox(c.minx,c.miny,c.maxx,c.maxy);this.refresh();break;case 2:var aL=Number.MAX_VALUE;var aK=aL;var aI=Number.MIN_VALUE;var aH=aI;for(var aG=0;aG<aF.getData().length;aG++){var aE=aF.getData()[aG];aL=Math.min(aL,aE.x);aK=Math.min(aK,aE.y);aI=Math.max(aI,aE.x);aH=Math.max(aH,aE.y)}ay.zoomBox(aL,aK,aI,aH);this.refresh();break;default:break}};this.getCurFloorName=function(){return H.floorName};this.getCurFloorNum=function(){return H.floorNum};this.getCenter=function(){return new GHPoint2D(ay.center.getX(),ay.center.getY())};this.setCompassVisible=function(c){f.setCompassVisible(c)};this.getCompassVisible=function(){return f.getCompassVisible()};this.setLogoVisible=function(c){f.setLogoVisible(c)};this.getLogoVisible=function(){return f.getLogoVisible()};this._onCompassClick=function(c){return f._onCompassClick(c)};this.setCenter=function(aE){if(p){return}var c=new GH(aE.x-ay.center.getX(),aE.y-ay.center.getY(),0);ay.eyeAndCenterTranslate(c);if(this.is3D()){this.updatePoi()}this.refresh()};this.setCurFloorAndCenter=function(aJ,aI){if(p){return}var c=H.floorName;var aH=false;if(c!=aJ){aH=true}var aG=ay.center.getZ();H=al(aJ);var aF=H.height;var aE=new GH(0,0,aF-aG);ay.eyeAndCenterTranslate(aE);if(aH&&!ax){s(c,aJ);if(ak){ak(c,aJ)}}var aE=new GH(aI.x-ay.center.getX(),aI.y-ay.center.getY(),0);ay.eyeAndCenterTranslate(aE);if(this.is3D()){this.updatePoi()}this.refresh()};this.getCurFloorHeight=function(){return H.height};this.setOnMapClickListener=function(c){this.onMapClickListener=c};this.setOnMapDoubleClickListener=function(c){this.onMapDoubleClickListener=c};this.setOnMapMoveListener=function(c){this.onMapMoveListener=c};this.zoomIn=function(){if(p){return}ay.scaleAnimation(0.5,Gh.TYPE.ZOOM_IN)};this.zoomOut=function(){if(p){return}ay.scaleAnimation(2,Gh.TYPE.ZOOM_OUT)};this._panAnimation=function(c,aF){var aE=new Gh.Translate(this,aF);aE.setVec(c);aE.start()};this.setCurFloor=function(aH){var c=H.floorName;if(c==aH&&!ax){return}var aG=ay.center.getZ();H=al(aH);var aF=H.height;var aE=new GH(0,0,aF-aG);ay.eyeAndCenterTranslate(aE);if(!ax){s(c,aH);if(ak){ak(c,aH)}}this.refresh()};this.panTo=function(aF){var c=this.getCenter();var aE=new GH(aF.x-c.x,aF.y-c.y,0);this._panAnimation(aE,Gh.TYPE.PAN)};this.setRotate=function(aG,aF,aE){if(aF){if(i){i.stop()}else{i=new Gh.ROTATE(this)}var aG=this.getRotate()-aG;if(aG<=180){i.setValue(-aG)}else{i.setValue(-aG+360)}i.start()}else{if(p){return}var c=Gd.angleToRadians(aG);ay.setNorth(c);if(aE!=false){this.refresh()}}};this.getRotate=function(){var c=ay.getNorth();c=Gd.radiansToAngle(c);return c};this.setPitch=function(aF,aE){if(p){return}var c=Gd.angleToRadians(aF);if(!ay.setPitch(c)){return}H.updatePoi();if(aE==undefined||aE==true){this.refresh()}};this.getPitch=function(){var c=ay.getPitch();c=Gd.radiansToAngle(c);return c};this.translate=function(c,aF){if(p){return}var aE;if(ax){if(c==0){aE=new GH(c,0,aF)}else{aE=new GH(c,aF,0)}}else{aE=new GH(c,aF,0)}ay.eyeAndCenterTranslate(aE);this.refresh(true)};this.calPixelScale=function(c){return ay.calPixelScale(c)};this.px2gp=function(aH,aG,aE){if(aE==undefined){aE=GHConstants.FLOOR_HEIGHT*ap}if(aE<1){aE=1}var c=ay.screenToWorld(aH,aG,aE);var aF=new GHPoint2D(Gd.toFixed(c.getX()),Gd.toFixed(c.getY()));return aF};this.gp2px=function(aF,aE,c){if(c==undefined){c=GHConstants.FLOOR_HEIGHT*ap}return ay.worldToScreen(new GH(aF,aE,c))};this.set3DAll=function(c){if(ax==c){return}if(ax&&!c){this.setCurFloor(H.floorName)}ax=c;ay.makeMvp();o(ax);this.refresh()};this.is3DAll=function(){return ax};this._setHeightScale=function(aE,c){ap=aE;if(ap<0){ap=0}else{if(ap>1){ap=1}}if(c==undefined||c==true){this.refresh()}};this._getHeightScale=function(){return ap};this.getCamera=function(){return ay};this.loadObj=function(aJ,aI,aF,aE){if(!this._useObj){return}var aH={};if(aE!=undefined){var c=typeof(aE);if(c=="number"){aH.offsetZ=aE}else{if(c=="object"){aH=aE}}}if(aH.offsetZ==undefined){aH.offsetZ=this._objOffsetZ}if(aH.scale==undefined){aH.scale=ah}if(aH.useLight==undefined){aH.useLight=this._useLight}if(aH.useRtt==undefined){aH.useRtt=false}if(aH.useShadow==undefined){aH.useShadow=false}var aG=am+"3d_model/"+aF;L.load(aG,aI,aH,function(aL){var aK=al(aJ);aK.addObjData(aL)})};this._getFloorHeightByNum=function(aE,c){var aF=N(aE).height;if(c){aF+=c}return aF};this._getFloorHeightByName=function(aE,c){var aF=al(aE).height;if(c){aF+=c}return aF};this._getFloorNameByNum=function(c){var aE=N(c);return aE.floorName};this._getCenter=function(){return ay.center};this._getMaxHeight=function(){var c=e.length;return GHConstants.FLOOR_HEIGHT*c+(c-1)*GHConstants.FLOOR_GAP};function al(aF){var c;for(var aE=0;aE<e.length;aE++){if(aF==e[aE].floorName){c=e[aE];break}}return c}function N(aF){var c;for(var aE=0;aE<e.length;aE++){if(aF==e[aE].floorNum){c=e[aE];break}}return c}this._mapScaleListener=function(){H.updateDecLineDottedFlatten();this.updatePoi();aC.update()};this._mapMoveListener=function(){this.updatePoi();if(Gd.toFixed(ay.getPitch())>0){this._updateClusterFlatten()}};this._updateClusterFlatten=function(){H.updateClusterFlatten()};this._mapRotateListener=function(){f.update()};this._mapPitchListener=function(){};this.updatePoi=function(){if(ax){}else{H.updatePoi()}};this.setAreaColorByCode=function(aE){for(var c=0;c<aE.length;c++){aE[c].colorValue=Gd.getVector4FromColorStr(aE[c].color)}for(var c=0;c<e.length;c++){e[c].setAreaColorByCode(1,aE)}};this.setSpaceColorByCode=function(aE){for(var c=0;c<aE.length;c++){aE[c].colorValue=Gd.getVector4FromColorStr(aE[c].color)}for(var c=0;c<e.length;c++){e[c].setAreaColorByCode(2,aE)}};this.highlightSpace=function(c){for(var aE=0;aE<e.length;aE++){e[aE].highlightSpace(c)}};this.highlightArea=function(c){for(var aE=0;aE<e.length;aE++){e[aE].highlightArea(c)}};this.highlightOverlayPolygon=function(c){for(var aE=0;aE<e.length;aE++){e[aE].highlightOverlayPolygon(c)}};this.clearHighlight=function(){for(var c=0;c<e.length;c++){e[c].clearHighlight()}};this.setSelectSpaceColor=function(c){ag=c};this.getSelectSpaceColor=function(){return ag};this.setEnableTouchPitch=function(c){W=c};this.isEnableTouchPitch=function(){return W};this.setEnableTouchRotate=function(c){B=c};this.isEnableTouchRotate=function(){return B};this.setEnableTouchZoom=function(c){E=c};this.isEnableTouchZoom=function(){return E};var h=[];this.addMark=function(aG,aF){var aE=aF||H.floorName;var c=al(aE);aG._fname=aE;aG._setMap(this);c.addOverlayMark(aG);h.push(aG)};this.updateMark=function(aF,aE){var c=al(aF._fname);if(c){c._updateMark(aF,aE)}};this.updateMarkAngle=function(aF,aE){var c=al(aF._fname);if(c){c._updateMarkAngle(aF,aE)}};this.addMarks=function(aF,aH){var aG=aH||H.floorName;var aE=al(aG);for(var c=0;c<aF.length;c++){var aI=aF[c];aI._fname=aG;aI._setMap(this);aE.addOverlayMark(aI);h.push(aI)}};this.removeMark=function(aF){var aE=al(aF._fname);if(aE.removeOverlayMark(aF)){var c=h.indexOf(aF);h.splice(c,1);this.refresh()}};this.removeMarkByIndex=function(c){if(c<0||c>=h.length){return}var aE=h[c];this.removeMark(aE)};this.clearMarkByFloorName=function(aG){var aF=aG||H.floorName;var aE=al(aF);aE.clearOverlayMark();for(var c=h.length-1;c>=0;c--){if(h[c]._fname==aF){h.splice(c,1)}}this.refresh()};this.clearMark=function(){for(var c=0;c<e.length;c++){e[c].clearOverlayMark()}this.refresh();h.length=0};this.getAllMark=function(){return h};this.setClusters=function(aE,aG){var aF=aG||H.floorName;var c=al(aF);c.setClusters(aE);this.refresh()};this.setClusterAnimationColor=function(c){for(var aE=0;aE<e.length;aE++){e[aE].setClusterAnimationColor(c)}this.refresh()};this.setClusterHeight=function(c,aG){var aE=H;if(aG){var aF=al(aG);if(aF){aE=aF}}aE.setClusterHeight(c)};this.setClusterSleepTime=function(aE){for(var c=0;c<e.length;c++){e[c].setClusterSleepTime(aE)}};this.clearCluster=function(aE){for(var c=0;c<e.length;c++){e[c].clearCluster()}this.refresh()};this.setClusterFontScale=function(aE){for(var c=0;c<e.length;c++){e[c].setClusterFontScale(aE)}this.refresh()};this.setClusterRadius=function(c){for(var aE=0;aE<e.length;aE++){e[aE].setClusterRadius(c)}this.refresh()};this.setClusterFillColor=function(c){for(var aE=0;aE<e.length;aE++){e[aE].setClusterFillColor(c)}this.refresh()};this.setClusterFontColor=function(c){for(var aE=0;aE<e.length;aE++){e[aE].setClusterFontColor(c)}this.refresh()};this.addClusterLegendColor=function(aE){for(var c=0;c<e.length;c++){e[c].addClusterLegendColor(aE)}this.refresh()};this.addClusterGroup=function(aE){for(var c=0;c<e.length;c++){e[c].addClusterGroup(aE)}this.refresh()};this.setClusterTextMargin=function(aE){for(var c=0;c<e.length;c++){e[c].setClusterTextGap(aE)}this.refresh()};this.clearClusterGroup=function(){for(var c=0;c<e.length;c++){e[c].clearClusterGroup()}this.refresh()};this.clearClusterLegendColor=function(){for(var c=0;c<e.length;c++){e[c].clearClusterLegendColor()}this.refresh()};this.addPlugin=function(c){this._plugins.push(c);this.refresh()};this.clearPlugin=function(c){this._plugins.length=0;this.refresh()};var D=[];this.addPolygon=function(aE,aG){var aF=aG||H.floorName;var c=al(aF);aE._fname=aF;c.addOverlayPolygon(aE);D.push(aE);this.refresh()};this.removePolygon=function(aF){var aE=al(aF._fname);if(aE.removeOverlayPolygon(aF)){var c=D.indexOf(aF);D.splice(c,1);this.refresh()}};this.removePolygonByIndex=function(c){if(c<0||c>=D.length){return}var aE=D[c];this.removePolygon(aE)};this.clearPolygonByFloorName=function(aG){var aF=aG||H.floorName;var aE=al(aF);aE.clearOverlayPolygon();for(var c=D.length-1;c>=0;c--){if(D[c]._fname==aF){D.splice(c,1)}}this.refresh()};this.clearPolygon=function(){for(var c=0;c<e.length;c++){e[c].clearOverlayPolygon()}this.refresh();D.length=0};this.getAllPolygon=function(){return D};var aj=[];this.addLine=function(c,aG){var aF=aG||H.floorName;var aE=al(aF);c._fname=aF;aE.addOverlayLine(c);aj.push(c);this.refresh()};this.removeLine=function(c){var aF=al(c._fname);if(aF.removeOverlayLine(c)){var aE=aj.indexOf(c);aj.splice(aE,1);this.refresh()}};this.removeLineByIndex=function(c){if(c<0||c>=aj.length){return}var aE=aj[c];this.removeLine(aE)};this.clearLineByFloorName=function(aG){var aF=aG||H.floorName;var aE=al(aF);aE.clearOverlayLine();for(var c=aj.length-1;c>=0;c--){if(aj[c]._fname==aF){aj.splice(c,1)}}this.refresh()};this.clearLine=function(){for(var c=0;c<e.length;c++){e[c].clearOverlayLine()}this.refresh();aj.length=0};this.getAllLine=function(){return aj};this.clearAll=function(){this.clearMark();this.clearPolygon();this.clearLine()};this.setStartPoint=function(c,aE){if(!aE){aE=H.floorName}aC.setStartPoint(c,aE,true);J.setStartFloor(aE)};this.setEndPoint=function(c,aE){if(!aE){aE=H.floorName}aC.setEndPoint(c,aE,true);J.setEndFloor(aE)};this.routing=function(c,aI,aJ,aF,aG,aL){if(!aJ){aJ=H.floorName}aC.setStartPoint(c,aJ,false);if(!aF){aF=H.floorName}aC.setEndPoint(aI,aF,true);var aM=al(aJ).floorNum;var aH=al(aF).floorNum;var aE={x1:c.x+"",y1:c.y+"",floor1:aM+"",x2:aI.x+"",y2:aI.y+"",floor2:aH+""};aE.buildNum=b;if(aG){for(var aK in aG){aE[aK]=aG[aK]}}aC.compuRoute(w,C,aE,aL)};this.clearRoute=function(){aC.clear();J.clearStartEndFloor()};this.setCodeLogo=function(aG,aE,aH){var c=aH==undefined?this._logoAngle:aH;for(var aF=0;aF<e.length;aF++){if(e[aF].setCodeLogo(aG,aE,c)){return true}}return false};this.getStyleByTypeAndCode=function(c,aE){return av.getStyleByTypeAndCode(c,aE)};this.getStyleMaxHeightScale=function(){return av.getMaxScale()};this.release=function(){for(var c=0;c<e.length;c++){if(e[c]){e[c].release()}e[c]=undefined}f.release();aC.release();d.release();this._imageTextureLoader.release();for(var c=0;c<this._plugins.length;c++){this._plugins[c].release()}this.clearPlugin()};var q=new Gh.Location(this);var i;this.updateLocationPointAndFloor=function(aE,c){if(!c){c=H.floorName}q.setLocLayer(d);q.stop();q.setValue(aE,c);q.start()};this.updateAngle=function(aE,c){d.updateAngle(Gd.angleToRadians(aE))};this.hideLocation=function(){q.stop();q.clear();d.hide()};this.getMaxZoom=function(){return af};this.setZoom=function(c){ay.setZoom(c);this.updatePoi();aC.update();this.refresh()};this.getZoom=function(){return ay.getZoom()};this.switch2D=function(){if(p){return}if(aB){au(-r,-1)}else{ap=0;ay.setPitch(0);this.refresh()}};this.is3D=function(){return ap>=0.1};this.switch3D=function(){if(p){return}if(aB){au(r,1)}else{ap=1;ay.setPitch(Gd.angleToRadians(r));this.refresh()}};function au(aE,aF){var c=new Gh.Switch(v);c.setValue(aE,aF);c.start()}this.searchByCode=function(aG){var c=[];for(var aE=0;aE<e.length;aE++){var aF=e[aE].searchSpaceByCode(aG);if(aF){delete aF.height;delete aF.radius;aF.gh_type=GHType.SPACE;c.push(aF);break}}for(var aE=0;aE<e.length;aE++){var aF=e[aE].searchPoiByCode(aG);if(aF){aF.gh_type=GHType.POI;c.push(aF);break}}return c};this.searchSpaceInFloor=function(aG,aF,c){var aE=al(aG);if(aE){return g(aE,aF,c)}return[]};this.searchSpaceInCurFloor=function(aE,c){return g(H,aE,c)};this.searchSpaceInBuilding=function(aH,aF){var c=[];for(var aG=0;aG<e.length;aG++){var aI=g(e[aG],aH,aF);for(var aE=0;aE<aI.length;aE++){c.push(aI[aE])}}return c};this.searchSpaceByCode=function(aE){for(var c=0;c<e.length;c++){var aF=e[c].searchSpaceByCode(aE);if(aF){return aF}}};this.searchAreaFaceInFloor=function(aG,aF,c){var aE=al(aG);if(aE){return g(aE,aF,c,true)}return[]};this.searchAreaFaceInCurFloor=function(aE,c){return g(H,aE,c,true)};this.searchAreaFaceInBuilding=function(aH,aF){var c=[];for(var aG=0;aG<e.length;aG++){var aI=g(e[aG],aH,aF,true);for(var aE=0;aE<aI.length;aE++){c.push(aI[aE])}}return c};this.searchPoiInFloor=function(aG,aF,c){var aE=al(aG);if(aE){return x(aE,aF,c)}return[]};this.searchPoiInCurFloor=function(aE,c){return x(H,aE,c)};this.searchPoiInBuilding=function(aH,aF){var c=[];for(var aG=0;aG<e.length;aG++){var aI=x(e[aG],aH,aF);for(var aE=0;aE<aI.length;aE++){c.push(aI[aE])}}return c};this.getFloors=function(){var c=[];for(var aG=0;aG<e.length;aG++){var aF=e[aG];var aE={};aE.name=aF.floorName;aE.num=aF.floorNum;c.push(aE)}return c};this.mer2gp=function(aG,aF){var c=aG*ac-F.minx;var aH=aF*ac-F.miny;var aE=new GHPoint2D(Gd.toFixed(c),Gd.toFixed(aH));return aE};this.gp2mer=function(aF){var c=(aF.x+F.minx)/ac;var aG=(aF.y+F.miny)/ac;var aE=new GHPoint2D(c,aG);return aE};this._b=function(){return{minx:0,miny:0,maxx:this._dataWidth,maxy:this._dataHeight}};this.lonlat2mer=function(aH,aF){var aE=2*Math.PI*6378137/2;var aG=aH*aE/180;var c=Math.log(Math.tan((90+aF)*Math.PI/360))/(Math.PI/180);c=c*aE/180;return new GHPoint2D(aG,c)};this.mer2lonlat=function(aH,aF){var aE=2*Math.PI*6378137/2;var aG=(aH/aE)*180;var c=(aF/aE)*180;c=180/Math.PI*(2*Math.atan(Math.exp(c*Math.PI/180))-Math.PI/2);return new GHPoint2D(aG,c)};this.lonlat2gp=function(aF,aE){var c=this.lonlat2mer(aF,aE);return this.mer2gp(c.x,c.y)};this.gp2lonlat=function(aE){var c=this.gp2mer(aE);return this.mer2lonlat(c.x,c.y)};this.pickObjPoint=function(c){var aE=H._getWorldCoord(c.x,c.y);if(aE){return{x:aE.getX(),y:aE.getY(),z:aE.getZ()}}return undefined};this.meters2gp=function(aE,c){return new GHPoint2D(aE*ac,c*ac)};this.gp2meters=function(c){return new GHPoint2D(c.x/ac,c.y/ac)};this.setMaxPitch=function(c){r=c};this.getMaxPitch=function(c){return r};this.setBackGoundColor=function(c){at.color=c;var aE=Gd.getVector4FromColorStr(c);at.rgba=aE;this.refresh()};this.upFloor=function(){var c=e.length;if(H.index==0){return}this.setCurFloor(e[H.index-1].floorName)};this.downFloor=function(){var c=e.length;if(H.index==c-1){return}this.setCurFloor(e[H.index+1].floorName)};this._isFade=function(){return an};this.addUnLoadListener=function(c){P.push(c)};this.invokeUnLoadListener=function(){for(var aE=0;aE<P.length;aE++){var c=P[aE]();if(c){return true}}return false};this.setOnMapOverlayClickListener=function(c){aA=c};this.selectByPoint=function(aF){var c=[];var aE=this.selectSpace(aF);if(aE){aE.gh_type=GHType.SPACE;c.push(aE)}var aG=this.selectPoi(aF);if(aG){aG.gh_type=GHType.POI;c.push(aG)}return c};this.selectSpace=function(aG,aH){var c=this.gp2px(aG.x,aG.y,GHConstants.FLOOR_HEIGHT*ap);var aE=H;if(aH){var aF=al(aH);if(aF){aE=aF}}return aE._selectSpace(c.x,c.y,true)};this.selectPoi=function(aE){var c=this.gp2px(aE.x,aE.y,GHConstants.FLOOR_HEIGHT*ap);return H._selectPoi(c.x,c.y,true)};this.selectMarker=function(aE){var c=this.gp2px(aE.x,aE.y,GHConstants.FLOOR_HEIGHT*ap);return H._codeSelectMarker(c.x,c.y)};this.selectDecArea=function(aE){var c=this.gp2px(aE.x,aE.y,GHConstants.FLOOR_HEIGHT*ap);return H._selectDecArea(c.x,c.y,true)};this.transformPoint=function(aF,c,aG){if(!c){c=5}c*=10;if(!aG){aG=H.floorName}var aE=aC.getResult();if(aE.length>0){return Gd.transformPoint(aF,aE,c,aG)}return aF};this.setOnFloorChangeListener=function(c){ak=c};this.setOnMapZoomListener=function(c){U=c};this.setOnMapSwitchListener=function(c){ar=c};this.showCode=function(c){for(var aE=0;aE<e.length;aE++){e[aE].showCode(c)}this.refresh()};this.searchBoot=function(c,aF){if(!c){c={}}c.buildNum=b;var aE=this;w.searchBoot(C,c,function(aG){if(aG.body.data){aE.showCode(aG.body.data)}})};this._clickSelect=function(aF,aK){var aJ=false;this._clearSelect();if(aA){if(aA.onClickMark){var aH=H._selectMarker(aF,aK);if(aH){aA.onClickMark(aH);aJ=true}}if(aA.onClickPolygon){var aI=H._selectPolygon(aF,aK);if(aI){aA.onClickPolygon(aI);aJ=true}}if(aA.onClickLine){var aG=H._selectLine(aF,aK);if(aG){aA.onClickLine(aG);aJ=true}}if(aA.onClickCluster){var aE=H._selectCluster(aF,aK);if(aE){aA.onClickCluster(aE);aJ=true}}}H._clickSelect(aF,aK);var c=aC._clickSelect(aF,aK);if(c){aJ=true}this.refresh();return aJ};this._clearSelect=function(){for(var c=0;c<e.length;c++){if(e[c]._clearSelect()){break}}};this._onAnimationStart=function(c){p=true;if(c==Gh.TYPE.ZOOM_IN||c==Gh.TYPE.ZOOM_OUT){if(U&&U.onZoomStart){U.onZoomStart()}}else{if(c==Gh.TYPE.SWITCH){if(ar&&ar.onSwitchStart){ar.onSwitchStart()}}}};this._onAnimationing=function(c){if(c==Gh.TYPE.ZOOM_IN||c==Gh.TYPE.ZOOM_OUT){this._onMapMove();if(U&&U.onZooming){U.onZooming()}}else{if(c==Gh.TYPE.SWITCH){if(ar&&ar.onSwitching){ar.onSwitching()}this._onMapMove()}else{if(c==Gh.PAN){H.updateClusterPosition()}}}};this._onAnimationEnd=function(c){p=false;if(c==Gh.TYPE.ZOOM_IN||c==Gh.TYPE.ZOOM_OUT){this._updateClusterFlatten();if(U&&U.onZoomEnd){U.onZoomEnd()}}else{if(c==Gh.TYPE.SWITCH){this._updateClusterFlatten();if(ar&&ar.onSwitchEnd){ar.onSwitchEnd()}}}};this._onMapMove=function(){H.updateClusterPosition()};this.getBuildNum=function(){return b};this.isShowChinese=function(){return O};this.getImageScale=function(){return ae};this.isPubPoiVisible=function(){return u};this.setPubPoiVisible=function(c){u=c;this.refresh()};this._e=function(){return ay.eye};this.setShowChinese=function(c){if(c==O){return}O=c;t();this.updatePoi();this.refresh()};this._md=function(){return az};this.resize=function(aE,c){Q.width=aE;Q.height=c;Q.style.width=Q.width+"px";Q.style.height=Q.height+"px";if(window.screen.width){v.fontScale=Q.width/window.screen.width;v._fontScale2=1/v.fontScale/v.fontScale}if(az){Q.width*=window.devicePixelRatio;Q.height*=window.devicePixelRatio}ay.resize(Q.width,Q.height);f.updateAll();this.refresh()};function t(){for(var c=0;c<e.length;c++){e[c].updateLanguage()}}function s(aE,c){aC.updateUpDown();J.setFloor(c);H.updateClusterFlatten()}function g(aF,aG,aE,c){return aF.searchSpace(aG,aE,c)}function x(aE,aF,c){return aE.searchPoi(aF,c)}function o(c){if(!c){H.updateDecLineDottedFlatten();v.updatePoi();aC.update()}}this.setHeatMapPointCount=function(c){_heatmapPointCount=c};this.getHeatMapPointCount=function(){return _heatmapPointCount};var aa=[];this.getControl=function(c){if(c>=0&&c<aa.length){return aa[c]}};this.addControl=function(c){aa.push(c);this.refresh()};this.removeControl=function(aE){var c=aa.indexOf(aE);aa.splice(c,1);this.refresh()};this.clearControl=function(){aa.length=0;this.refresh()};this.enableControl=function(aG){var aF=typeof aG;var c=-1;this.disableControl();switch(aF){case"object":c=aa.indexOf(aG);break;case"string":for(var aE=0;aE<aa.length;aE++){if(aa[aE].name==aG){c=aE;break}}break;case"number":c=aG;break}if(c>=0){aa[c].enable=true}};this.disableControl=function(){for(var c=0;c<aa.length;c++){aa[c].cancel();aa[c].enable=false}};this.getObjScale=function(){return ah};this.addLight=function(c){c._map=this;this._lights.push(c);this._updateLight()};this.getLight=function(c){return this._lights[c]};this.getLightCount=function(){return this._lights.length};this.clearLight=function(){this._lights.length=0;this._updateLight()};this._updateLight=function(){this._renderLight={};var aE={color:[],keep:[],direction:[],shadow:[],matrix:[],count:0};var aL={color:[],keep:[],position:[],distance:[],shadow:[],matrix:[],count:0};for(var aI=0;aI<this._lights.length;aI++){var aH=this._lights[aI];var aG=aH._colorVec;var c=aH.isKeep();if(aH instanceof GHDirectionalLight){aE.count++;var aK=aH.getDirection();aE.color.push(aG.getX());aE.color.push(aG.getY());aE.color.push(aG.getY());aE.keep.push(c);aE.direction.push(aK.x);aE.direction.push(aK.y);aE.direction.push(aK.z);aE.shadow.push(aH.isUseShadow());var aF=aH.getMvpMatrix();aF.data.forEach(function(aM){aE.matrix.push(aM)})}else{if(aH instanceof GHPointLight){aL.count++;var aJ=aH.getPosition();aL.color.push(aG.getX());aL.color.push(aG.getY());aL.color.push(aG.getY());aL.keep.push(c);aL.position.push(aJ.x);aL.position.push(aJ.y);aL.position.push(aJ.z);aL.shadow.push(aH.isUseShadow());var aF=aH.getMvpMatrix();aF.data.forEach(function(aM){aL.matrix.push(aM)});aL.distance.push(aH.getDistance())}}}if(aE.count>0){this._renderLight.dir={count:aE.count,color:new Float32Array(aE.color),direction:new Float32Array(aE.direction),shadow:aE.shadow,matrix:new Float32Array(aE.matrix),keep:aE.keep}}if(aL.count>0){this._renderLight.point={count:aL.count,color:new Float32Array(aL.color),position:new Float32Array(aL.position),keep:aL.keep,shadow:aL.shadow,matrix:new Float32Array(aL.matrix),distance:aL.distance}}};this._getRenderLight=function(){return this._renderLight};this.getEnableControl=function(){var aF;for(var aE=0;aE<aa.length;aE++){if(aa[aE].enable==true){aF=aa[aE];break}}return aF};ad()};(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());var GHLight=GHLight||function(b,a,c,d){b=b||"#FFFFFF";this.setColor(b);this._keep=a==undefined?true:false;this._name=c;this._useShadow=d==undefined?false:d;this._mvpMatrix=new GK()};GHLight.prototype={setColor:function(a){this._color=a;this._colorVec=Gd.getVector4FromColorStr(a)},getColor:function(){return this._color},setkeep:function(a){this,_keep=a},isKeep:function(){return this._keep},setName:function(a){this._name=a},getName:function(){return this._name},setUseShadow:function(a){this._useShadow=a},isUseShadow:function(){return this._useShadow}};var GHDirectionalLight=GHDirectionalLight||function(a){a=a||{};GHLight.call(this,a.color,a.keep,a.name,a.useShadow);this._direction=a.direction||{x:0,y:-0.5,z:0.5}};GHDirectionalLight.prototype={setDirection:function(a){this._direction=a},getDirection:function(){return this._direction},getMvpMatrix:function(){return this._mvpMatrix}};Gd.copyTo(GHLight.prototype,GHDirectionalLight.prototype);var GHPointLight=GHPointLight||function(a){a=a||{};GHLight.call(this,a.color,a.keep,a.name,a.useShadow);this._position=a.position||{x:0,y:0,z:0};this._distance=a.distance||100};GHPointLight.prototype={setPosition:function(a){this._position=a},getPosition:function(){return this._position},setDistance:function(a){this._distance=a},getDistance:function(){return this._distance},getMvpMatrix:function(){this._mvpMatrix.identity();if(this.isUseShadow()){var e=this._map.getCamera();var f=new GK();f.perspective(45,e.aspect,e.znear,e.zfar);var c=new GH(this._position.x,this._position.y,this._position.z);var b=e.center;var a=new GH(0,1,0);var d=new GK();d.lookAt(c,b,a);this._mvpMatrix=f.mult(d)}return this._mvpMatrix}};Gd.copyTo(GHLight.prototype,GHPointLight.prototype);var GHNaviMode={NORMAL:1,ROAD:2};var GHNaviDirection={STRAIGHT:1,RIGHT_FRONT:2,RIGHT:3,LEFT_FRONT:4,LEFT:5,TURN:6,UPSTAIRS:7,DOWNSTAIRS:8,DESTINATION:9};var GHNaviResultCode={NO_START_INFO:1,NO_END_INFO:2,AUTO_ROUTING_START:3,AUTO_ROUTING_COMPLETE:4,AUTO_ROUTING_ERROR:5,ROUTING_START:6,ROUTING_COMPLETE:7,ROUTING_ERROR:8,NAVI_START:9,NAVI_END:10,NAVI_STOP:11,NAVI_RESUME:12,NAVI_TRACKING:13};var GHNaviLinkType={STRAIGHT_LADDER:1,HAND_LADDER:2,WALKING_LADDER:3};var GCN=GCN||function(a){this.map=a;this.autoRoute;this.naviMode;this.threshold;this.maxOffCount;this.startInfo;this.endInfo;this.routeResult;this.bookResult;this.routeItems;this.listener;this.locOffsetCount=0;this.runing=false;this._locOffTrackPoint=new Array();this._endThreshold=0.3;this._lastResult;this._backThrehold=2;this.lineAngle;this.removeLastLineCount;this.setOption();this.frontAngle=45;this._linkValue={"101301":"直梯","101302":"步行梯","101307":"扶梯"};this._ladderType={"101301":GHNaviLinkType.STRAIGHT_LADDER,"101302":GHNaviLinkType.WALKING_LADDER,"101307":GHNaviLinkType.HAND_LADDER}};GCN.prototype={_notify:function(a,b){if(this.listener){this.listener({code:a,data:b})}},setFrontAngle:function(a){this.frontAngle=a},getFrontAngle:function(){return this.frontAngle},setEndThreshold:function(a){this._endThreshold=a},getEndThreshold:function(){return this._endThreshold},setBackThrehold:function(a){this._backThrehold=a},getBackThrehold:function(){return this._backThrehold},setRouteResult:function(a){this.routeResult=a;this.bookResult=this._dataToRouteBook(a)},setOption:function(a){a=a||{};this.autoRoute=Gd.getJsonValue(a,"autoRoute",true);this.naviMode=Gd.getJsonValue(a,"naviMode",GHNaviMode.ROAD);this.threshold=Gd.getJsonValue(a,"threshold",5);this.maxOffCount=Gd.getJsonValue(a,"maxOffCount",5);this.lineAngle=Gd.getJsonValue(a,"lineAngle",10);this.removeLastLineCount=Gd.getJsonValue(a,"removeLastLineCount",1)},setLineAngle:function(a){this.lineAngle=a},getLineAngle:function(){return this.lineAngle},setRemoveLastLineCount:function(a){this.removeLastLineCount=a},getRemoveLastLineCount:function(){return this.setRemoveLastLineCount},setAutoRoad:function(a){this.autoRoute=a},getAutoRoad:function(){return this.autoRoute},setNaviMode:function(a){this.naviMode=a},getNaviMode:function(){return this.naviMode},setThreshold:function(a){this.threshold=a},getThreshold:function(){return this.threshold},setMaxOffCount:function(a){this.maxOffCount=a},getMaxOffCount:function(){return this.maxOffCount},setStartInfo:function(a){this.startInfo=a},setEndInfo:function(a){this.endInfo=a},start:function(){if(this.runing){return}if(!this.startInfo){this._notify(GHNaviResultCode.NO_START_INFO);return}if(!this.endInfo){this._notify(GHNaviResultCode.NO_END_INFO);return}this._notify(GHNaviResultCode.NAVI_START);this.runing=true;if(!this.routeResult){this.startRoute()}else{this._notify(GHNaviResultCode.ROUTING_COMPLETE,this.bookResult)}},stop:function(){if(this.runing){this._notify(GHNaviResultCode.NAVI_STOP,this.bookResult);this.runing=false}},resume:function(){if(!this.runing){this._notify(GHNaviResultCode.NAVI_RESUME,this.bookResult);this.runing=true}},end:function(){this._lastResult=undefined;if(this.runing){this._notify(GHNaviResultCode.NAVI_END);this.runing=false}},startRoute:function(a){this._lastResult=undefined;(function(b,c){if(c===true){b._notify(GHNaviResultCode.AUTO_ROUTING_START)}else{b._notify(GHNaviResultCode.ROUTING_START)}b.map.routing(b.startInfo,b.endInfo,b.startInfo.fname,b.endInfo.fname,{},function(d){b.onRoutingCallback(d,c)})})(this,a)},onRoutingCallback:function(b,c){var a=this._processData(b);this.routeResult=a;this.bookResult=this._dataToRouteBook(a);if(c===true){this._notify(GHNaviResultCode.AUTO_ROUTING_COMPLETE,this.bookResult)}else{this._notify(GHNaviResultCode.ROUTING_COMPLETE,this.bookResult)}},_processData:function(c){var a=[];for(var b=0;b<c.length;b++){var e=c[b];var d=false;if(a.length<2){d=true}else{var g=a[a.length-2];var f=a[a.length-1];if(e.fname==g.fname&&g.fname==f.fname){if(this.inline(g,f,e)){a.splice(a.length-1);d=true}else{d=true}}else{d=true}}if(d){a.push(e)}}return a},inline:function(g,f,e){var d=f.x-g.x;var c=f.y-g.y;var b=Gd.radiansToAngle(Math.atan2(c,d));d=e.x-f.x;c=e.y-f.y;var a=Gd.radiansToAngle(Math.atan2(c,d));return Math.abs(a-b)<this.lineAngle},_dataToRouteTemp:function(e){var k=new Array();for(var f=0;f<e.length-1;f++){var a=e[f];var d=e[f+1];var c=Gd.getRotate(a.x,a.y,d.x,d.y);while(c<0){c+=360}var j=0;if(a.fnum==d.fnum){j=Gd.getDistance(a.x,a.y,d.x,d.y)/this.map._getDataScale()}k.push({start:a,end:d,length:j,angle:c})}var m=0;var g=false;for(var f=0;f<k.length;f++){var n=k[f];var c=n.angle;if(f==0||g){n.direction=this._calDirection(c);g=false}else{if(n.start.fnum==n.end.fnum){var l=m+180-c;while(l>360){l-=360}while(l<0){l+=360}var h=l-180;if(h>0){if(h<=this.frontAngle){n.direction=15}else{n.direction=12}}else{if(Math.abs(h)<=this.frontAngle){n.direction=16}else{n.direction=11}}}else{if(n.start.fnum>n.end.fnum){n.direction=14;g=true;var b=this._getPoiInfo(n.start);if(b){n.linkType=b.type}}else{g=true;n.direction=13;var b=this._getPoiInfo(n.start);if(b){n.linkType=b.type}}}}m=c}return k},_getPoiInfo:function(f){var a;var e=map.searchPoiInFloor(f.fname);for(var b=0;b<e.length;b++){var g=e[b];var c=g.type;var d=this._linkValue[c];if(d&&Gd.getDistance(f.x,f.y,g.x,g.y)<=this.map._getDataScale()*0.1){a=g}}return a},_dataToRouteBook:function(d){var f=0;this.routeItems=this._dataToRouteTemp(d);var g=this.routeItems.length-this.removeLastLineCount;var h=[];for(var e=0;e<g-1;e++){var l={};var k=this.routeItems[e];var c=this.routeItems[e+1];var j=this._getDirection(c.direction);l.length=Gd.toFixed(k.length,1);if(k.start.fnum==k.end.fnum){var b=k.length;f+=b;if(k.direction<=8){l.desc="沿"+this._getDirection(k.direction)+"方向直行"+Gd.toFixed(b,1)+"米后"+j}else{l.desc="直行"+Gd.toFixed(b,1)+"米后"+j}}else{if(k.linkType){if(k.linkType=="101302"){l.desc="在"+k.start.fname+"层"+this._getDirection(k.direction)+"步行到"+k.end.fname+"层"}else{l.desc="在"+k.start.fname+"层乘坐"+this._linkValue[k.linkType]+this._getDirection(k.direction)+"到"+k.end.fname+"层"}}else{l.desc="从"+k.start.fname+"层"+this._getDirection(k.direction)+"到"+k.end.fname+"层"}}h.push(l)}if(g>0){var a=this.routeItems[g-1];var l={};l.desc="直行"+ +Gd.toFixed(a.length,1)+"米后到达目的地";if(this.endInfo.name){l.desc+=this.endInfo.name}l.length=Gd.toFixed(a.length,1);f+=a.length;h.push(l)}return{desc:"全程"+parseInt(f)+"米",length:f,start:{x:this.startInfo.x,y:this.startInfo.y,floorName:this.startInfo.fname},end:{x:this.endInfo.x,y:this.endInfo.y,floorName:this.endInfo.fname},data:h}},_getDirection:function(a){if(a==1){return"正北"}else{if(a==2){return"东北"}else{if(a==3){return"正东"}else{if(a==4){return"东南"}else{if(a==5){return"正南"}else{if(a==6){return"西南"}else{if(a==7){return"正西"}else{if(a==8){return"西北"}else{if(a==11){return"左转"}else{if(a==12){return"右转"}else{if(a==13){return"向上"}else{if(a==14){return"向下"}else{if(a==15){return"右前方直行"}else{if(a==16){return"左前方直行"}}}}}}}}}}}}}}return""},_calDirection:function(a){if(a>=360-22.5&&a<22.5){return 1}else{if(a>=22.5&&a<22.5*3){return 2}else{if(a>=22.5*3&&a<22.5*5){return 3}else{if(a>=22.5*5&&a<22.5*7){return 4}else{if(a>=22.5*7&&a<22.5*9){return 5}else{if(a>=22.5*9&&a<22.5*11){return 6}else{if(a>=22.5*11&&a<22.5*13){return 7}else{if(a>=22.5*13&&a<22.5*15){return 8}}}}}}}}return 1},track:function(m){if(this.runing==false||!this.routeItems||!this.listener){return}var q;var h=this.routeItems.length-this.removeLastLineCount;for(var e=0;e<h;e++){var p=this.routeItems[e];if(p.start.fnum==p.end.fnum&&p.start.fname==m.floorName){var b=Gd.pointDisToSegment(m.x,m.y,p.start.x,p.start.y,p.end.x,p.end.y);b.index=e;if(!q){q=b}else{if(q.distance>b.distance){q=b}}}}if(!q){return}var f=0;for(var e=0;e<q.index;e++){var p=this.routeItems[e];f+=p.length}q.distance/=this.map._getDataScale();if(q.distance<=this.threshold){this.locOffsetCount=0}else{if(this.autoRoute===true){this.locOffsetCount++;if(this.locOffsetCount==this.maxOffCount){this.locOffsetCount=0;this._locOffTrackPoint.length=0;this.startInfo.x=m.x;this.startInfo.y=m.y;this.startInfo.fname=m.floorName;this.startRoute(true)}}}var b={desc:""};b.x=q.x;b.y=q.y;b.floorName=m.floorName;var g=q.index;var o=this.routeItems[g];var d=o.end;var c=Gd.getDistance(b.x,b.y,d.x,d.y)/this.map._getDataScale();b.length=Gd.toFixed(c,1);c=this.bookResult.length-f-Gd.getDistance(b.x,b.y,o.start.x,o.start.y)/this.map._getDataScale();if(c>10){b.remainDistance=Gd.toFixed(c,0)}else{b.remainDistance=Gd.toFixed(c,1)}b.offsetDistance=q.distance;var n=false;b.nextLinkType=q.linkType;if(g==h-1){var l="";if(b.length>this._endThreshold){l="剩余"+b.length+"米"}else{n=true}b.desc="到达目的地";if(this.endInfo&&this.endInfo.name){b.desc+=this.endInfo.name}b.desc+="附近";b.nextDirection=GHNaviDirection.DESTINATION}else{var a=this.routeItems[g+1];if(a.direction<=8){b.desc="沿"+this._getDirection(o.direction)+"方向直行"+b.length+"米后"+this._getDirection(a.direction)}else{if(b.length<=1){if(a.direction!=13&&a.direction!=14){b.desc=this._getDirection(a.direction)}}else{b.desc="直行"+b.length+"米后"+this._getDirection(a.direction)}if(a.direction==13||a.direction==14){if(a.linkType){if(a.linkType=="101302"){b.desc+="步行到"+a.end.fname+"层"}else{b.desc+="乘坐"+this._linkValue[a.linkType]+"到"+a.end.fname+"层"}b.nextLinkType=this._ladderType[a.linkType];b.nextFloorName=a.end.fname}else{b.desc+="到"+a.end.fname}}}var k=a.direction;if(k==11){b.nextDirection=GHNaviDirection.LEFT}else{if(k==12){b.nextDirection=GHNaviDirection.RIGHT}else{if(k==13){b.nextDirection=GHNaviDirection.UPSTAIRS}else{if(k==14){b.nextDirection=GHNaviDirection.DOWNSTAIRS}else{if(k==15){b.nextDirection=GHNaviDirection.RIGHT_FRONT}else{if(k==16){b.nextDirection=GHNaviDirection.LEFT_FRONT}}}}}}}b.angle=o.angle-90;var j=this.setLastResult(g,b);if(j){if(this.naviMode==GHNaviMode.ROAD){this.map.setRotate(b.angle,true,false)}this._notify(GHNaviResultCode.NAVI_TRACKING,b);if(b.remainDistance<=this._endThreshold){this.end()}}},setLastResult:function(b,a){var c=this._backThrehold;var d=false;if(this._lastResult){if(b==this._lastResult.index){if(a.length<=this._lastResult.length){d=true}else{if(this._lastResult.backCount<c){this._lastResult.backCount++}else{d=true}}}else{if(b<this._lastResult.index){if(this._lastResult.backCount<c){this._lastResult.backCount++}else{d=true}}else{d=true}}}else{d=true;this._lastResult={}}if(d){this._lastResult.fname=a.floorName;this._lastResult.y=a.y;this._lastResult.x=a.x;this._lastResult.index=b;this._lastResult.backCount=0;this._lastResult.length=a.length}return d},setNaviListener:function(a){this.listener=a}};var GHM=GHM||function(t){this.map=t;var s=new Gf(t.gl);var o=new Gf(t.gl);var n,v,m,h,u,d;var c,b,p,e,q,g,a;var f="#ifdef GL_FRAGMENT_PRECISION_HIGH                    \nprecision highp float;							      \n#else												  \nprecision mediump float;							  \n#endif												  \n";var l="attribute vec2 aVertexPosition; \nattribute highp vec2 aTextureCoord; \nuniform mat4 mvpMatrix; 			\nuniform float height; 			\nvarying highp vec2 vTextureCoord; \nvoid main(void) {				\n	vec4 pTran = vec4(aVertexPosition,0.0,1.0);	\n	gl_Position	= pTran;		\n	vTextureCoord = aTextureCoord; \n}		\n";var k=f+" varying highp vec2 vTextureCoord;		\n uniform sampler2D uSampler; \n uniform sampler2D uSampler2; \n void main(void) {		\n	vec4 color = texture2D(uSampler2, vTextureCoord); \n	float alpha = color.a;	\n	if(alpha == 0.0) discard;  \n	gl_FragColor = texture2D(uSampler,vec2(alpha,0.5));		\n	alpha /= 0.7;\n	if(alpha > 0.7)	alpha = 0.7;\n   gl_FragColor.a = alpha ; \n}	\n";var j=f+"attribute vec3 aVertexPosition; \nuniform vec2  uCenterPosition; \nuniform float uMinValue;			\nuniform float uMaxValue;			\nuniform float uValue;			\nuniform mat4 mvpMatrix; 			\nuniform float height; 			\nvarying float vAlpha;				\nvarying float vValue;				\nvarying float vMinValue;			\nvarying float vMaxValue;			\nvarying vec4 vColor;				\nvoid main(void){					\n	vValue = uValue;				\n	vec4 pTan = vec4(aVertexPosition.x+uCenterPosition.x,aVertexPosition.y+uCenterPosition.y,height,1.0); \n  vMinValue = uMinValue;	\n  vMaxValue = uMaxValue;	\n  vAlpha = aVertexPosition.z;				\n	gl_Position = mvpMatrix * pTan;	\n}									\n";var i=f+"varying float vAlpha;				\nvarying float vValue;				\nvarying float vMinValue;			\nvarying float vMaxValue;			\nvoid main(void){					\nif(vAlpha == 0.0) discard;		\n  vec4 color = vec4(1.0,0.0,0.0,0.0);		\n	 float alpha = (vValue - vMinValue) / (vMaxValue -vMinValue );	\n  color.a = vAlpha * alpha ;					\n  gl_FragColor = color;						\n} 							\n";r();function r(){s.createProgram(l,k);if(s.isValid()){s.useProgram();n=s.getAttribLocation("aVertexPosition");v=s.getAttribLocation("aTextureCoord");m=s.getUniformLocation("uSampler");h=s.getUniformLocation("uSampler2");_mvpMatrixLoc=s.getUniformLocation("mvpMatrix");d=s.getUniformLocation("height")}o.createProgram(j,i);if(o.isValid()){o.useProgram();c=o.getAttribLocation("aVertexPosition");p=o.getUniformLocation("uMinValue");e=o.getUniformLocation("uMaxValue");q=o.getUniformLocation("uValue");b=o.getUniformLocation("uCenterPosition");g=o.getUniformLocation("mvpMatrix");a=o.getUniformLocation("height")}}this.render=function(A){var y=this.drawFrame(A);if(!s.isValid()){return}s.useProgram();var B=this.map.gl;B.disable(B.DEPTH_TEST);B.clearDepth(1);B.enable(B.BLEND);B.blendEquation(B.FUNC_ADD);B.blendFunc(B.SRC_ALPHA,B.ONE_MINUS_SRC_ALPHA);var x=B.createBuffer();var w=B.createBuffer();var D=[-1,-1,-1,1,1,-1,1,1];B.enableVertexAttribArray(n);B.enableVertexAttribArray(v);B.bindBuffer(B.ARRAY_BUFFER,x);B.bufferData(B.ARRAY_BUFFER,new Float32Array(D),B.STREAM_DRAW);B.vertexAttribPointer(n,2,B.FLOAT,false,0,0);var z=[0,0,0,1,1,0,1,1];B.bindBuffer(B.ARRAY_BUFFER,w);B.bufferData(B.ARRAY_BUFFER,new Float32Array(z),B.STREAM_DRAW);B.vertexAttribPointer(v,2,B.FLOAT,false,0,0);B.activeTexture(B.TEXTURE0);B.bindTexture(B.TEXTURE_2D,A.textureData);B.uniform1i(m,0);B.activeTexture(B.TEXTURE1);B.bindTexture(B.TEXTURE_2D,y.texture);B.uniform1i(h,1);B.uniform1f(d,A.baseHeight);var C=new Float32Array(this.map.mvpMatrix.data);B.uniformMatrix4fv(_mvpMatrixLoc,false,C);B.drawArrays(B.TRIANGLE_STRIP,0,4);Gd.releaseBuffer(B,x);Gd.releaseBuffer(B,w);B.disable(B.BLEND);B.deleteTexture(y.texture);B.deleteRenderbuffer(y.depthBuffer);B.deleteFramebuffer(y)};this.drawFrame=function(E){if(!o.isValid()){return}o.useProgram();var F=this.map.gl;F.disable(F.DEPTH_TEST);F.enable(F.BLEND);F.blendEquation(F.FUNC_ADD);F.blendFunc(F.SRC_ALPHA,F.ONE);F.uniform1f(p,E.minValue);F.uniform1f(e,E.maxValue);var A=F.createFramebuffer();var N=F.createTexture();var w=new GF(this.map.getCamera().width,this.map.getCamera().height);F.bindTexture(F.TEXTURE_2D,N);F.texImage2D(F.TEXTURE_2D,0,F.RGBA,w.getX(),w.getY(),0,F.RGBA,F.UNSIGNED_BYTE,null);F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.NEAREST);F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.NEAREST);F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE);F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE);A.texture=N;var M=F.createRenderbuffer();F.bindRenderbuffer(F.RENDERBUFFER,M);F.renderbufferStorage(F.RENDERBUFFER,F.DEPTH_COMPONENT16,w.getX(),w.getY());A.depthBuffer=M;F.bindFramebuffer(F.FRAMEBUFFER,A);F.framebufferTexture2D(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_2D,N,0);F.framebufferRenderbuffer(F.FRAMEBUFFER,F.DEPTH_ATTACHMENT,F.RENDERBUFFER,M);var L=this.map.getHeatMapPointCount();var B=Math.PI*2/L;var O=[];O.push(new GH(0,0,1));var G=this.map.getCamera().calPixelScale()*E.radius;var K,J;for(var D=0;D<=L;D++){var I=B*D;K=G*Math.cos(I);J=G*Math.sin(I);O.push(new GH(K,J,0))}var H=F.createBuffer();F.enableVertexAttribArray(c);F.bindBuffer(F.ARRAY_BUFFER,H);F.bufferData(F.ARRAY_BUFFER,Gd.flatten(O),F.STREAM_DRAW);F.vertexAttribPointer(c,3,F.FLOAT,false,0,0);var C=new Float32Array(this.map.mvpMatrix.data);F.uniformMatrix4fv(g,false,C);F.uniform1f(a,E.baseHeight);for(var D=0;D<E.points.length;D++){var z=E.points[D];F.uniform1f(q,z.value);F.uniform2fv(b,new Float32Array([z.x,z.y]));F.drawArrays(F.TRIANGLE_FAN,0,L+2)}F.bindFramebuffer(F.FRAMEBUFFER,null);Gd.releaseBuffer(F,H);F.disable(F.BLEND);return A};this.release=function(){s.release()}};var GHHeatMap=GHHeatMap||function(a){this.map=a;this.floorPoints={};this.radius=50;this.texture=this.genTexture();this.pointObj;this.minValue=0;this.maxValue=0;this.mapRender=new GHM(a);this.CLASSNAME="GHHeatMap";this.map.addPlugin(this)};GHHeatMap.prototype={genTexture:function(){var b=document.createElement("canvas");b.width=256;b.height=1;var a=b.getContext("2d");var e=a.createLinearGradient(0,0,256,1);e.addColorStop(0.45,"rgb(0,0,255)");e.addColorStop(0.5,"rgb(0,255,255)");e.addColorStop(0.65,"rgb(0,255,0)");e.addColorStop(0.95,"yellow");e.addColorStop(1,"rgb(255,0,0)");a.fillStyle=e;a.fillRect(0,0,256,1);var d=this.map.gl;var c=d.createTexture();d.bindTexture(d.TEXTURE_2D,c);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,b);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);d.bindTexture(d.TEXTURE_2D,null);return c},setData:function(a){this.pointObj=a;this.floorPoints={};if(!this.pointObj){return}for(var b in this.pointObj){this.floorPoints[b]={};this.floorPoints[b].minValue=0;this.floorPoints[b].maxValue=0;this.floorPoints[b].points=[];this.addPoints(this.floorPoints[b],this.pointObj[b])}},addPoint:function(b,a){b.minValue=Math.min(b.minValue,a.value);b.maxValue=Math.max(b.maxValue,a.value);b.points.push(a)},addPoints:function(c,b){for(var a=0;a<b.length;a++){this.addPoint(c,b[a])}},update:function(){},release:function(){},render:function(){this.update();var d=this.map.getCurFloorName();var c=this.floorPoints[d];if(!c){return}var b={};b.radius=this.radius;b.points=c.points;b.minValue=c.minValue;b.maxValue=c.maxValue;var a=this.map.getCurFloorHeight()+GHConstants.FLOOR_HEIGHT*this.map._getHeightScale()+2;b.baseHeight=a;b.textureData=this.texture;this.mapRender.render(b)}};var GCR=GCR||function(a){var c=a;var d,h,k,i;var e=new Gf(a.gl);var g="#ifdef GL_FRAGMENT_PRECISION_HIGH                    \nprecision highp float;							      \n#else												  \nprecision mediump float;							  \n#endif												  \n";var f=g+"attribute vec2 aVertexPosition; \nuniform mat4 mvpMatrix; 			\nuniform float height; 			\nuniform vec4 color; 			\nvarying vec4 vColor; \nvoid main(void) {				\n	vec4 pTran = vec4(aVertexPosition,height,1.0);	\n	gl_Position	= mvpMatrix * pTran;		\n	vColor = color;			\n}		\n";var b=g+" varying vec4 vColor; \n void main(void) {		\n   gl_FragColor = vColor; \n}	\n";j();function j(){e.createProgram(f,b);if(e.isValid()){e.useProgram();d=e.getAttribLocation("aVertexPosition");h=e.getUniformLocation("mvpMatrix");k=e.getUniformLocation("height");i=e.getUniformLocation("color")}}this.release=function(){e.release()};this.render=function(m){if(!e.isValid()){return}e.useProgram();var n=c.gl;n.disable(n.DEPTH_TEST);n.clearDepth(1);n.enable(n.BLEND);n.blendEquation(n.FUNC_ADD);n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA);n.enableVertexAttribArray(d);var l=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,l);n.bufferData(n.ARRAY_BUFFER,m.vertexPosition,n.STREAM_DRAW);n.vertexAttribPointer(d,2,n.FLOAT,false,0,0);n.uniform1f(k,m.baseHeight);n.uniform4fv(i,new Float32Array(m.color.data));var o=new Float32Array(c.mvpMatrix.data);n.uniformMatrix4fv(h,false,o);n.drawArrays(n.TRIANGLES,0,m.vertexPosition.length/2);n.deleteBuffer(l)}};var GHCircleControlRender=GHCircleControlRender||function(b){var e=b;var f,a,n,d,j,k,l;var g=new Gf(b.gl);var i="#ifdef GL_FRAGMENT_PRECISION_HIGH                    \nprecision highp float;							      \n#else												  \nprecision mediump float;							  \n#endif												  \n";var h=i+"attribute vec2 aVertexPosition; \nuniform mat4 mvpMatrix; 			\nuniform float height; 			\nuniform float radius; 			\nuniform vec2 center; 			\nuniform vec4 color; 			\nvarying vec4 vColor; \nvoid main(void) {				\n	vec4 pTran = vec4(aVertexPosition.x*radius+center.x,aVertexPosition.y*radius+center.y,height,1.0);	\n	gl_Position	= mvpMatrix * pTran;		\n	vColor = color;			\n}		\n";var c=i+" varying vec4 vColor; \n void main(void) {		\n   gl_FragColor = vColor; \n}	\n";m();function m(){g.createProgram(h,c);if(g.isValid()){g.useProgram();f=g.getAttribLocation("aVertexPosition");k=g.getUniformLocation("mvpMatrix");n=g.getUniformLocation("height");d=g.getUniformLocation("center");j=g.getUniformLocation("radius");l=g.getUniformLocation("color")}}this.release=function(){g.release()};this.render=function(p){if(!g.isValid()){return}g.useProgram();var q=e.gl;q.disable(q.DEPTH_TEST);q.clearDepth(1);q.enable(q.BLEND);q.blendEquation(q.FUNC_ADD);q.blendFunc(q.SRC_ALPHA,q.ONE_MINUS_SRC_ALPHA);var o=q.createBuffer();q.enableVertexAttribArray(f);q.bindBuffer(q.ARRAY_BUFFER,o);q.bufferData(q.ARRAY_BUFFER,p.vertexFlatten,q.STREAM_DRAW);q.vertexAttribPointer(f,2,q.FLOAT,false,0,0);q.uniform1f(n,p.baseHeight);q.uniform1f(j,p.radius);q.uniform2fv(d,new Float32Array([p.center.x,p.center.y]));q.uniform4fv(l,new Float32Array(p.color.data));var r=new Float32Array(e.mvpMatrix.data);q.uniformMatrix4fv(k,false,r);q.drawArrays(q.TRIANGLE_FAN,0,p.vertexFlatten.length/2);q.deleteBuffer(o)}};var GHLineControlRender=GHLineControlRender||function(a){var e=a;var f,k,m,d,j,c;var g=new Gf(a.gl);var i="#ifdef GL_FRAGMENT_PRECISION_HIGH                    \nprecision highp float;							      \n#else												  \nprecision mediump float;							  \n#endif												  \n";var h=i+"attribute vec2 aVertexPosition; \nuniform mat4 mvpMatrix; 			\nuniform float height; 			\nuniform vec2 center; 			\nuniform float radius; 			\nuniform vec4  uColor; 			\nvarying vec4 vColor; \nvoid main(void) {				\n	vec4 pTran = vec4(aVertexPosition.x*radius+center.x,aVertexPosition.y*radius+center.y,height,1.0);	\n	gl_Position	= mvpMatrix * pTran;		\n	vColor = uColor;			\n}		\n";var b=i+" varying vec4 vColor; \n void main(void) {		\n   gl_FragColor = vColor; \n}	\n";l();function l(){g.createProgram(h,b);if(g.isValid()){g.useProgram();f=g.getAttribLocation("aVertexPosition");k=g.getUniformLocation("mvpMatrix");m=g.getUniformLocation("height");d=g.getUniformLocation("center");j=g.getUniformLocation("radius");c=g.getUniformLocation("uColor")}}this.release=function(){g.release()};this.render=function(q){if(!g.isValid()){return}g.useProgram();var r=e.gl;r.disable(r.DEPTH_TEST);r.clearDepth(1);r.enable(r.BLEND);r.blendEquation(r.FUNC_ADD);r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);var o=r.createBuffer();r.enableVertexAttribArray(f);r.bindBuffer(r.ARRAY_BUFFER,o);r.bufferData(r.ARRAY_BUFFER,q.vertexPosition,r.STREAM_DRAW);r.vertexAttribPointer(f,2,r.FLOAT,false,0,0);r.uniform1f(m,q.baseHeight);var p=q.center==undefined?new Float32Array([0,0]):new Float32Array([q.center.x,q.center.y]);r.uniform2fv(d,p);r.uniform1f(j,q.radius||1);var s=new Float32Array(e.mvpMatrix.data);r.uniformMatrix4fv(k,false,s);var n;if(q.lineColor){n=new Float32Array([q.lineColor.getX(),q.lineColor.getY(),q.lineColor.getZ(),q.lineColor.getW()])}else{n=new Float32Array([0,0,1,1])}r.uniform4fv(c,n);r.lineWidth(10);r.drawArrays(r.LINE_STRIP,0,q.vertexPosition.length/2);r.deleteBuffer(o)}};var GHControl=GHControl||function(b,a){this.map=b;this.options=a||{};this.enable=false;this.data={};this.geometry;this.tempPoint;this.mapRender;this.map.addControl(this);this.color=new GI(1,0,0,0.7);this.tempColor=new GI(0,0.5,0.5,0.7)};GHControl.prototype={setColor:function(f,e,c,d){if(arguments.length!=4){throw"必须是r,g,b,a四个参数"}this.color.setValue(f,e,c,d);this.map.refresh()},setTempColor:function(f,e,c,d){if(arguments.length!=4){throw"必须是r,g,b,a四个参数"}this.tempColor.setValue(f,e,c,d);this.map.refresh()},getColor:function(){return{r:this.color.getX(),g:this.color.getY(),b:this.color.getZ(),a:this.color.getW()}},getTempColor:function(){return{r:this.tempColor.getX(),g:this.tempColor.getY(),b:this.tempColor.getZ(),a:this.tempColor.getW()}},end:function(a){},cancel:function(){},removeLastPoint:function(){},render:function(){},addPoint:function(a){},setTempPoint:function(a){},clear:function(){this.data={};this.geometry=undefined;this.map.refresh()},createGeometry:function(){},getGeomData:function(){var b=[];for(var a=0;a<this.geometry.length;a++){b.push(this.geometry[a])}if(!(this instanceof GHLineControl)){b.push(this.geometry[0])}return b},release:function(){this.clear()}};var GHPolygonControl=GHPolygonControl||function(b,a){GHControl.call(this,b,a);this.polygonRender=new GCR(b);this.lineRender=new GHLineControlRender(b)};GHPolygonControl.prototype=Gd.clone(GHControl.prototype);GHPolygonControl.prototype.addPoint=function(a){if(!this.geometry){this.geometry=[]}this.geometry.push(a);this.map.refresh()};GHPolygonControl.prototype.end=function(b){if(!this.geometry){return}this.geometry.push(b);var c=this.map.getCurFloorName();var a=this.data[c];if(!a){a=[];this.data[c]=a}a.push(this.geometry);this.geometry.triangles=GTP.triangulate(this.geometry);this.map.refresh();if(this.options.onDrawEnd){this.options.onDrawEnd(this,this.getGeomData())}this.geometry=undefined;this.tempPoint=undefined};GHPolygonControl.prototype.render=function(){var h=this.map.getCurFloorName();var n=this.data[h];if(n&&n.length>0){var e=[];var c={};for(var b=0;b<n.length;b++){var f=n[b];var a=f.triangles;for(var d=0;d<a.length;d++){var p=a[d];if(!p){continue}var m=new GF(p.a.x,p.a.y);var l=new GF(p.b.x,p.b.y);var j=new GF(p.c.x,p.c.y);e.push(m);e.push(l);e.push(j)}}c.vertexPosition=Gd.flatten(e);c.baseHeight=this.map.getCurFloorHeight();c.color=this.color;this.polygonRender.render(c)}if(this.geometry){var f=this.geometry.slice(0);f.push(this.tempPoint);var e=[];var c={};if(this.geometry.length>=2){var a=GTP.triangulate(f);for(var d=0;d<a.length;d++){var p=a[d];if(!p){continue}var m=new GF(p.a.x,p.a.y);var l=new GF(p.b.x,p.b.y);var j=new GF(p.c.x,p.c.y);e.push(m);e.push(l);e.push(j)}}c.baseHeight=this.map.getCurFloorHeight();var o=[];for(var d=0;d<f.length;d++){o.push(f[d].x);o.push(f[d].y)}o.push(f[0].x);o.push(f[0].y);c.vertexPosition=new Float32Array(o);this.lineRender.render(c);c.color=this.tempColor;c.vertexPosition=Gd.flatten(e);this.polygonRender.render(c)}};GHPolygonControl.prototype.setTempPoint=function(a){this.tempPoint=a;if(this.geometry){this.map.refresh()}};GHPolygonControl.prototype.cancel=function(){this.geometry=undefined;this.map.refresh()};GHPolygonControl.prototype.removeLastPoint=function(){if(this.geometry&&this.geometry.length>0){this.geometry.length=this.geometry.length-1;this.map.refresh()}};var GHCircleControl=GHCircleControl||function(b,a){GHControl.call(this,b,a);this.circleRender=new GHCircleControlRender(b);this.lineRender=new GHLineControlRender(b);this.pointCount=36;this.disRad=Math.PI*2/this.pointCount};GHCircleControl.prototype=Gd.clone(GHControl.prototype);GHCircleControl.prototype.addPoint=function(a){if(!this.geometry){this.geometry={center:a}}this.map.refresh()};GHCircleControl.prototype.setTempPoint=function(a){this.tempPoint=a;if(this.geometry){this.map.refresh()}};GHCircleControl.prototype.cancel=function(){this.geometry=undefined;this.map.refresh()};GHCircleControl.prototype.removeLastPoint=function(){};GHCircleControl.prototype.end=function(a){if(!this.geometry){return}var k,h,m=[];var c=this.geometry.center.x;var b=this.geometry.center.y;var o=a.x-c;var n=a.y-b;var e=Math.sqrt(o*o+n*n);var j=Math.atan2(n,o);m.push(new GF(c,b));this.geometry=[];for(var d=0;d<=this.pointCount;d++){var g=this.disRad*d+j;k=Math.cos(g)*e+c;h=Math.sin(g)*e+b;m.push(new GF(k,h));if(d<this.pointCount){this.geometry.push(new GHPoint2D(k,h))}}var f=this.map.getCurFloorName();var l=this.data[f];if(!l){l=[];this.data[f]=l}l.push(m);this.map.refresh();if(this.options.onDrawEnd){this.options.onDrawEnd(this,this.getGeomData())}this.geometry=undefined;this.tempPoint=undefined};GHCircleControl.prototype.render=function(){var j=this.map.getCurFloorName();var p=this.data[j];if(p&&p.length>0){var e=[];var d={};d.baseHeight=this.map.getCurFloorHeight();d.radius=1;d.center=new GHPoint2D(0,0);d.color=this.color;for(var b=0;b<p.length;b++){var f=p[b];d.vertexFlatten=Gd.flatten(f);this.circleRender.render(d)}}if(this.geometry&&this.geometry.center&&this.tempPoint){var a=this.geometry.center;var s=this.tempPoint.x-a.x;var r=this.tempPoint.y-a.y;var h=Math.sqrt(s*s+r*r);var o=Math.atan2(r,s);var n,m,q=[];q.push(new GF(0,0));for(var c=0;c<=this.pointCount;c++){var l=this.disRad*c+o;n=Math.cos(l);m=Math.sin(l);q.push(new GF(n,m))}var d={};d.baseHeight=this.map.getCurFloorHeight();d.color=this.tempColor;d.center=a;d.radius=h;d.vertexFlatten=Gd.flatten(q);this.circleRender.render(d);d.vertexPosition=Gd.flatten(q.splice(1));this.lineRender.render(d)}};(function(){var a=a||function(c,b){GHControl.call(this,c,b);this.polygonRender=new GCR(c);this.lineRender=new GHLineControlRender(c)};a.prototype=Gd.clone(GHControl.prototype);a.prototype.addPoint=function(b){if(!this.geometry){this.geometry=[];this.geometry.push(b);this.map.refresh()}};a.prototype.cancel=function(){this.geometry=undefined;this.map.refresh()};a.prototype.setTempPoint=function(b){this.tempPoint=b;if(this.geometry){this.map.refresh()}};a.prototype.removeLastPoint=function(){};a.prototype.end=function(b){if(!this.geometry){return}var r=this.map.gp2px(this.geometry[0].x,this.geometry[0].y);var l=this.map.gp2px(b.x,b.y);var m=new GHPixel(r.x,l.y);var j=new GHPixel(l.x,r.y);var q=this.map.px2gp(r.x,r.y);var g=new GF(q.x,q.y);var n=this.map.px2gp(m.x,m.y);var f=new GF(n.x,n.y);var k=this.map.px2gp(l.x,l.y);var d=new GF(k.x,k.y);var i=this.map.px2gp(j.x,j.y);var c=new GF(i.x,i.y);var e=[];e.push(g);e.push(f);e.push(d);e.push(g);e.push(d);e.push(c);var s=[];s.push(q);s.push(n);s.push(k);s.push(i);s.push(q);var h=this.map.getCurFloorName();var o=this.data[h];if(!o){o=[];this.data[h]=o}o.push(s);s.triangles=Gd.flatten(e);this.map.refresh();this.geometry.length=0;this.geometry.push(q);this.geometry.push(n);this.geometry.push(k);this.geometry.push(i);if(this.options.onDrawEnd){this.options.onDrawEnd(this,this.getGeomData())}this.tempPoint=undefined;this.geometry=undefined};a.prototype.render=function(){var e=this.map.getCurFloorName();var n=this.data[e];if(n&&n.length>0){var d=[];var c={};c.baseHeight=this.map.getCurFloorHeight();c.color=this.color;for(var b=0;b<n.length;b++){c.vertexPosition=n[b].triangles;this.polygonRender.render(c)}}if(this.geometry&&this.tempPoint){var o=this.map.gp2px(this.geometry[0].x,this.geometry[0].y);var i=this.map.gp2px(this.tempPoint.x,this.tempPoint.y);var l=new GHPixel(o.x,i.y);var g=new GHPixel(i.x,o.y);var m=this.map.px2gp(o.x,o.y);m=new GF(m.x,m.y);var j=this.map.px2gp(l.x,l.y);j=new GF(j.x,j.y);var h=this.map.px2gp(i.x,i.y);h=new GF(h.x,h.y);var f=this.map.px2gp(g.x,g.y);f=new GF(f.x,f.y);var d=[];d.push(m);d.push(j);d.push(h);d.push(m);d.push(h);d.push(f);var p=[];p.push(m);p.push(j);p.push(h);p.push(f);p.push(m);var c={};c.baseHeight=this.map.getCurFloorHeight();c.color=this.tempColor;c.vertexPosition=Gd.flatten(d);this.polygonRender.render(c);c.vertexPosition=Gd.flatten(p);this.lineRender.render(c)}};window.GHRectControl=a})();(function(){var a=window.GHSlopeRectControl||function(d,c){GHControl.call(this,d,c);this.polygonRender=new GCR(d);this.lineRender=new GHLineControlRender(d)};a.prototype=Gd.clone(GHControl.prototype);a.prototype.addPoint=function(c){if(!this.geometry){this.geometry=[]}if(this.geometry.length<2){this.geometry.push(c);this.map.refresh()}};a.prototype.cancel=function(){this.geometry=undefined;this.map.refresh()};a.prototype.setTempPoint=function(c){this.tempPoint=c;if(this.geometry){this.map.refresh()}};a.prototype.removeLastPoint=function(){if(this.geometry&&this.geometry.length>0){this.geometry.length=this.geometry.length-1;this.map.refresh()}};a.prototype.end=function(d){if(!this.geometry||this.geometry.length!=2){return}var m=this.map.gp2px(this.geometry[0].x,this.geometry[0].y);var k=this.map.gp2px(this.geometry[1].x,this.geometry[1].y);var e=this.map.gp2px(d.x,d.y);var f=b(m,k,e);var c=[];this.geometry.length=0;for(var g=0;g<f.length;g++){var d=this.map.px2gp(f[g].x,f[g].y);c.push(new GF(d.x,d.y));this.geometry.push(new GHPoint2D(d.x,d.y))}var h=[];h.push(c[0]);h.push(c[1]);h.push(c[2]);h.push(c[0]);h.push(c[2]);h.push(c[3]);var n=[];n.push(c[0]);n.push(c[1]);n.push(c[2]);n.push(c[3]);n.push(c[0]);var j=this.map.getCurFloorName();var l=this.data[j];if(!l){l=[];this.data[j]=l}l.push(n);n.triangles=Gd.flatten(h);this.map.refresh();if(this.options.onDrawEnd){this.options.onDrawEnd(this,this.getGeomData())}this.geometry=undefined;this.tempPoint=undefined};a.prototype.render=function(){var o=this.map.getCurFloorName();var r=this.data[o];if(r&&r.length>0){var m=[];var l={};l.baseHeight=this.map.getCurFloorHeight();l.color=this.color;for(var f=0;f<r.length;f++){l.vertexPosition=r[f].triangles;this.polygonRender.render(l)}}if(this.geometry&&this.geometry.length>0&&this.tempPoint){var m=[],t=[];var n=this.geometry.slice(0);n.push(this.tempPoint);var l={};l.baseHeight=this.map.getCurFloorHeight();l.color=this.tempColor;if(n.length>=3){var s=this.map.gp2px(n[0].x,n[0].y);var q=this.map.gp2px(n[1].x,n[1].y);var e=this.map.gp2px(this.tempPoint.x,this.tempPoint.y);var j=b(s,q,e);var c=[];for(var h=0;h<j.length;h++){var d=this.map.px2gp(j[h].x,j[h].y);c.push(new GF(d.x,d.y));t.push(d.x);t.push(d.y)}t.push(t[0]);t.push(t[1]);m.push(c[0]);m.push(c[1]);m.push(c[2]);m.push(c[0]);m.push(c[2]);m.push(c[3])}else{for(var h=0;h<n.length;h++){var d=n[h];t.push(d.x);t.push(d.y)}}l.vertexPosition=Gd.flatten(m);this.polygonRender.render(l);l.vertexPosition=new Float32Array(t);this.lineRender.render(l)}};function b(n,k,i){if(n.x==k.x){var c=new GHPoint2D(i.x,k.y);var o=new GHPoint2D(i.x,n.y);return[n,k,c,o]}var e=(n.y-k.y)/(n.x-k.x);var d=(n.y-e*n.x);var f=i.x+e*i.y;var l=(f-e*d)/(e*e+1);var j=e*l+d;var h=n.x-l+i.x;var g=n.y-j+i.y;var o=new GHPoint2D(h,g);h=k.x-l+i.x;g=k.y-j+i.y;var c=new GHPoint2D(h,g);return[n,k,c,o]}window.GHSlopeRectControl=a})();var GHLineControl=GHLineControl||function(b,a){GHControl.call(this,b,a);this.lineRender=new GHLineControlRender(b)};GHLineControl.prototype=Gd.clone(GHControl.prototype);GHLineControl.prototype.addPoint=function(a){if(!this.geometry){this.geometry=[]}this.geometry.push(a);this.map.refresh()};GHLineControl.prototype.end=function(b){if(!this.geometry){return}this.geometry.push(b);var c=this.map.getCurFloorName();var a=this.data[c];if(!a){a=[];this.data[c]=a}a.push(this.geometry);this.map.refresh();if(this.options.onDrawEnd){this.options.onDrawEnd(this,this.getGeomData())}this.geometry=undefined;this.tempPoint=undefined};GHLineControl.prototype.setTempPoint=function(a){this.tempPoint=a;if(this.geometry){this.map.refresh()}};GHLineControl.prototype.cancel=function(){this.geometry=undefined;this.map.refresh()};GHLineControl.prototype.removeLastPoint=function(){if(this.geometry&&this.geometry.length>0){this.geometry.length=this.geometry.length-1;this.map.refresh()}};GHLineControl.prototype.render=function(){var j=this.map.getCurFloorName();var e=this.data[j];if(e&&e.length>0){var h={};for(var b=0;b<e.length;b++){var d=e[b];var f=[];for(var c=0;c<d.length;c++){var a=d[c];f.push(new GF(a.x,a.y))}h.vertexPosition=Gd.flatten(f);h.baseHeight=this.map.getCurFloorHeight();h.lineColor=this.color;this.lineRender.render(h)}}if(this.geometry){var d=this.geometry.slice(0);d.push(this.tempPoint);var f=[];var h={};for(var c=0;c<d.length;c++){var a=d[c];f.push(new GF(a.x,a.y))}h.baseHeight=this.map.getCurFloorHeight();h.vertexPosition=Gd.flatten(f);this.lineRender.render(h)}};(function(){var a=function(b){this.map=b;this.data=undefined;this.colorMap={"0":new GI(1,0,0,0.7),"1":new GI(0,1,0,0.7),"2":new GI(0,0,1,0.7)};this.map.addPlugin(this)};a.prototype={render:function(){if(this.data&&this.data.length>0){this.renderChart()}},setColorMap:function(e){var d={};for(var c in e){var f=e[c];var b=Gd.getVector4FromColorStr(f);d[c]=b}this.colorMap=d;this.map.refresh()},renderChart:function(){},clear:function(){this.data=undefined;this.map.refresh()},setData:function(h){this.data=h;if(this.data&&this.data.length>0){for(var c=0;c<this.data.length;c++){var e=this.data[c];var g=this.map.searchSpaceByCode(e.code);if(g){e.space=g;var f=0;for(var b=0;b<e.data.length;b++){var k=e.data[b];f+=k.value}for(var b=0;b<e.data.length;b++){var k=e.data[b];k.percent=k.value/f}}}}this.map.refresh()},release:function(){this.data=undefined}};window.GHChart=window.GHChart||a})();(function(){var a=function(b){GHChart.call(this,b);this.circleRender=new GHCircleControlRender(b);this.disRad=Math.PI*2/36};a.prototype=Gd.clone(GHChart.prototype);a.prototype.renderChart=function(){if(!this.data.initCircle){for(var g=0;g<this.data.length;g++){var b=this.data[g];if(!b.space){continue}var n=0;for(var e=0;e<b.data.length;e++){var p=b.data[e];var q=p.percent*2*Math.PI;if(e==0){n=-q/2}var m=q%this.disRad==0?q/this.disRad:Math.ceil(q/this.disRad);var o=q/m;var l=[];l.push(new GF(0,0));for(var c=0;c<=m;c++){var s=Math.cos(n);var r=Math.sin(n);l.push(new GF(s,r));if(c<m){n+=o}}p.vertex=l}}this.data.initCircle=true}var h=this.map.getCurFloorName();var t=this.map.getCurFloorHeight();var f={};for(var g=0;g<this.data.length;g++){var b=this.data[g];if(!b.space){continue}if(h!=b.space.fname){continue}f.radius=b.space.radius;f.center=new GHPoint2D(b.space.x,b.space.y);f.baseHeight=t+b.space.height*this.map._getHeightScale();for(var e=0;e<b.data.length;e++){var p=b.data[e];f.color=this.colorMap[p.type];f.vertexFlatten=Gd.flatten(p.vertex);this.circleRender.render(f)}}};a.prototype.pickByPoint=function(s){var n=this.map.getCurFloorName();for(var m=0;m<this.data.length;m++){var g=this.data[m];if(!g.space){continue}if(n!=g.space.fname){continue}var f=this.map.selectSpace(s);if(!f||f.code!=g.code){continue}var u={x:(s.x-g.space.x)/g.space.radius,y:(s.y-g.space.y)/g.space.radius};if(f.code!=g.code){continue}for(var l=0;l<g.data.length;l++){var o=g.data[l];var e=o.vertex[0];var r={x:e.getX(),y:e.getY()};for(var h=1;h<o.vertex.length-1;h++){var v=o.vertex[h];var t=o.vertex[h+1];var q={x:v.getX(),y:v.getY()};var p={x:t.getX(),y:t.getY()};var x=new GN(r,q,p);if(x.contains(u,true)){var w={};w.type=o.type;w.value=o.value;w.code=g.code;return w}}}}};window.GHPieChart=window.GHPieChart||a})();(function(){var b=function(c){var f=c;var g,l,k,m,e,p,n;var h=new Gf(c.gl);var j="#ifdef GL_FRAGMENT_PRECISION_HIGH                    \nprecision highp float;							      \n#else												  \nprecision mediump float;							  \n#endif												  \n";var i=j+"attribute vec3 aVertexPosition; \nuniform mat4 mvpMatrix; 			\nuniform float width; 			\nuniform float height; 			\nuniform float baseHeight; 			\nuniform vec3 center; 			\nuniform vec4 color; 			\nvarying vec4 vColor; \nvoid main(void) {				\n	vec3 v = vec3(aVertexPosition.x * width,aVertexPosition.y*width,baseHeight + aVertexPosition.z*height);	\n	v += center;			\n	vec4 pTran = vec4(v,1.0);	\n	gl_Position	= mvpMatrix * pTran;		\n	vColor = color;			\n}		\n";var d=j+" varying vec4 vColor; \n void main(void) {		\n   gl_FragColor = vColor; \n}	\n";o();function o(){h.createProgram(i,d);if(h.isValid()){h.useProgram();g=h.getAttribLocation("aVertexPosition");l=h.getUniformLocation("mvpMatrix");m=h.getUniformLocation("width");k=h.getUniformLocation("height");p=h.getUniformLocation("baseHeight");e=h.getUniformLocation("center");n=h.getUniformLocation("color")}}this.release=function(){h.release()};this.render=function(r){if(!h.isValid()){return}h.useProgram();var s=f.gl;s.enable(s.DEPTH_TEST);s.clearDepth(1);s.enable(s.BLEND);s.blendEquation(s.FUNC_ADD);s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA);s.enableVertexAttribArray(g);var q=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,q);s.bufferData(s.ARRAY_BUFFER,r.vertexPosition,s.STREAM_DRAW);s.vertexAttribPointer(g,3,s.FLOAT,false,0,0);s.uniform1f(p,r.baseHeight);s.uniform1f(m,r.width);s.uniform1f(k,r.height);s.uniform3fv(e,new Float32Array(r.center.data));s.uniform4fv(n,new Float32Array(r.color.data));var t=new Float32Array(f.mvpMatrix.data);s.uniformMatrix4fv(l,false,t);s.drawArrays(s.TRIANGLES,0,r.vertexPosition.length/3);s.deleteBuffer(q);s.disable(s.DEPTH_TEST)}};var a=function(g){GHChart.call(this,g);this.polygonRender=new b(g);this.polygon=[new GH(-0.5,-0.5,0),new GH(0.5,-0.5,0),new GH(0.5,0.5,0),new GH(-0.5,0.5,0),new GH(-0.5,-0.5,0)];this.polygonTop=[new GH(-0.5,-0.5,1),new GH(0.5,-0.5,1),new GH(0.5,0.5,1),new GH(-0.5,0.5,1),new GH(-0.5,-0.5,1)];this.min=new GH(-0.5,-0.5,0);this.max=new GH(0.5,0.5,1);this.vertex=[];for(var c=0;c<this.polygon.length-1;c++){var h=this.polygon[c];var f=this.polygon[c+1];var e=this.polygonTop[c+1];var d=this.polygonTop[c];this.vertex.push(h);this.vertex.push(f);this.vertex.push(e);this.vertex.push(e);this.vertex.push(d);this.vertex.push(h)}this.vertex.push(this.polygonTop[0]);this.vertex.push(this.polygonTop[1]);this.vertex.push(this.polygonTop[2]);this.vertex.push(this.polygonTop[2]);this.vertex.push(this.polygonTop[3]);this.vertex.push(this.polygonTop[4]);this.width=20};a.prototype=Gd.clone(GHChart.prototype);a.prototype.renderChart=function(){var g={};g.vertexPosition=Gd.flatten(this.vertex);var c=this.map.calPixelScale()*this.width;g.width=c;var o=this.map.getCurFloorHeight();var m=this.map.getCurFloorName();for(var k=0;k<this.data.length;k++){var e=this.data[k];if(!e.space){continue}if(m!=e.space.fname){continue}g.center=new GH(e.space.x,e.space.y,0);g.baseHeight=o+e.space.height*this.map._getHeightScale();var l=0;for(var f=0;f<e.data.length;f++){var n=e.data[f];g.color=this.colorMap[n.type];g.height=n.value;n.baseHeight=g.baseHeight;this.polygonRender.render(g);g.baseHeight+=n.value}}};a.prototype.pickByPoint=function(o){var l=this.map.getCurFloorName();var c=this.map.calPixelScale()*this.width;var g=new GH(0,0,0);var n=new GH(0,0,0);var k=new GOA(g,n);var q=this.map.gp2px(o.x,o.y);var p=this.map.getCamera()._getRay(q.x,q.y);for(var h=0;h<this.data.length;h++){var e=this.data[h];if(!e.space){continue}if(l!=e.space.fname){continue}for(var f=e.data.length-1;f>=0;f--){var m=e.data[f];g.setValue(this.min.getX()*c+e.space.x,e.space.y+this.min.getY()*c,m.baseHeight);n.setValue(this.max.getX()*c+e.space.x,e.space.y+this.max.getY()*c,m.value+m.baseHeight);k.setValue(g,n);if(p.intersectBox(k)){var r={};r.type=m.type;r.value=m.value;r.code=e.code;return r}}}};window.GHBarChart=window.GHBarChart||a})();(function(){var a=function(b){GHChart.call(this,b);this.polygonRender=new GCR(b);this.width=10;this.colorMap={"0":new GI(1,0,0,1),"1":new GI(0,1,0,1),"2":new GI(0,0,1,1)}};a.prototype=Gd.clone(GHChart.prototype);a.prototype.setData=function(b){this.data=b;this.map.refresh()};a.prototype.render=function(){if(!this.data){return}var k=this.map.getCurFloorName();var b=this.map.calPixelScale()*this.width/2;var p=this.map.getCurFloorHeight();var h=this.data[k];var d=new GF(0,0);var g=d.clone();var o=d.clone();var n=o.clone();var m=o.clone();var l=o.clone();var f={};f.baseHeight=p;if(h&&h.length>0){for(var e=0;e<h.length;e++){var j=[];var c=h[e];d.setX(c.end.x-c.start.x);d.setY(c.end.y-c.start.y);d.normalize();g.setValue(-d.getY(),d.getX());g.multNum(b);o.setValue(c.start.x+g.getX(),c.start.y+g.getY());l.setValue(c.start.x-g.getX(),c.start.y-g.getY());n.setValue(c.end.x+g.getX(),c.end.y+g.getY());m.setValue(c.end.x-g.getX(),c.end.y-g.getY());j.push(o);j.push(n);j.push(m);j.push(m);j.push(l);j.push(o);f.vertexPosition=Gd.flatten(j);f.color=this.colorMap[c.type];this.polygonRender.render(f)}}};window.GHLinkChart=window.GHLinkChart||a})();(function(){var a=function(b){GHChart.call(this,b);this.polygonRender=new GCR(b);this.width=10;this.s=0.9;this.disRad=Math.PI/72;this.lineRender=new GHLineControlRender(b)};a.prototype=Gd.clone(GHChart.prototype);a.prototype.setData=function(b){this.data=b;this.map.refresh()};a.prototype.render=function(){if(!this.data){return}var K=this.map.getCurFloorName();var w=this.map.calPixelScale()*this.width/2;var t=this.map.getCurFloorHeight()+GHConstants.FLOOR_HEIGHT*this.map._getHeightScale();var G=this.data[K];if(G&&G.length>0){for(var B=0;B<G.length;B++){var q=G[B];var o=new GF(q.end.x-q.start.x,q.end.y-q.start.y);var g=(q.start.x+q.end.x)/2;var f=(q.start.y+q.end.y)/2;var C=o.length()/2;if(!q.lines){q.lines=[];var s=Math.sqrt(C*C/(1-this.s*this.s));C=this.s*s;o.normalize();o.setValue(-o.getY(),o.getX());o.multNum(C);var H=new GF(g+o.getX(),f+o.getY());q.center=H;var v=Math.atan2(q.start.y-H.getY(),q.start.x-H.getX());var I=Math.acos(this.s)*2;var j=I%this.disRad==0?I/this.disRad:Math.ceil(I/this.disRad);var E=I/j;for(var A=0;A<=j;A++){var m=Math.cos(v)*s+H.getX();var l=Math.sin(v)*s+H.getY();q.lines.push(new GF(m,l));v+=E}}var n=[],F=[];var z=[];for(var A=0;A<q.lines.length;A++){var u=q.lines[A].clone();u.sub(q.center);u.normalize();u.multNum(w);n.push(new GF(q.lines[A].getX()+u.getX(),q.lines[A].getY()+u.getY()));F.push(new GF(q.lines[A].getX()-u.getX(),q.lines[A].getY()-u.getY()));if(A==q.lines.length-1){var h=q.lines[A].clone().sub(q.lines[A-1]);h.normalize();u.multNum(2);z.push(new GF(q.lines[A].getX()+u.getX(),q.lines[A].getY()+u.getY()));z.push(new GF(q.lines[A].getX()-u.getX(),q.lines[A].getY()-u.getY()));h.multNum(Math.sqrt(3)*w*2);z.push(new GF(q.lines[A].getX()+h.getX(),q.lines[A].getY()+h.getY()))}}var D=[];for(var A=0;A<q.lines.length-1;A++){var e=F[A];var d=F[A+1];var c=n[A+1];var b=n[A];D.push(e);D.push(d);D.push(c);D.push(c);D.push(b);D.push(e)}for(var A=0;A<z.length;A++){D.push(z[A])}var J={};J.baseHeight=t;J.vertexPosition=Gd.flatten(D);J.color=this.colorMap[q.type];this.polygonRender.render(J)}}};window.GHFlowChart=window.GHFlowChart||a})();